MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;**********************************************************************
                      00002 ;       Filename:           Eiffel.asm
                      00003 ;       Date:           18 Juillet 2001
                      00004 ;       Update:         25 Aout 2002
                      00005 ;
                      00006 ;       Author:                 Favard Laurent
                      00007 ;       Compagny:               None
                      00008 ;
                      00009 ;**********************************************************************
                      00010 ;       HARDWARE DESCRIPTION:
                      00011 ;
                      00012 ;       Processor:              16F876
                      00013 ;       Crystal:                4MHz
                      00014 ;       WDT:                    Disable
                      00015 ;       RS-232C:                MAX 232A converter, TxD/RxD wired
                      00016 ;       Alimentation:   Via RJ-11 cable/TxD,RxD
                      00017 ;       Revision soft:  1.0.4
                      00018 ;       Revision board: A
                      00019 ;
                      00020 ;**********************************************************************
                      00021 ;   Remarque logicielle:
                      00022 ;
                      00023 ;   - Compatible avec le pilote realise par la societe Oxo.
                      00024 ;
                      00025 ;   - Compatible par defaut avec le protocole souris atari. Le PIC
                      00026 ;     transforme les trames souris PS/2 en trames normales souris Atari,
                      00027 ;     quelque soit la souris branchee.
                      00028 ;
                      00029 ;   - Ajout des scan-codes supplementaires pour Atari pour les nouvelles
                      00030 ;     touches PS/2 et fonctions nouvelles souris.
                      00031 ;
                      00032 ;   Voir le fichier /Docs/ExtensionAtari.txt
                      00033 ;
                      00034 ;**********************************************************************
                      00035 ;
                      00036 ;   Ce programme permet de traduires les scan-codes du jeux 3 d'un
                      00037 ;   clavier PS/2 vers les scan-codes Atari IKBD et de gerer une souris
                      00038 ;   PS/2 standard ou Intellimouse a roulette 3 boutons et double roulette
                      00039 ;   5 boutons. Les boutons 4&5 sont affectes a des scan-codes.
                      00040 ;
                      00041 ;   Les 2 joysticks prevus d'origine dans l'IKBD de l'Atari peuvent egalement
                      00042 ;   etre connectes :
                      00043 ;     Le Joystick 0 est branche sur le port A du PIC:
                      00044 ;       RA1: Haut
                      00045 ;       RA2: Bas
                      00046 ;       RA3: Gauche
                      00047 ;       RA4: Droite
                      00048 ;       RA5: Tir
                      00049 ;    Le Joystick 1 est branche sur le port C du PIC:
                      00050 ;       RC0: Haut
                      00051 ;       RC1: Bas
                      00052 ;       RC2: Gauche
                      00053 ;       RC3: Droite
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00054 ;       RC4: Tir
                      00055 ;
                      00056 ;   La commande d'un ventilateur est egalement possible :
                      00057 ;       RC5: commande moteur courant continu en tout ou rien via un MOSFET.
                      00058 ;       RA0: entree analogique temperature AN0, une CTN 10Kohms a 25
                      00059 ;            deg C est raccordee entre AN0 et Vss (0V) avec un rappel a
                      00060 ;            Vdd (+4,3V) de 10Kohms. Soit VAN0 = (4.3 * RCTN)/(10E3+RCTN).
                      00061 ;            En supposant que la CTN est utilisee dans sa zone "lineaire",
                      00062 ;            Temp = (IDX_T0_AN0 - Val_AN0) * IDX_SCALETEMP / 64 avec :
                      00063 ;            Temp = temperature en degres C
                      00064 ;            IDX_T0_AN0 = valeur AN0 pour 0 degres C en EEPROM
                      00065 ;            IDX_SCALETEMP = facteur d'echelle en EEPROM
                      00066 ;            Val_AN0 = valeur sur AN0 soit 0 pour 0V et 255 pour 4,3V soit :
                      00067 ;             Val_AN0 = (256 * RCTN)/(10E3+RCTN)
                      00068 ;             En mesurant 11200 ohms a 20 degres C et 5450 ohms a 40 degres C,
                      00069 ;             soit Val_AN0 = 135 a 20 degres C et Val_AN0 = 90 a 40 degres C
                      00070 ;             on peut en deduire que :
                      00071 ;             IDX_SCALETEMP = (64 * T(40)-T(20)) / (Val_AN0(20) - Val_AN0(40))
                      00072 ;                           = 28 pour cette resistance CTN
                      00073 ;             IDX_T0_AN0 = ( (64 * T(40)) / IDX_SCALETEMP ) + Val_AN0(40)
                      00074 ;                        = 180 pour cette resistance CTN
                      00075 ;
                      00076 ;   Le soft permet la connection de la carte a un port serie RS-232C
                      00077 ;   ou directement a un ordinateur type Atari ST (RJ-12 ou HE-14).
                      00078 ;
                      00079 ;   Les deux jumpers permettent:
                      00080 ;
                      00081 ;   Jumper4, permettant d'activer ou non:
                      00082 ;
                      00083 ;   5V sur PORTB4: Mode Atari  (Translation des scan-codes clavier/souris)
                      00084 ;   0V sur PORTB4: Mode direct (Pas de translation, Scan-codes PS/2 direct)
                      00085 ;
                      00086 ;   Jumper 5, permettant d'activer ou non:
                      00087 ;
                      00088 ;   5V sur PORTB5: Mode normal (Connexion a un Atari)
                      00089 ;   0V sur PORTB5: Mode debug  (Connexion RS-232C)
                      00090 ;
                      00091 ;                                       debug          normal
                      00092 ;
                      00093 ;La frequence de transmission serie     9600 bps       7812.5 bps.
                      00094 ;La tranmission des octets clavier      ASCII          binaires.
                      00095 ;La tranmission des octets souris       ASCII          binaires.
                      00096 ;L'emission de la chaine texte          'debug'        non
                      00097 ;**********************************************************************
                      00098 ;       Notes:
                      00099 ;       Crystal 4 Mhz, Bps rate for Atari = 7812.5
                      00100 ;                      Bps rate for RS232 = 9600
                      00101 ;
                      00102 ;       Serial frame:  1 Start bit, 8 bits Data, 1 bit Stop
                      00103 ;
                      00104 ;       Jumper4         =       Pin 4 Port B    (Disable state at 5V with pull-up)
                      00105 ;       Jumper5         =       Pin 5 Port B    (Disable state at 5V with pull-up)
                      00106 ;       LED green       =       Pin 6 Port B    (Enable state at 0V)
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00107 ;       LED yellow      =       Pin 7 Port B    (Enable state at 0V)
                      00108 ;**********************************************************************
                      00109 ; Voir le fichier technik.txt et evolution.txt
                      00110 ;**********************************************************************
                      00111 
Warning[215]: Processor superceded by command line.  Verify processor symbol.
                      00112                 PROCESSOR p16f876
                      00113                 RADIX dec
                      00114                 
                      00115 #include <p16f876.inc>                                  ; processor specific variable definitions
                      00001         LIST
                      00002 ; P16F876.INC  Standard Header File, Version 1.00    Microchip Technology, Inc.
                      00359         LIST
                      00116 #include <laurent.inc>                                  ; my include (Macros)
                      00001 ;**********************************************************************
                      00002 ;       Filename:           Laurent.inc
                      00003 ;       Date:           18 Juillet 2001
                      00004 ;       File Version:   25 Aout 2002
                      00005 ;
                      00006 ;       Author:                 Favard Laurent
                      00007 ;       Company:                None
                      00008 ;       Revision soft:  1.0.4
                      00009 ;       Revision board: A
                      00010 ;**********************************************************************
                      00011 ;       25/02/2002 -Ajout des macros  DISABLEKEYB and DISABLEMOUSE.
                      00012 ;       10/08/2002 -Ajout des macros  READ_FLASH, WRITE_FLASH, UDIV1608L
                      00013 ;                  -Ajout de toutes les commandes IKBD Atari
                      00014 ;       12/10/2002 -Ajout des macros  WAIT_KCLOCK_L, WAIT_KCLOCK_H
                      00015 ;                                     WAIT_MCLOCK_L, WAIT_MCLOCK_H
                      00016 ;**********************************************************************
                      00017 
  00000068            00018 VERSION                         EQU             0x68            ; version du firmware Eiffel
  00000019            00019 BAUD_9600                       EQU             0x19            ; Constant for baud generator 9600 baud 
                            at 4 Mhz
  0000001F            00020 BAUD_7812_5                     EQU             0x1F            ; Constant for baud generator 7812.5 bau
                            ds at 4 Mhz
  00000010            00021 TAILLE_TAMPON_EM                EQU             16              ; Taille tampon emission
                      00022 
                      00023 ;-----------------------------------------------------------------------------
                      00024 ; Pins assignements
                      00025 
  00000000            00026 RA0                 EQU     0
  00000001            00027 RA1                 EQU     1
  00000002            00028 RA2                 EQU     2
  00000003            00029 RA3                 EQU     3
  00000004            00030 RA4                 EQU     4
  00000005            00031 RA5                 EQU     5
  00000000            00032 RB0                 EQU     0
  00000001            00033 RB1                 EQU     1
  00000002            00034 RB2                 EQU     2
  00000003            00035 RB3                 EQU     3
  00000004            00036 RB4                 EQU     4
  00000005            00037 RB5                 EQU     5
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000006            00038 RB6                 EQU     6
  00000007            00039 RB7                 EQU     7
  00000000            00040 RC0                 EQU     0
  00000001            00041 RC1                 EQU     1
  00000002            00042 RC2                 EQU     2
  00000003            00043 RC3                 EQU     3
  00000004            00044 RC4                 EQU     4
  00000005            00045 RC5                 EQU     5
                      00046 
                      00047 ;-----------------------------------------------------------------------------
                      00048 ; Pins assignements with my nice Label
                      00049 
  00000001            00050 KCLOCK              EQU     RB1
  00000000            00051 KDATA               EQU     RB0
                      00052 
  00000003            00053 MCLOCK              EQU     RB3
  00000002            00054 MDATA               EQU     RB2
                      00055 
  00000005            00056 MOTORON             EQU     RC5
                      00057 
  00000035            00058 KM_DISABLE          EQU     0x35                ;b0011.0101 No devices communications (disable all clock
                            s)
                      00059 
                      00060 ;-----------------------------------------------------------------------------
                      00061 
  00000004            00062 JUMPER4             EQU     RB4                 ;Choix mode PS/2 (0V) directe OU tranlation ATARI (+5V)
  00000005            00063 JUMPER5             EQU     RB5                                 
                      00064 
  00000006            00065 LEDGREEN            EQU     RB6
  00000007            00066 LEDYELLOW           EQU     RB7
                      00067 
                      00068 ;-----------------------------------------------------------------------------
                      00069 
  00000080            00070 BIT_UN              EQU     0x80
  00000000            00071 BIT_ZERO            EQU     0x00
                      00072 
  0000008F            00073 MAX_VALUE_LOOKUP    EQU     0x8F 
                      00074 
  0000003A            00075 KEY_CAPSLOCK        EQU     0x3A                ;scancode PS2 touche Caps
                      00076 
  00000004            00077 LED_CAP             EQU     0x04
  00000002            00078 LED_NUM             EQU     0x02
  00000001            00079 LED_SCROLL          EQU     0x01
                      00080 
  00000000            00081 LEDS_OFF            EQU     0x00
  00000007            00082 LEDS_ON             EQU     LED_SCROLL | LED_CAP | LED_NUM
                      00083 
  00000006            00084 CAPS_ON             EQU     LED_CAP | LED_NUM   ;CAPS on, NUM on, scroll Off
  00000002            00085 CAPS_OFF                      EQU     LED_NUM   ;CAPS off, NUM on, scroll Off
                      00086 
                      00087 ;----- MyStatus Bits ----------------------------------------------------------
                      00088 
  00000000            00089 CAPS_LOCK                    EQU    0x00; memorise l'etat du CAPS LOCK
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000001            00090 MSWHEEL                      EQU    0x01; memorise si souris a roulette
  00000002            00091 MSWHEELPLUS                  EQU    0x02; roulette a 5 boutons/et 2eme roulette
  00000003            00092 MOUSE_ABS                    EQU    0x03; mode souris absolue IKBD
  00000004            00093 SIGN_Y                       EQU    0x04; sens axe Y souris
  00000005            00094 MOUSE_ENABLE                 EQU    0x05; autorisatin IKBD souris
  00000006            00095 JOY_ENABLE                   EQU    0x06; autorisation IKBD joysticks
  00000007            00096 IKBD_ENABLE                  EQU    0x07; autorisation envoi IKBD
                      00097 
                      00098 ;----- MyStatus2 Bits ---------------------------------------------------------
                      00099 
  00000000            00100 MOUSE_KEYS                   EQU    0x00; mode keycode souris IKBD
  00000001            00101 JOY_KEYS                     EQU    0x01; mode keycode joystick 0 IKBD
  00000002            00102 JOY_EVENT                    EQU    0x02; mode evemenents joysticks IKBD
  00000003            00103 JOY_MONITOR                  EQU    0x03; mode monitorig joysticks IKBD
  00000004            00104 BREAK_CODE                   EQU    0x04; touche enfonce(0)/relachee(1)
  00000005            00105 DATATOSEND                   EQU    0x05; donnees a envoyer sur la liaison serie
  00000006            00106 RESET_KEYB                   EQU    0x06; demande d'envoi commante reset clavier PS/2
  00000007            00107 RESET_MOUSE                  EQU    0x07; demande d'envoi commante reset souris PS/2
                      00108 
                      00109 ;----- MyStatus3 Bits ---------------------------------------------------------
                      00110 
                      00111 ; inutilise pour l'instant
                      00112 
                      00113 ;----- Status_Boot Bits -------------------------------------------------------
                      00114 
  00000006            00115 POWERUP_KEYB                 EQU    0x06; mis a 1 des reception commande BAT clavier
  00000007            00116 POWERUP_MOUSE                EQU    0x07; mis a 1 des reception commande BAT souris 
                      00117                                                                           
                      00118 ;----- MyStatus_JOY Bits ------------------------------------------------------
                      00119 
  00000000            00120 RY_H                         EQU    0x00
  00000001            00121 RY_B                         EQU    0x01
  00000002            00122 RX_G                         EQU    0x02
  00000003            00123 RX_D                         EQU    0x03
  00000004            00124 TY_H                         EQU    0x04
  00000005            00125 TY_B                         EQU    0x05
  00000006            00126 TX_G                         EQU    0x06
  00000007            00127 TX_D                         EQU    0x07    
                      00128 
                      00129 ;----- IKBD commandes ---------------------------------------------------------
                      00130 ;                                          * = gere
  00000003            00131 IKBD_GETTEMP                 EQU    0x03 ; *
  00000004            00132 IKBD_PROGTEMP                EQU    0x04 ; *
  00000005            00133 IKBD_PROGKB                  EQU    0x05 ; *
  00000006            00134 IKBD_PROGMS                  EQU    0x06 ; *
  00000007            00135 IKBD_SET_MOUSE_BUTTON_ACTION EQU    0x07 ; *
  00000008            00136 IKBD_REL_MOUSE_POS_REPORT    EQU    0x08 ; *
  00000009            00137 IKBD_ABS_MOUSE_POSITIONING   EQU    0x09 ; *
  0000000A            00138 IKBD_SET_MOUSE_KEYCODE_CODE  EQU    0x0A ; *
  0000000B            00139 IKBD_SET_MOUSE_THRESHOLD     EQU    0x0B
  0000000C            00140 IKBD_SET_MOUSE_SCALE         EQU    0x0C ; *
  0000000D            00141 IKBD_INTERROGATE_MOUSE_POS   EQU    0x0D ; *
  0000000E            00142 IKBD_LOAD_MOUSE_POS          EQU    0x0E ; *
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000000F            00143 IKBD_SET_Y0_AT_BOTTOM        EQU    0x0F ; *
  00000010            00144 IKBD_SET_Y0_AT_TOP           EQU    0x10 ; *
  00000011            00145 IKDB_RESUME                  EQU    0x11 ; *
  00000012            00146 IKDB_DISABLE_MOUSE           EQU    0x12 ; *
  00000013            00147 IKDB_PAUSE_OUTPUT            EQU    0x13 ; *
  00000014            00148 IKBD_SET_JOY_EVNT_REPORT     EQU    0x14 ; *
  00000015            00149 IKBD_SET_JOY_INTERROG_MODE   EQU    0x15 ; *
  00000016            00150 IKBD_JOY_INTERROG            EQU    0x16 ; *
  00000017            00151 IKBD_SET_JOY_MONITOR         EQU    0x17 ; *
  00000018            00152 IKBD_SET_FIRE_BUTTON_MONITOR EQU    0x18
  00000019            00153 IKBD_SET_JOY_KEYCODE_MODE    EQU    0x19 ; *
  0000001A            00154 IKDB_DISABLE_JOYSTICKS       EQU    0x1A ; *
  0000001B            00155 IKBD_TIME_OF_DAY_CLOCK_SET   EQU    0x1B ; *
  0000001C            00156 IKBD_INTERROG_TIME_OF_DAY    EQU    0x1C ; *
  00000020            00157 IKBD_MEMORY_LOAD             EQU    0x20 ; *
  00000021            00158 IKBD_MEMORY_READ             EQU    0x21 ; *
  00000022            00159 IKBD_CONTROLLER_EXECUTE      EQU    0x22
  00000080            00160 IKBD_RESET                   EQU    0x80 ; *
  00000087            00161 IKBD_STATUS_MOUSE_BUT_ACTION EQU    0x87 ; *
  00000088            00162 IKBD_STATUS_MOUSE_MODE_R     EQU    0x88 ; *
  00000089            00163 IKBD_STATUS_MOUSE_MODE_A     EQU    0x89 ; *
  0000008A            00164 IKBD_STATUS_MOUSE_MODE_K     EQU    0x8A ; *
  0000008B            00165 IKBD_STATUS_MOUSE_THRESHOLD  EQU    0x8B ; *
  0000008C            00166 IKBD_STATUS_MOUSE_SCALE      EQU    0x8C ; *
  0000008F            00167 IKBD_STATUS_MOUSE_Y0_AT_B    EQU    0x8F ; *
  00000090            00168 IKBD_STATUS_MOUSE_Y0_AT_T    EQU    0x90 ; *
  00000092            00169 IKDB_STATUS_DISABLE_MOUSE    EQU    0x92 ; *
  00000094            00170 IKBD_STATUS_JOY_MODE_E       EQU    0x94 ; *
  00000095            00171 IKBD_STATUS_JOY_MODE_I       EQU    0x95 ; *
  00000099            00172 IKBD_STATUS_JOY_MODE_K       EQU    0x99 ; *
  0000009A            00173 IKDB_STATUS_DISABLE_JOY      EQU    0x9A ; *
                      00174 
                      00175 ;----- IKBD trames ------------------------------------------------------------
                      00176 
  000000F6            00177 HEADER_STATUS                EQU    0xF6 ; status report
  000000F7            00178 HEADER_ABSOLUTE_MOUSE        EQU    0xF7 ; absolute mouse position record
  000000F8            00179 HEADER_RELATIVE_MOUSE        EQU    0xF8 ; relative mouse position records
  000000FC            00180 HEADER_TIME_OF_DAY           EQU    0xFC ; time-of-day
  000000FD            00181 HEADER_JOYSTICKS             EQU    0xFD ; joystick report (both sticks)
  000000FE            00182 HEADER_JOYSTICK0             EQU    0xFE ; joystick 0 event
  000000FF            00183 HEADER_JOYSTICK1             EQU    0xFF ; joystick 1 event
                      00184 
                      00185 ;----- Commandes Clavier PS2 --------------------------------------------------
                      00186 
  000000ED            00187 SET_RESET_LEDS               EQU    0xED
  000000EE            00188 ECHO                         EQU    0xEE
  000000F0            00189 SET_SCAN_CODE_SET            EQU    0xF0
  000000F2            00190 READ_ID                      EQU    0xF2
  000000F3            00191 SET_TYPEMATIC_RATE_DELAY     EQU    0xF3
  000000F4            00192 ENABLE                       EQU    0xF4
  000000F5            00193 DEFAULT_DISABLE              EQU    0xF5
  000000F6            00194 SET_DEFAULT                  EQU    0xF6
  000000F7            00195 SET_ALL_KEYS_TYPEMATIC       EQU    0xF7
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  000000F8            00196 SET_ALL_KEYS_MAKE_BREAK      EQU    0xF8
  000000F9            00197 SET_ALL_KEYS_MAKE            EQU    0xF9
  000000FA            00198 SET_ALL_KEYS_TYP_MAKE_BRK    EQU    0xFA
  000000FB            00199 SET_KEY_TYPE_TYPEMATIC       EQU    0xFB
  000000FC            00200 SET_KEY_MAKE_BREAK           EQU    0xFC
  000000FD            00201 SET_KEY_TYPE_MAKE            EQU    0xFD
  000000FE            00202 RESEND                       EQU    0xFE
  000000FF            00203 RESET                        EQU    0xFF
                      00204 
                      00205 ;----- Commandes Souris PS2 ---------------------------------------------------
                      00206 
  000000E9            00207 STATUS_REQUEST               EQU    0xE9
  000000EA            00208 SET_STREAM_MODE              EQU    0xEA
  000000EB            00209 READ_DATA                    EQU    0xEB
  000000EE            00210 SET_WRAP_MODE                EQU    0xEE
  000000F0            00211 SET_REMOTE_MODE              EQU    0xF0
  000000F2            00212 GET_DEVICE_ID                EQU    0xF2
  000000F3            00213 SET_SAMPLE_RATE              EQU    0xF3
  000000F4            00214 ENABLE_DATA_REPORTING        EQU    0xF4
  000000F5            00215 DISABLE_DATA_REPORTING       EQU    0xF5
  000000F6            00216 SET_DEFAULTS                 EQU    0xF6
                      00217 ;RESEND                      EQU    0xFE
                      00218 ;RESET                       EQU    0xFF
                      00219 
                      00220 ;------------------------------------------------------------------------------
                      00221 ;   PS/2 Devices commands
                      00222 
                      00223 #define         CMD_LED             0xED ; allumage des LEDs
                      00224 #define         CMD_BAT             0xAA ; Commande on BAT du clavier
                      00225 #define         CMD_SET             0xF0
                      00226 #define         CMD_GETDEVID        0xF2 ; get device ID
                      00227 #define         CMD_STTPMTRATE      0xF3 ; vitesse de repetition clavier
                      00228 #define         CMD_SETSMPRT        0xF3 ; vitesse echantillonnage souris
                      00229 #define         CMD_MKBRK           0xF8
                      00230 #define         CMD_TMMKBRK         0xFA ; all key typematic/make/break
                      00231 #define         CMD_ENABLE          0xF4
                      00232 
                      00233 #define         CMD_RELEASED        0xF0 ; Key depressed
                      00234 
                      00235 #define         SCANCODESET3        0x03 ; scan-codes set 3
                      00236 #define         CPS_30                20 ; 30 caracteres par seconde
                      00237 
                      00238 #define         MS_PS2              0x00 ; ID retournee par une souris standard
                      00239 #define         MS_WHEEL            0x03 ; ID retournee par une souris molette 3 b.
                      00240 #define         MS_WHEELPLUS        0x04 ; ID retournee par une souris molette(s) 5 b.
                      00241 
                      00242 ;-----------------------------------------------------------------------------
                      00243 ;       definitions souris PS/2 et atari
                      00244 
                      00245 ;Position bits et scan-codes Atari
                      00246 #define         AT_MOUSE            0xF8
                      00247 #define         AT_LEFT                1
                      00248 #define         AT_RIGHT               0
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00249 #define         AT_SIGN                7
                      00250 
                      00251 ;----- Sous-commandes Eiffel Program Temp Flash Data ---------------------
                      00252 
  00000000            00253 IDX_LEVELHTEMP               EQU    0x00; seuil maxi de temperature
  00000001            00254 IDX_LEVELLTEMP               EQU    0x01; seuil mini de temperature
  00000002            00255 IDX_T0_AN0                   EQU    0x02; valeur AN0 pour 0 degres
  00000003            00256 IDX_SCALETEMP                EQU    0x03; facteur d'echelle temperature
                      00257 
                      00258 ;----- Sous-commandes Eiffel Program Mouse Flash Data --------------------
                      00259 
  00000000            00260 IDX_WHEELUP                  EQU    0x00; Eiffel 1.0.0
  00000001            00261 IDX_WHEELDN                  EQU    0x01; Eiffel 1.0.1 ( v1.0.0 retournait 0x60 )
  00000002            00262 IDX_WHEELLT                  EQU    0x02; Eiffel 1.0.3 seulement
  00000003            00263 IDX_WHEELRT                  EQU    0x03; Eiffel 1.0.3 seulement
  00000004            00264 IDX_BUTTON3                  EQU    0x04; Eiffel 1.0.3 scan-code bouton Central
  00000005            00265 IDX_BUTTON4                  EQU    0x05; Eiffel 1.0.3 scan-code bouton 4
  00000006            00266 IDX_BUTTON5                  EQU    0x06; Eiffel 1.0.3 scan-code bouton 5
  00000007            00267 IDX_WHREPEAT                 EQU    0x07; Eiffel 1.0.3 Nombre de repetition 
                      00268 
                      00269 ;----- Sous-commandes Eiffel Program Keyboard Flash Data ( 0x00 - 0x8F) --
                      00270 
  00000056            00271 IDX_F11                      EQU    0x56
  0000005E            00272 IDX_F12                      EQU    0x5E
  00000057            00273 IDX_PRNTSCREEN               EQU    0x57
  0000005F            00274 IDX_SCROLL                   EQU    0x5F
  00000062            00275 IDX_PAUSE                    EQU    0x62
  0000008B            00276 IDX_WLEFT                    EQU    0x8B
  0000008C            00277 IDX_WRIGHT                   EQU    0x8C
  0000008D            00278 IDX_WAPP                     EQU    0x8D
  00000076            00279 IDX_VERRN                    EQU    0x76
  00000039            00280 IDX_ALTGR                    EQU    0x39
  0000006F            00281 IDX_PAGEUP                   EQU    0x6F
  0000006D            00282 IDX_PAGEDN                   EQU    0x6D
  00000065            00283 IDX_END                      EQU    0x65
  0000000E            00284 IDX_RUSSE                    EQU    0x0E
                      00285 
                      00286 ;----- Valeurs par defaut scan-code souris -------------------------------
                      00287 
  00000059            00288 DEF_WHEELUP                  EQU    0x59
  0000005A            00289 DEF_WHEELDN                  EQU    0x5A
  0000005C            00290 DEF_WHEELLT                  EQU    0x5C
  0000005D            00291 DEF_WHEELRT                  EQU    0x5D
  00000037            00292 DEF_BUTTON3                  EQU    0x37
  0000005E            00293 DEF_BUTTON4                  EQU    0x5E
  0000005F            00294 DEF_BUTTON5                  EQU    0x5F
  00000003            00295 DEF_WHREPEAT                 EQU    0x03
                      00296 
  0000004C            00297 DEF_SCROLL                   EQU    0x4C
  00000045            00298 DEF_PAGEUP                   EQU    0x45
  00000046            00299 DEF_PAGEDN                   EQU    0x46
  00000055            00300 DEF_END                      EQU    0x55
  00000049            00301 DEF_PRINTSCREEN              EQU    0x49
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000004F            00302 DEF_PAUSE                    EQU    0x4F
  00000054            00303 DEF_VERRNUM                  EQU    0x54
  00000056            00304 DEF_WINLEFT                  EQU    0x56
  00000057            00305 DEF_WINRIGHT                 EQU    0x57
  00000058            00306 DEF_WINAPP                   EQU    0x58
  0000005B            00307 DEF_RUSSE                    EQU    0x5B
  00000038            00308 DEF_ALTGR                    EQU    0x38   ; Alt Atari
  00000062            00309 DEF_F11                      EQU    0x62   ; Help Atari
  00000061            00310 DEF_F12                      EQU    0x61   ; Undo Atari
                      00311 
                      00312 ;-----------------------------------------------------------------------------
                      00313 ;   Scan-code inactivite
                      00314 #define             AT_WHEELNOT                 0x00            ;Eiffel 1.0.0
                      00315 
                      00316 ;-----------------------------------------------------------------------------
                      00317 ;Position bits PS/2 dans les paquets
                      00318 #define             PC_BITLSBZ          0                               ;BIT 0 pour vertical/horizontal 
                            molete detection
                      00319 #define             PC_LEFT             0                               ;BIT bouton souris
                      00320 #define             PC_RIGHT            1                               ;BIT bouton souris
                      00321 #define             PC_MIDDLE           2                               ;BIT bouton souris
                      00322 #define             PC_BUTTON4          4                               ;BIT bouton souris molette plus
                      00323 #define             PC_BUTTON5          5                               ;BIT bouton souris molette plus
                      00324 #define             PC_SIGNX            4                               ;BIT signe mouvement souris en X
                      00325 #define             PC_SIGNY            5                               ;BIT signe mouvement souris en Y
                      00326 #define             PC_SIGNZ            3                               ;BIT signe mouvement souris mole
                            tte et combine
                      00327 
                      00328 ;-----------------------------------------------------------------------------
                      00329 
                      00330 DISABLEPS2      MACRO
                      00331                 bsf STATUS,RP0; page 1
                      00332                 bcf TRISB,KCLOCK; en sortie
                      00333                 bcf TRISB,MCLOCK; en sortie
                      00334                 bcf STATUS,RP0; page 0
                      00335                 bcf PORTB,KCLOCK
                      00336                 bcf PORTB,MCLOCK
                      00337                 ENDM
                      00338                 
                      00339 ENABLEPS2       MACRO
                      00340                 bsf STATUS,RP0; page 1
                      00341                 bsf TRISB,KCLOCK; en entree
                      00342                 bsf TRISB,MCLOCK; en entree
                      00343                 bcf STATUS,RP0; page 0
                      00344                 ENDM
                      00345 
                      00346 ENABLEMOUSE     MACRO
                      00347                 bsf STATUS,RP0; page 1
                      00348                 bsf TRISB,MCLOCK; en entree
                      00349                 bcf STATUS,RP0; page 0
                      00350                 ENDM
                      00351 
                      00352 ENABLEKEYB      MACRO
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00353                 bsf STATUS,RP0; page 1
                      00354                 bsf TRISB,KCLOCK; en entree
                      00355                 bcf STATUS,RP0; page 0
                      00356                 ENDM
                      00357 
                      00358 DISABLEMOUSE    MACRO
                      00359                 bsf STATUS,RP0; page 1
                      00360                 bcf TRISB,MCLOCK; en sortie
                      00361                 bcf STATUS,RP0; page 0
                      00362                 bcf PORTB,MCLOCK
                      00363                 ENDM
                      00364                 
                      00365 DISABLEKEYB     MACRO
                      00366                 bsf STATUS,RP0; page 1
                      00367                 bcf TRISB,KCLOCK; en sortie
                      00368                 bcf STATUS,RP0; page 0
                      00369                 bcf PORTB,KCLOCK
                      00370                 ENDM    
                      00371 
                      00372 ;-----------------------------------------------------------------------------
                      00373 ;Macros to select the register bank
                      00374 ;Many bank changes can be optimised when only one STATUS bit changes
                      00375 
                      00376 Bank0               MACRO                       ;macro to select data RAM bank 0
                      00377                             bcf STATUS,RP0
                      00378                             bcf STATUS,RP1
                      00379                             ENDM
                      00380 
                      00381 Bank1               MACRO                       ;macro to select data RAM bank 1
                      00382                             bsf STATUS,RP0
                      00383                             bcf STATUS,RP1
                      00384                             ENDM
                      00385 
                      00386 Bank2               MACRO                       ;macro to select data RAM bank 2
                      00387                             bcf STATUS,RP0
                      00388                             bsf STATUS,RP1
                      00389                             ENDM
                      00390 
                      00391 Bank3               MACRO                       ;macro to select data RAM bank 3
                      00392                             bsf STATUS,RP0
                      00393                             bsf STATUS,RP1
                      00394                             ENDM
                      00395 
                      00396 ;-----------------------------------------------------------------------------
                      00397 
                      00398 CheckG              MACRO   PIN
                      00399                     btfsc   PORTB,PIN
                      00400                     goto    $ + 3
                      00401                     bcf     PORTB,RB6
                      00402                     goto    $ + 2
                      00403                     bsf     PORTB,RB6
                      00404                     ENDM
                      00405         
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00406 ;-----------------------------------------------------------------------------
                      00407 
                      00408 CheckY              MACRO   PIN
                      00409                     btfsc   PORTB,PIN
                      00410                     goto    $ + 3
                      00411                     bcf     PORTB,RB7
                      00412                     goto    $ + 2
                      00413                     bsf     PORTB,RB7
                      00414                     ENDM
                      00415 
                      00416 ;-----------------------------------------------------------------------------
                      00417 ; Attente fronts horloge clavier
                      00418                     
                      00419 WAIT_KCLOCK_L   MACRO
                      00420                 LOCAL WKCL1,WKCL2
                      00421                 IF NON_BLOQUANT
                      00422                 clrf Counter2; time-out
                      00423 WKCL1
                      00424                         btfss PORTB,KCLOCK; attente front descendant de CLK
                      00425                                 goto WKCL2
                      00426                         decfsz Counter2,F
                      00427                 goto WKCL1
                      00428 WKCL2
                      00429                 ELSE
                      00430                 btfsc PORTB,KCLOCK; attente front descendant de CLK
                      00431                         goto $ -1
                      00432                 ENDIF
                      00433                 ENDM
                      00434                 
                      00435 WAIT_KCLOCK_H   MACRO
                      00436                 LOCAL WKCH1,WKCH2
                      00437                 IF NON_BLOQUANT
                      00438                 clrf Counter2; time-out
                      00439 WKCH1
                      00440                         btfsc PORTB,KCLOCK; attente front montant de CLK
                      00441                                 goto WKCH2
                      00442                         decfsz Counter2,F
                      00443                 goto WKCH1
                      00444 WKCH2
                      00445                 ELSE
                      00446                 btfss PORTB,KCLOCK; attente front montant de CLK
                      00447                         goto $ -1
                      00448                 ENDIF
                      00449                 ENDM
                      00450                 
                      00451 ;-----------------------------------------------------------------------------
                      00452 ; Attente fronts horloge souris
                      00453                     
                      00454 WAIT_MCLOCK_L   MACRO
                      00455                 LOCAL WMCL1,WMCL2
                      00456                 IF NON_BLOQUANT
                      00457                 clrf Counter2; time-out
                      00458 WMCL1
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00459                         btfss PORTB,MCLOCK; attente front descendant de CLK
                      00460                                 goto WMCL2
                      00461                         decfsz Counter2,F
                      00462                 goto WMCL1
                      00463 WMCL2
                      00464                 ELSE
                      00465                 btfsc PORTB,MCLOCK; attente front descendant de CLK
                      00466                         goto $ -1
                      00467                 ENDIF
                      00468                 ENDM
                      00469                 
                      00470 WAIT_MCLOCK_H   MACRO
                      00471                 LOCAL WMCH1,WMCH2
                      00472                 IF NON_BLOQUANT
                      00473                 clrf Counter2; time-out
                      00474 WMCH1
                      00475                         btfsc PORTB,MCLOCK; attente front montant de CLK
                      00476                                 goto WMCH2
                      00477                         decfsz Counter2,F
                      00478                 goto WMCH1
                      00479 WMCH2
                      00480                 ELSE
                      00481                 btfss PORTB,MCLOCK; attente front montant de CLK
                      00482                         goto $ -1
                      00483                 ENDIF
                      00484                 ENDM
                      00485                     
                      00486 ;-----------------------------------------------------------------------------
                      00487 ;       Lit dans l'EEPROM DATA la valeur stockee a l'Adresse du litteral Adresse
                      00488 ;   et retourne dans W le resultat.
                      00489 
                      00490 RDEEPROM            MACRO       Adresse
                      00491                             bsf     STATUS,RP1
                      00492                             bcf     STATUS,RP0
                      00493                             movlw   Adresse
                      00494                             movwf       EEADR
                      00495 
                      00496                             bsf     STATUS,RP0
                      00497                             bcf     EECON1,EEPGD
                      00498                             bsf     EECON1,RD
                      00499 
                      00500                             bcf     STATUS,RP0
                      00501                             movf        EEDATA,w
                      00502 
                      00503                             bcf     STATUS,RP0
                      00504                             bcf     STATUS,RP1
                      00505                             ENDM
                      00506                             
                      00507 ;-----------------------------------------------------------------------------
                      00508 ;       Lit dans l'EEPROM DATA la valeur stockee a l'Adresse presente dans W
                      00509 ;   et retourne dans W le resultat.
                      00510 
                      00511 RDEEPROM2       MACRO
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00512                 bsf STATUS,RP1; page 2
                      00513                 bcf STATUS,RP0;
                      00514                 movwf EEADR
                      00515                 bsf STATUS,RP0; page 3
                      00516                 bcf EECON1,EEPGD; EEPROM
                      00517                 bsf EECON1,RD; lecture
                      00518                 bcf STATUS,RP0; page 2
                      00519                 movf EEDATA,W
                      00520                 bcf STATUS,RP1; page 0
                      00521                 ENDM
                      00522 
                      00523 ;-----------------------------------------------------------------------------
                      00524 ;       Ecrit dans l'EEPROM DATA la valeur dans DATA, a l'adresse dans ADR
                      00525 
                      00526 WREEPROM        MACRO ADR,DATA
                      00527                 LOCAL WE1,WE2
                      00528                 bsf STATUS,RP1; page 3
                      00529                 bsf STATUS,RP0 
                      00530 WE1             btfsc EECON1,WR; attente ecriture
                      00531                 goto WE1
                      00532                 bcf STATUS,RP0; page 2
                      00533                 movf ADR,W; adresse
                      00534                 movwf EEADR
                      00535                 movf DATA,W; donnee a ecrire
                      00536                 movwf EEDATA
                      00537                 bsf STATUS,RP0; page 3
                      00538                 bcf EECON1,EEPGD; EEPROM
                      00539                 bsf EECON1,WREN; autorise ecriture
                      00540                 movlw 0x55
                      00541                 movwf EECON2
                      00542                 movlw 0xAA
                      00543                 movwf EECON2
                      00544                 bsf EECON1,WR; commence ecriture
                      00545                 bcf EECON1,WREN; enleve autorisation ecriture
                      00546 WE2             btfsc EECON1,WR; attente ecriture
                      00547                 goto WE2
                      00548                 bcf STATUS,RP0; page 0
                      00549                 bcf STATUS,RP1
                      00550                 ENDM
                      00551 
                      00552 ;-----------------------------------------------------------------------------
                      00553 
                      00554 READ_FLASH      MACRO ADRH,ADRL,DATAADR
                      00555                 bsf STATUS,RP1; page 2
                      00556                 bcf STATUS,RP0;
                      00557                 movf ADRH,W
                      00558                 movwf EEADRH; adresse en FLASH
                      00559                 movf ADRL,W
                      00560                 movwf EEADR
                      00561                 bsf STATUS,RP0; page 3
                      00562                 bsf EECON1,EEPGD; FLASH
                      00563                 bsf EECON1,RD; lecture
                      00564                 nop
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00565                 nop
                      00566                 bcf STATUS,RP0; page 2
                      00567                 movf EEDATA,W
                      00568                 movwf DATAADR; 1er octet a lire (poids faible)
                      00569                 movf EEDATH,W
                      00570                 movwf DATAADR+1; 2eme octet a lire (poids fort)
                      00571                 bcf STATUS,RP1; page 0
                      00572                 ENDM
                      00573 
                      00574 ;-----------------------------------------------------------------------------
                      00575 
                      00576 WRITE_FLASH     MACRO ADRH,ADRL,DATAADR
                      00577                 bsf STATUS,RP1; page 2
                      00578                 bcf STATUS,RP0 
                      00579                 movf ADRH,W
                      00580                 movwf EEADRH; adresse en FLASH
                      00581                 movf ADRL,W
                      00582                 movwf EEADR
                      00583                 movf DATAADR,W; 1er octet a ecrire (poids faible)
                      00584                 movwf EEDATA
                      00585                 movf DATAADR+1,W; 2eme octet a ecrire (poids fort)
                      00586                 movwf EEDATH
                      00587                 bsf STATUS,RP0; page 3
                      00588                 bsf EECON1,EEPGD; FLASH
                      00589                 bsf EECON1,WREN; autorise ecriture
                      00590                 movlw 0x55
                      00591                 movwf EECON2
                      00592                 movlw 0xAA
                      00593                 movwf EECON2
                      00594                 bsf EECON1,WR; commence ecriture
                      00595                 nop
                      00596                 nop
                      00597                 bcf EECON1,WREN; enleve autorisation ecriture
                      00598                 bcf STATUS,RP0; page 0
                      00599                 bcf STATUS,RP1
                      00600                 ENDM
                      00601 
                      00602 ;-----------------------------------------------------------------------------
                      00603 Delay           macro   Time            ;Delay "Cycles" instruction cycles
                      00604 
                      00605     if (Time==1)
                      00606           nop
                      00607           exitm
                      00608     endif
                      00609     if (Time==2)
                      00610           goto $ + 1
                      00611           exitm
                      00612     endif
                      00613     if (Time==3)
                      00614           nop
                      00615           goto $ + 1
                      00616           exitm
                      00617     endif
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00618     if (Time==4)
                      00619           goto $ + 1
                      00620           goto $ + 1
                      00621           exitm
                      00622     endif
                      00623     if (Time==5)
                      00624           goto $ + 1
                      00625           goto $ + 1
                      00626           nop
                      00627           exitm
                      00628     endif
                      00629     if (Time==6)
                      00630           goto $ + 1
                      00631           goto $ + 1
                      00632           goto $ + 1
                      00633           exitm
                      00634     endif
                      00635     if (Time==7)
                      00636           goto $ + 1
                      00637           goto $ + 1
                      00638           goto $ + 1
                      00639           nop
                      00640           exitm
                      00641     endif
                      00642     if (Time%4==0)
                      00643           movlw (Time-4)/4
                      00644           call Delay_Routine
                      00645           exitm
                      00646     endif
                      00647     if (Time%4==1)
                      00648           movlw (Time-5)/4
                      00649           call Delay_Routine
                      00650           nop
                      00651           exitm
                      00652     endif
                      00653     if (Time%4==2)
                      00654           movlw (Time-6)/4
                      00655           call Delay_Routine
                      00656           goto $ + 1
                      00657           exitm
                      00658     endif
                      00659     if (Time%4==3)
                      00660           movlw (Time-7)/4
                      00661           call Delay_Routine
                      00662           goto $ + 1
                      00663           nop
                      00664           exitm
                      00665     endif
                      00666     endm
                      00667 
                      00668 ;------------------------------------------------------------------------
                      00669 
                      00670 UDIV1608L       MACRO AARGB0,AARGB1,BARGB0,REMB0; AARGB0-1 / ARGB0 -> AARGB0-1
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00671                 LOCAL LOOPU1608A,UOK68A,LOOPU1608B,UOK68B
                      00672                 clrf REMB0
                      00673                 movlw 8
                      00674                 movwf Counter
                      00675 LOOPU1608A              rlf AARGB0,W
                      00676                         rlf REMB0,F
                      00677                         movf BARGB0,W
                      00678                         subwf REMB0,F
                      00679                         btfsc STATUS,C
                      00680                                 goto UOK68A
                      00681                         addwf REMB0,F
                      00682                         bcf STATUS,C
                      00683 UOK68A                  rlf AARGB0,F
                      00684                         decfsz Counter,F
                      00685                 goto  LOOPU1608A
                      00686                 clrf  TEMP1
                      00687                 movlw 8
                      00688                 movwf Counter
                      00689 LOOPU1608B              rlf AARGB1,W
                      00690                         rlf REMB0,F
                      00691                         rlf TEMP1,F
                      00692                         movf BARGB0,W
                      00693                         subwf REMB0,F
                      00694                         clrf TEMP2
                      00695                         clrw
                      00696                         btfss STATUS,C
                      00697                                 incfsz TEMP2,W
                      00698                         subwf TEMP1,F
                      00699                         btfsc STATUS,C
                      00700                                 goto UOK68B
                      00701                         movf BARGB0,W
                      00702                         addwf REMB0,F
                      00703                         clrf TEMP2
                      00704                         clrw
                      00705                         btfsc STATUS,C
                      00706                                 incfsz TEMP2,W
                      00707                         addwf TEMP1,F
                      00708                         bcf STATUS,C
                      00709 UOK68B                  rlf AARGB1,F
                      00710                         decfsz Counter,F
                      00711                 goto  LOOPU1608B
                      00712                 ENDM
                      00713                 
                      00714 
                      00715 
                      00117 
                      00118                 LIST      P=16F876                      ; list directive to define processor
                      00119 
2007   3F31           00120                 __CONFIG _CP_OFF & _DEBUG_OFF & _WRT_ENABLE_ON & _CPD_OFF & _LVP_OFF & _BODEN_OFF & _PWR
                            TE_ON & _WDT_OFF & _XT_OSC
                      00121 
                      00122 ;----- Flags compilation -------------------------------------------------
                      00123 
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000000            00124 DEBUG_CODE                   EQU     0; si 0, PORTB4 & PORTB5 enleves, mode Atari seulement
  00000000            00125 SCROOL_LOCK_ERR              EQU     0; si 1, utilise pour afficher les erreurs parite souris PS/2
                      00126                                       ;       sur la led Scroll Lock du clavier
  00000000            00127 NON_BLOQUANT                 EQU     0; si 1, routines PS/2 non bloquantes (time-out)
  00000001            00128 PS2_ALTERNE                  EQU     1; si 1, gestion alternee clavier et souris PS/2 
                      00129 
                      00130 ;----- Variables ---------------------------------------------------------
                      00131 
                      00132 ; page 0 (utilisable a partir de 0x20)
  00000020            00133 Status_Boot                  EQU    0x20; remis a 0 au reset
  00000021            00134 Info_Boot                    EQU    0x21; mis a 0xFF si le programme demarre sur la page 2 en Flash
  00000022            00135 Val_AN0                      EQU    0x22; lecture CTN sur AN0
  00000023            00136 BUTTONS                      EQU    0x23; etat des boutons souris
  00000024            00137 OLD_BUTTONS                  EQU    0x24; ancien etat des boutons souris
  00000025            00138 OLD_BUTTONS_ABS              EQU    0x25; ancien etat des boutons souris en mode absolu
  00000026            00139 JOY0                         EQU    0x26; lecture joystick 0
  00000026            00140 JOYB                         EQU    0x26; = JOY0, juste pour tester eventuellement avec JOY1
  00000027            00141 JOY1                         EQU    0x27; lecture joystick 1
  00000028            00142 TAMPON_EM                    EQU    0x28; buffer circulaire de 16 octets liaison serie (TAILLE_TAMPON_EM
                             dans laurent.inc)
  00000038            00143 DEB_INDEX_EM                 EQU    0x38; index courant donnee a envoyer buffer circulaire liaison serie
  00000039            00144 FIN_INDEX_EM                 EQU    0x39; fin index donnee a envoyer buffer circulaire liaison serie
  0000003A            00145 YEAR_BCD                     EQU    0x3A; annee, conserver cet ordre pour les 6 variables BCD
  0000003B            00146 MONTH_BCD                    EQU    0x3B; mois
  0000003C            00147 DAY_BCD                      EQU    0x3C; jour
  0000003D            00148 HRS_BCD                      EQU    0x3D; heures
  0000003E            00149 MIN_BCD                      EQU    0x3E; minutes
  0000003F            00150 SEC_BCD                      EQU    0x3F; secondes
  00000040            00151 HEADER_IKBD                  EQU    0x40; entete trame envoyee au host IKBD
  00000041            00152 KEY_MOUSE_WHEEL              EQU    0x41; scan-code movement des molettes (Wheel&Wheel+)
  00000042            00153 KEY2_MOUSE_WHEEL             EQU    0x42; octet supplementaire: Scan-code bouton 4 ou 5 (Wheel+)
  00000043            00154 CLIC_MOUSE_WHEEL             EQU    0x43; octet supplementaire: Scan-code bouton central
  00000044            00155 Value_0                      EQU    0x44; 1er octet reception trame souris PS/2
  00000045            00156 Value_X                      EQU    0x45; 2eme octet reception trame souris PS/2
  00000046            00157 Value_Y                      EQU    0x46; 3eme octet reception trame souris PS/2
  00000047            00158 Value_Z                      EQU    0x47; 4eme octet eventuel reception trame souris PS/2
  00000048            00159 Counter_Mouse                EQU    0x48; compteur octet reception trame souris PS/2
  00000049            00160 Temp                         EQU    0x49; lecture temperature CTN sur AN0
  0000004A            00161 Rate_Joy                     EQU    0x4A; temps monitoring joystick IKBD
  0000004B            00162 Counter_5MS                  EQU    0x4B; prediviseur horloge et base de temps 5 mS
  0000004C            00163 Counter_10MS_Joy_Monitor     EQU    0x4C; compteur delais envoi monitoring joysticks
  0000004D            00164 Counter3                     EQU    0x4D; compteur boucles
  0000004E            00165 Counter_10MS_Joy             EQU    0x4E; prediviseur envoi mode keycode joystick 0 (pas de 100 mS)
  0000004F            00166 Counter_100MS_Joy            EQU    0x4F; compteur 100 mS mode keycode joystick 0
  00000050            00167 RX_JOY                       EQU    0x50; temps RX mode keycode joystick 0 IKBD
  00000051            00168 RY_JOY                       EQU    0x51; temps RY mode keycode joystick 0 IKBD
  00000052            00169 TX_JOY                       EQU    0x52; temps TX mode keycode joystick 0 IKBD
  00000053            00170 TY_JOY                       EQU    0x53; temps TY mode keycode joystick 0 IKBD
  00000054            00171 VX_JOY                       EQU    0x54; temps VX mode keycode joystick 0 IKBD
  00000055            00172 VY_JOY                       EQU    0x55; temps VY mode keycode joystick 0 IKBD
  00000056            00173 Status_Joy                   EQU    0x56; flags joystick 0 mode keycode
  00000057            00174 OLD_JOY                      EQU    0x57; ancien etat boutons joystick 0 mode keycode
  00000058            00175 START_RX_JOY                 EQU    0x58; valeur de demarrage tempo RX mode keycode joystick 0
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000059            00176 START_RY_JOY                 EQU    0x59; valeur de demarrage tempo RY mode keycode joystick 0
  0000005A            00177 START_TX_JOY                 EQU    0x5A; valeur de demarrage tempo TX mode keycode joystick 0
  0000005B            00178 START_TY_JOY                 EQU    0x5B; valeur de demarrage tempo TY mode keycode joystick 0
  0000005C            00179 X_SCALE                      EQU    0x5C; facteur d'echelle en X souris mode absolu
  0000005D            00180 Y_SCALE                      EQU    0x5D; facteur d'echelle en Y souris mode absolu
  0000005E            00181 X_POSH                       EQU    0x5E; position X absolue souris poids fort
  0000005F            00182 X_POSL                       EQU    0x5F; position X absolue souris poids faible
  00000060            00183 Y_POSH                       EQU    0x60; position Y absolue souris poids fort
  00000061            00184 Y_POSL                       EQU    0x61; position Y absolue souris poids faible
  00000062            00185 X_POSH_SCALED                EQU    0x62; position X absolue souris avec facteur d'echelle poids fort
  00000063            00186 X_POSL_SCALED                EQU    0x63; position X absolue souris avec facteur d'echelle poids faible
  00000064            00187 Y_POSH_SCALED                EQU    0x64; position Y absolue souris avec facteur d'echelle poids fort
  00000065            00188 Y_POSL_SCALED                EQU    0x65; position Y absolue souris avec facteur d'echelle poids faible
  00000066            00189 X_MAX_POSH                   EQU    0x66; position X absolue maximale souris poids fort
  00000067            00190 X_MAX_POSL                   EQU    0x67; position X absolue maximale souris poids faible
  00000068            00191 Y_MAX_POSH                   EQU    0x68; position Y absolue maximale souris poids fort
  00000069            00192 Y_MAX_POSL                   EQU    0x69; position Y absolue maximale souris poids faible
  0000006A            00193 X_MOV                        EQU    0x6A; deplacement relatif souris en X
  0000006B            00194 Y_MOV                        EQU    0x6B; deplacement relatif souris en Y
  0000006C            00195 X_INC_KEY                    EQU    0x6C; increment en X mode keycode souris
  0000006D            00196 Y_INC_KEY                    EQU    0x6D; increment en X mode keycode souris
  0000006E            00197 DELTA_X                      EQU    0x6E; deltax mode keycode souris IKBD
  0000006F            00198 DELTA_Y                      EQU    0x6F; deltay mode keycode souris IKBD
                      00199 
                      00200 ; communes a toutes les pages
  00000070            00201 TEMP5                        EQU    0x70
  00000071            00202 TEMP6                        EQU    0x71
  00000072            00203 Counter                      EQU    0x72; compteur boucles
  00000073            00204 Value                        EQU    0x73; octet recu
  00000074            00205 TEMP1                        EQU    0x74
  00000075            00206 Counter2                     EQU    0x75; compteur boucles
  00000076            00207 PARITY                       EQU    0x76; parite ecriture/lecture PS/2
  00000077            00208 TEMP2                        EQU    0x77
  00000078            00209 MyStatus                     EQU    0x78; flags
  00000079            00210 MyStatus2                    EQU    0x79; flags
  0000007A            00211 MyStatus3                    EQU    0x7A; flags
  0000007B            00212 TEMP3                        EQU    0x7B
  0000007C            00213 TEMP4                        EQU    0x7C
  0000007D            00214 BUTTON_ACTION                EQU    0x7D; mode button action IKBD
  0000007E            00215 BUFFER_FLASH                 EQU    0x7E; buffer 2 octets
                      00216 
                      00217 ; page 2 en zone non remise a 0 au reset par Start_Flash
  00000110            00218 YEAR                         EQU    0x110; annee, conserver cet ordre pour les 6 variables horloge
  00000111            00219 MONTH                        EQU    0x111; mois
  00000112            00220 DAY                          EQU    0x112; jour
  00000113            00221 HRS                          EQU    0x113; heures
  00000114            00222 MIN                          EQU    0x114; minutes
  00000115            00223 SEC                          EQU    0x115; secndes
                      00224  
                      00225 
                      00226 ;----- Programme ---------------------------------------------------------
                      00227 
0000                  00228                 ORG     000H
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0000   01A0           00229                 clrf Status_Boot; remise a 0 lors de la mise sous tension ou reset hard 
0001                  00230 Reset_Prog
0001   158A           00231                 bsf PCLATH,3; page 1 (0x800 - 0xFFF)
0002   120A           00232                 bcf PCLATH,4
Message[306]: Crossing page boundary -- ensure page bits are set.
0003   2800           00233                 goto Start_Flash; saute au programme de lancement de la page 0 ou 2
                      00234 
0004                  00235 Inter
0004   0009           00236                 retfie; return from interrupt
                      00237 
0005                  00238 Startup
0005   2817           00239                 goto Startup2
                      00240 
                      00241 ;-----------------------------------------------------------------------------
                      00242 ;   Implementation d'une table de correspondance pour donner le nombre de
                      00243 ;   jour dans le mois, w contient le mois et retourne le nombre de jours. 
                      00244 ;
                      00245 ;   Entree: W = Mois
                      00246 ;   sortie: W = Nombre de jours du mois
                      00247 ;
                      00248 ;   Global: Aucune
                      00249 ;-----------------------------------------------------------------------------
                      00250 
0006                  00251 Days_In_Month
0006   0782           00252                 addwf PCL,F
0007   0000           00253                 nop
0008   341F           00254                 retlw 31; janvier
0009   341C           00255                 retlw 28; fevrier
000A   341F           00256                 retlw 31; mars
000B   341E           00257                 retlw 30; avril
000C   341F           00258                 retlw 31; mai
000D   341E           00259                 retlw 30; juin
000E   341F           00260                 retlw 31; juillet
000F   341F           00261                 retlw 31; aout
0010   341E           00262                 retlw 30; septembre
0011   341F           00263                 retlw 31; octobre
0012   341E           00264                 retlw 30; novembre
0013   341F           00265                 retlw 31; decembre              
0014   341F           00266                 retlw 31
0015   341F           00267                 retlw 31
0016   341F           00268                 retlw 31
                      00269                 
                      00270                 IF DEBUG_CODE
                      00271 ;-----------------------------------------------------------------------------
                      00272 ;   Chaine de caracteres bienvenue !
                      00273 ;-----------------------------------------------------------------------------
                      00274 
                      00275 Texte
                      00276                 addwf PCL,f
                      00277                 retlw 'E'
                      00278                 retlw 'i'
                      00279                 retlw 'f'
                      00280                 retlw 'f'
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00281                 retlw 'e'
                      00282                 retlw 'l'
                      00283                 retlw ' '
                      00284                 retlw 'F'
                      00285                 retlw 'A'
                      00286                 retlw 'V'
                      00287                 retlw 'A'
                      00288                 retlw 'R'
                      00289                 retlw 'D'
                      00290                 retlw ' '
                      00291                 retlw 'L'
                      00292                 retlw ' '
                      00293                 retlw '1'
                      00294                 retlw '0'
                      00295                 retlw '4'
                      00296                 retlw 0
                      00297 
                      00298 ;------------------------------------------------------------------------
                      00299 ;   Implementation d'une table de correspondance pour convertir en BCD le
                      00300 ;   contenu du registre w et l'envoyer vers la laison serie.
                      00301 ;
                      00302 ;   Entree: W = Quartet a convertir (LSB)
                      00303 ;   sortie: W = Code ASCII
                      00304 ;
                      00305 ;   Global: Aucune
                      00306 ;------------------------------------------------------------------------
                      00307 
                      00308 LookUp
                      00309                 addwf PCL,F
                      00310                 retlw 0x30
                      00311                 retlw 0x31
                      00312                 retlw 0x32
                      00313                 retlw 0x33
                      00314                 retlw 0x34
                      00315                 retlw 0x35
                      00316                 retlw 0x36
                      00317                 retlw 0x37
                      00318                 retlw 0x38
                      00319                 retlw 0x39
                      00320                 retlw 0x41
                      00321                 retlw 0x42
                      00322                 retlw 0x43
                      00323                 retlw 0x44
                      00324                 retlw 0x45
                      00325                 retlw 0x46
                      00326 
                      00327         ENDIF
                      00328 ;-----------------------------------------------------------------------------
                      00329 ;                       Startup, initialisation
                      00330 ;-----------------------------------------------------------------------------
                      00331 
0017                  00332 Startup2
0017   158A           00333                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[306]: Crossing page boundary -- ensure page bits are set.
0018   21C8           00334                 call Init
0019   118A           00335                 bcf PCLATH,3; page 0 ou 2
001A   246A           00336                 call Init_X_Y_Abs; position absolue souris
001B   2A9E           00337                 goto Init_MyStatus
                      00338 
                      00339 ;------------------------------------------------------------------------------
                      00340 ;               Boucle principale d'attente de donnees:
                      00341 ;               On regarde si une donnee clavier arrrive, puis souris.
                      00342 ;------------------------------------------------------------------------------
                      00343 
001C                  00344 Main
                      00345                 ;--------------------------------------------------------------
                      00346                 ;   Boucle d'attente sur les horloges: Polling sur KCLC ET MCLK
                      00347                 ;   puis bloquage oppose et appel au traitement de l'element.
                      00348 
001C                  00349 Main
                      00350                 IF PS2_ALTERNE
001C   084B           00351                 movf Counter_5MS,W
001D   3903           00352                 andlw 3         
001E   1D03           00353                 btfss STATUS,Z; gestion alternee toutes les 5 mS clavier et 15 mS souris PS/2
001F   2824           00354                         goto EnableMouse
                      00355                 ENABLEKEYB
0020   1683               M                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0021   1486               M                 bsf TRISB,KCLOCK; en entree
0022   1283               M                 bcf STATUS,RP0; page 0
0023   2827           00356                 goto Main_Loop
0024                  00357 EnableMouse
                      00358                 ENABLEMOUSE
0024   1683               M                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0025   1586               M                 bsf TRISB,MCLOCK; en entree
0026   1283               M                 bcf STATUS,RP0; page 0
                      00359                 ELSE
                      00360                 ENABLEPS2; autorise transferts clavier et souris en meme temps
                      00361                 ENDIF           
0027                  00362 Main_Loop
                      00363                         IF PS2_ALTERNE  
0027   084B           00364                         movf Counter_5MS,W
0028   3903           00365                         andlw 3         
0029   1D03           00366                         btfss STATUS,Z; gestion alternee toutes les 5 mS clavier et 15 mS souris PS/2
002A   2833           00367                                 goto TstMouse; gestion souris
002B   1886           00368                         btfsc PORTB,KCLOCK; front descendant de CLK
002C   283B           00369                                 goto TstAtariSend
                      00370                         ELSE
                      00371                         btfsc PORTB,KCLOCK; front descendant de CLK
                      00372                                 goto TstMouse; le clavier ne se manifeste pas, on passe a la souris
                      00373                         ENDIF
                      00374                         DISABLEMOUSE; bloque souris
002D   1683               M                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002E   1186               M                 bcf TRISB,MCLOCK; en sortie
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

002F   1283               M                 bcf STATUS,RP0; page 0
0030   1186               M                 bcf PORTB,MCLOCK
0031   26B9           00375                         call KPSGet2; => Value , on recupere l'octet clavier
0032   2B42           00376                         goto doKeyboard; On appel le traitement Clavier complet
0033                  00377 TstMouse
0033   1986           00378                         btfsc PORTB,MCLOCK; front descendant de CLK
0034   283B           00379                                 goto TstAtariSend; le souris ne se manifeste pas, on passe en controle c
                            ommande Atari
                      00380                         DISABLEKEYB; bloque clavier
0035   1683               M                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0036   1086               M                 bcf TRISB,KCLOCK; en sortie
0037   1283               M                 bcf STATUS,RP0; page 0
0038   1086               M                 bcf PORTB,KCLOCK
0039   2708           00381                         call MPSGet2; => Value, on recupere l'octet souris
003A   2B62           00382                         goto doMouse; On appel le traitement Souris complet
003B                  00383 TstAtariSend
003B   1EF9           00384                         btfss MyStatus2,DATATOSEND
003C   2859           00385                                 goto TstAtariReceive; rien a envoyer par la liaison serie
003D   1E0C           00386                         btfss PIR1,TXIF; check that buffer is empty 
003E   2859           00387                                 goto TstAtariReceive; registre d'emission plein
                      00388                         DISABLEPS2; bloque clavier et souris
003F   1683               M                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0040   1086               M                 bcf TRISB,KCLOCK; en sortie
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0041   1186               M                 bcf TRISB,MCLOCK; en sortie
0042   1283               M                 bcf STATUS,RP0; page 0
0043   1086               M                 bcf PORTB,KCLOCK
0044   1186               M                 bcf PORTB,MCLOCK
0045   0838           00389                         movf DEB_INDEX_EM,W; teste buffer circulaire
0046   0239           00390                         subwf FIN_INDEX_EM,W
0047   1D03           00391                         btfss STATUS,Z
0048   284B           00392                                 goto SendData; FIN_INDEX_EM <> DEB_INDEX_EM
0049   12F9           00393                         bcf MyStatus2,DATATOSEND
004A   281C           00394                         goto Main
004B                  00395 SendData
004B   1383           00396                         bcf STATUS,IRP; page 0
004C   0A38           00397                         incf DEB_INDEX_EM,W; incremente buffer cirulaire donnees envoyees
004D   0084           00398                         movwf FSR; pointeur index
004E   3010           00399                         movlw TAILLE_TAMPON_EM
004F   0204           00400                         subwf FSR,W
0050   1803           00401                         btfsc STATUS,C
0051   0184           00402                                 clrf FSR; buffer circulaire
0052   0804           00403                         movf FSR,W
0053   00B8           00404                         movwf DEB_INDEX_EM
0054   3028           00405                         movlw TAMPON_EM
0055   0784           00406                         addwf FSR,F; pointeur index
0056   0800           00407                         movf INDF,W; lecture dans le tampon 
0057   0099           00408                         movwf TXREG; transmit byte
0058   281C           00409                         goto Main
0059                  00410 TstAtariReceive
0059   1E8C           00411                         btfss PIR1,RCIF; Controle commande atari arrivee
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

005A   2863           00412                                 goto TstTimer; reception liaison asynchrone
                      00413                         DISABLEPS2; bloque clavier et souris
005B   1683               M                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
005C   1086               M                 bcf TRISB,KCLOCK; en sortie
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
005D   1186               M                 bcf TRISB,MCLOCK; en sortie
005E   1283               M                 bcf STATUS,RP0; page 0
005F   1086               M                 bcf PORTB,KCLOCK
0060   1186               M                 bcf PORTB,MCLOCK
0061   2678           00414                         call SerialReceive; => Value, on teste les commandes clavier Atari
0062   28C7           00415                         goto doAtariCommand; Traiter la commande Atari clavier recue
0063                  00416 TstTimer
0063   1C8C           00417                 btfss PIR1,TMR2IF
0064   2827           00418                         goto Main_Loop
                      00419                                 
                      00420 ;-----------------------------------------------------------------------------
                      00421 ;               Gestion sous Timer 2 a 5 mS de l'horloge.
                      00422 ;-----------------------------------------------------------------------------
                      00423 
0065                  00424 doTimer
                      00425                 DISABLEPS2; bloque clavier et souris
0065   1683               M                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0066   1086               M                 bcf TRISB,KCLOCK; en sortie
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0067   1186               M                 bcf TRISB,MCLOCK; en sortie
0068   1283               M                 bcf STATUS,RP0; page 0
0069   1086               M                 bcf PORTB,KCLOCK
006A   1186               M                 bcf PORTB,MCLOCK
006B   108C           00426                 bcf PIR1,TMR2IF; acquitte timer 2
006C   1F79           00427                 btfss MyStatus2,RESET_KEYB
006D   2871           00428                         goto TstResetKeyb
006E   26A1           00429                 call cmdResetKey
006F   1379           00430                 bcf MyStatus2,RESET_KEYB; flag demande reset clavier remis a 0
0070   2876           00431                 goto TstClock
0071                  00432 TstResetKeyb
0071   1FF9           00433                 btfss MyStatus2,RESET_MOUSE
0072   2876           00434                         goto TstClock
0073   26A9           00435                 call cmdResetMouse
0074   13F9           00436                 bcf MyStatus2,RESET_MOUSE; flag demande reset souris remis a 0
0075   2876           00437                 goto TstClock                   
0076                  00438 TstClock
0076   0ACB           00439                 incf Counter_5MS,F
0077   30C8           00440                 movlw 200
0078   024B           00441                 subwf Counter_5MS,W
0079   1903           00442                 btfsc STATUS,Z
007A   249F           00443                         call INC_Clock; increment horloge toutes les 5 mS
007B   184B           00444                 btfsc Counter_5MS,0
007C   281C           00445                         goto Main
                      00446 
                      00447 ;-----------------------------------------------------------------------------
                      00448 ;               Gestion sous Timer 2 toutes les 10 mS des joysticks.
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00449 ;-----------------------------------------------------------------------------
                      00450                 
007D   1F78           00451                 btfss MyStatus,JOY_ENABLE; gestion par timer joysticks
007E   281C           00452                         goto Main; pas de gestion des joysticks
007F   19F9           00453                 btfsc MyStatus2,JOY_MONITOR
0080   28A5           00454                         goto Joy_Monitoring; monitoring des joysticks   
0081   1979           00455                 btfsc MyStatus2,JOY_EVENT
0082   288B           00456                         goto Not_100MS; evenements joysticks
0083   1CF9           00457                 btfss MyStatus2,JOY_KEYS; envoi touches fleches
0084   281C           00458                         goto Main; rien a gerer sous le timer au niveau des joysticks
0085   0BCE           00459                 decfsz Counter_10MS_Joy,F
0086   288B           00460                         goto Not_100MS
0087   300A           00461                 movlw 10
0088   00CE           00462                 movwf Counter_10MS_Joy
0089   0ACF           00463                 incf Counter_100MS_Joy,F                 
008A   2505           00464                 call SendAtariJoysticks_Fleches; mode keycode du joystick 0
008B                  00465 Not_100MS
008B   0905           00466                 comf PORTA,W; gestion evenements joysticks ou keycode action sur fire
008C   00F4           00467                 movwf TEMP1
008D   0C74           00468                 rrf TEMP1,W
008E   391F           00469                 andlw 0x1F; 000FDGBH (Fire, Droite, Gauche, Bas, Haut)
008F   00F4           00470                 movwf TEMP1
0090   0226           00471                 subwf JOY0,W; lecture joystick 0
0091   1903           00472                 btfsc STATUS,Z
0092   2897           00473                         goto Not_Joy0_Change; pas de changement joystick 0
0093   0874           00474                 movf TEMP1,W            
0094   00A6           00475                 movwf JOY0; lecture joystick 0
0095   30FE           00476                 movlw HEADER_JOYSTICK0; header joystick 0
0096   28A0           00477                 goto SerialTransmit_Joy
0097                  00478 Not_Joy0_Change
0097   0907           00479                 comf PORTC,W
0098   391F           00480                 andlw 0x1F; 000FDGBH (Fire, Droite, Gauche, Bas, Haut)
0099   00F4           00481                 movwf TEMP1
009A   0227           00482                 subwf JOY1,W; lecture joystick 1
009B   1903           00483                 btfsc STATUS,Z
009C   281C           00484                         goto Main; pas de changement joystick 1
009D   0874           00485                 movf TEMP1,W    
009E   00A7           00486                 movwf JOY1; lecture joystick 1
009F   30FF           00487                 movlw HEADER_JOYSTICK1; header joystick 1
00A0                  00488 SerialTransmit_Joy
00A0   00C0           00489                 movwf HEADER_IKBD
00A1   2762           00490                 call Leds_Eiffel_On
00A2   24DE           00491                 call SendAtariJoysticks
00A3   2765           00492                 call Leds_Eiffel_Off
00A4   281C           00493                 goto Main
                      00494                 
                      00495 ;-----------------------------------------------------------------------------
                      00496 ;      Gestion sous Timer 2 toutes les 10 mS envoi trames Joystick en continu.
                      00497 ;-----------------------------------------------------------------------------
                      00498 
00A5                  00499 Joy_Monitoring
00A5   0BCC           00500                 decfsz Counter_10MS_Joy_Monitor,F
00A6   281C           00501                         goto Main
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00A7   084A           00502                 movf Rate_Joy,W
00A8   00CC           00503                 movwf Counter_10MS_Joy_Monitor
00A9   2762           00504                 call Leds_Eiffel_On
00AA   0905           00505                 comf PORTA,W
00AB   00A6           00506                 movwf JOY0
00AC   0C26           00507                 rrf JOY0,W
00AD   391F           00508                 andlw 0x1F
00AE   00A6           00509                 movwf JOY0; lecture joystick 0
00AF   0907           00510                 comf PORTC,W
00B0   391F           00511                 andlw 0x1F
00B1   00A7           00512                 movwf JOY1; lecture joystick 1
00B2   01F4           00513                 clrf TEMP1
00B3   1A26           00514                 btfsc JOY0,4; bouton joytick 0
00B4   14F4           00515                         bsf TEMP1,1
00B5   1A27           00516                 btfsc JOY1,4; bouton joytick 1
00B6   1474           00517                         bsf TEMP1,0
00B7   0874           00518                 movf TEMP1,W; 000000xy avec y pour fire joystick 1 et x pour fire joystick 0
00B8   267D           00519                 call SerialTransmit_Host
00B9   0826           00520                 movf JOY0,W; lecture joystick 0
00BA   00F4           00521                 movwf TEMP1
00BB   0DF4           00522                 rlf TEMP1,F
00BC   0DF4           00523                 rlf TEMP1,F
00BD   0DF4           00524                 rlf TEMP1,F
00BE   0D74           00525                 rlf TEMP1,W
00BF   39F0           00526                 andlw 0xF0
00C0   00F4           00527                 movwf TEMP1
00C1   0827           00528                 movf JOY1,W; lecture joystick 1
00C2   390F           00529                 andlw 0x0F;    DGBHDGBH (Droite, Gauche, Bas, Haut)
00C3   0474           00530                 iorwf TEMP1,W; nnnnmmmm  avec m pour le joystick 1 et n pour le joystick 0
00C4   267D           00531                 call SerialTransmit_Host
00C5   2765           00532                 call Leds_Eiffel_Off
00C6   281C           00533                 goto Main
                      00534 
                      00535 ;-----------------------------------------------------------------------------
                      00536 ;               Commande Clavier Atari recue.
                      00537 ;-----------------------------------------------------------------------------
                      00538 
00C7                  00539 doAtariCommand
00C7   17F8           00540                 bsf MyStatus,IKBD_ENABLE; transferts IKBD autorises     
00C8   11F9           00541                 bcf MyStatus2,JOY_MONITOR; monitoring joysticks desactive
                      00542                 ;--------------------------------------------------------------
                      00543                 ;   Temperature
00C9   0873           00544                 movf Value,W
00CA   3C03           00545                 sublw IKBD_GETTEMP; lecture temperature
00CB   1D03           00546                 btfss STATUS,Z
00CC   28E2           00547                         goto Not_Get_Temp
00CD   30F6           00548                 movlw HEADER_STATUS; header d'etat
00CE   267D           00549                 call SerialTransmit_Host
00CF   3003           00550                 movlw IKBD_GETTEMP
00D0   267D           00551                 call SerialTransmit_Host
00D1   0849           00552                 movf Temp,W; temperature
00D2   267D           00553                 call SerialTransmit_Host
00D3   0822           00554                 movf Val_AN0,W; lecture CTN sur AN0
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00D4   267D           00555                 call SerialTransmit_Host
00D5   0103           00556                 clrw
00D6   1A87           00557                 btfsc PORTC,MOTORON
00D7   3001           00558                         movlw 1
00D8   267D           00559                 call SerialTransmit_Host
00D9   30A8           00560                 movlw Tab_Temp-EEProm+IDX_LEVELHTEMP
00DA   2758           00561                 call Lecture_EEProm
00DB   267D           00562                 call SerialTransmit_Host
00DC   30A9           00563                 movlw Tab_Temp-EEProm+IDX_LEVELLTEMP
00DD   2758           00564                 call Lecture_EEProm
00DE   267D           00565                 call SerialTransmit_Host
00DF   0103           00566                 clrw
00E0   267D           00567                 call SerialTransmit_Host                
00E1   281C           00568                 goto Main               
00E2                  00569 Not_Get_Temp
00E2   0873           00570                 movf Value,W
00E3   3C04           00571                 sublw IKBD_PROGTEMP; programmation seuil temperature
00E4   1D03           00572                 btfss STATUS,Z
00E5   28EE           00573                         goto Not_Prog_Temp
00E6   01A2           00574                 clrf Val_AN0; lecture CTN sur AN0
00E7   2678           00575                 call SerialReceive; code programmation temperature
00E8   3C03           00576                 sublw IDX_SCALETEMP; soustraire l'offset MAX
00E9   1C03           00577                 btfss STATUS,C; si carry =1 pas de problemes on passe
00EA   2920           00578                         goto Not_Prog_EEProm; ignore code > IDX_SCALETEMP
00EB   0873           00579                 movf Value,W
00EC   3EA8           00580                 addlw Tab_Temp-EEProm; pour pointer le debut des octets temperature dans la table
00ED   2907           00581                 goto Prog_EEProm
00EE                  00582 Not_Prog_Temp
                      00583                 ;--------------------------------------------------------------
                      00584                 ;   Programmation souris et clavier
00EE   0873           00585                 movf Value,W
00EF   3C06           00586                 sublw IKBD_PROGMS; programmation clavier
00F0   1D03           00587                 btfss STATUS,Z
00F1   28FB           00588                         goto Not_Prog_Mouse
                      00589                 ; Indiquer le mode programmation par allumages des trois LEDs
00F2   3007           00590                 movlw LEDS_ON
00F3   2698           00591                 call cmdLedOnOff
00F4   2678           00592                 call SerialReceive; code programmation souris
00F5   3C07           00593                 sublw IDX_WHREPEAT; soustraire l'offset MAX
00F6   1C03           00594                 btfss STATUS,C; si carry =1 pas de problemes on passe
00F7   2920           00595                         goto Not_Prog_EEProm; ignore code > IDX_WHREPEAT
00F8   0873           00596                 movf Value,W
00F9   3E90           00597                 addlw Tab_Mouse-EEProm; pour pointer le debut des octets souris dans la table
00FA   2907           00598                 goto Prog_EEProm
00FB                  00599 Not_Prog_Mouse
00FB   0873           00600                 movf Value,W
00FC   3C05           00601                 sublw IKBD_PROGKB; programmation souris
00FD   1D03           00602                 btfss STATUS,Z
00FE   2922           00603                         goto Not_ProgKB
                      00604                 ; Indiquer le mode programmation par allumages des trois LEDs
00FF   3007           00605                 movlw LEDS_ON
0100   2698           00606                 call cmdLedOnOff
0101   2678           00607                 call SerialReceive; code programmation clavier
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0102   3C8F           00608                 sublw MAX_VALUE_LOOKUP; soustraire l'offset MAX
0103   1C03           00609                 btfss STATUS,C; si carry =1 pas de problemes on passe
0104   2920           00610                         goto Not_Prog_EEProm; ignore code > MAX_VALUE_LOOKUP
0105   0873           00611                 movf Value,W
0106   3E00           00612                 addlw Tab_Scan_Codes-EEProm; pour pointer le debut des octets CLAVIER dans la table
0107                  00613 Prog_EEProm
0107   00F2           00614                 movwf Counter
0108   2678           00615                 call SerialReceive
                      00616                 WREEPROM Counter,Value
  0000                    M                 LOCAL WE1,WE2
0109   1703               M                 bsf STATUS,RP1; page 3
010A   1683               M                 bsf STATUS,RP0 
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
010B   188C               M WE1             btfsc EECON1,WR; attente ecriture
010C   290B               M                 goto WE1
010D   1283               M                 bcf STATUS,RP0; page 2
010E   0872               M                 movf Counter,W; adresse
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
010F   008D               M                 movwf EEADR
0110   0873               M                 movf Value,W; donnee a ecrire
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0111   008C               M                 movwf EEDATA
0112   1683               M                 bsf STATUS,RP0; page 3
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0113   138C               M                 bcf EECON1,EEPGD; EEPROM
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0114   150C               M                 bsf EECON1,WREN; autorise ecriture
0115   3055               M                 movlw 0x55
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0116   008D               M                 movwf EECON2
0117   30AA               M                 movlw 0xAA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0118   008D               M                 movwf EECON2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0119   148C               M                 bsf EECON1,WR; commence ecriture
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
011A   110C               M                 bcf EECON1,WREN; enleve autorisation ecriture
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
011B   188C               M WE2             btfsc EECON1,WR; attente ecriture
011C   291B               M                 goto WE2
011D   1283               M                 bcf STATUS,RP0; page 0
011E   1303               M                 bcf STATUS,RP1
011F   281C           00617                 goto Main
0120                  00618 Not_Prog_EEProm
0120   2678           00619                 call SerialReceive
0121   281C           00620                 goto Main
0122                  00621 Not_ProgKB
                      00622                 ;--------------------------------------------------------------
                      00623                 ;   Mode de fonctionnement IKBD souris
0122   0873           00624                 movf Value,W
0123   3C07           00625                 sublw IKBD_SET_MOUSE_BUTTON_ACTION; mode boutons souris
0124   1D03           00626                 btfss STATUS,Z
0125   2929           00627                         goto Not_Set_Mouse_Button_Action
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0126   2678           00628                 call SerialReceive
0127   00FD           00629                 movwf BUTTON_ACTION
0128   281C           00630                 goto Main
0129                  00631 Not_Set_Mouse_Button_Action
0129   0873           00632                 movf Value,W
012A   3C08           00633                 sublw IKBD_REL_MOUSE_POS_REPORT; souris mode relatif
012B   1D03           00634                 btfss STATUS,Z
012C   2930           00635                         goto Not_Rel_Mouse
012D   1079           00636                 bcf MyStatus2,MOUSE_KEYS
012E   11F8           00637                 bcf MyStatus,MOUSE_ABS
012F   294D           00638                 goto Loop_Mouse_Enable
0130                  00639 Not_Rel_Mouse
0130   0873           00640                 movf Value,W
0131   3C09           00641                 sublw IKBD_ABS_MOUSE_POSITIONING; souris mode absolu
0132   1D03           00642                 btfss STATUS,Z
0133   2940           00643                         goto Not_Abs_Mouse
0134   2678           00644                 call SerialReceive; XMSB, X maximum
0135   00E6           00645                 movwf X_MAX_POSH; position X absolue souris maximale poids fort
0136   2678           00646                 call SerialReceive; XLSB
0137   00E7           00647                 movwf X_MAX_POSL; position X absolue souris maximale poids faible
0138   2678           00648                 call SerialReceive; YMSB, Y maximum
0139   00E8           00649                 movwf Y_MAX_POSH; position Y absolue souris maximale poids fort
013A   2678           00650                 call SerialReceive; YLSB
013B   00E9           00651                 movwf Y_MAX_POSL; position Y absolue souris maximale poids faible
013C   246A           00652                 call Init_X_Y_Abs
013D   1079           00653                 bcf MyStatus2,MOUSE_KEYS
013E   15F8           00654                 bsf MyStatus,MOUSE_ABS
013F   294D           00655                 goto Loop_Mouse_Enable
0140                  00656 Not_Abs_Mouse
0140   0873           00657                 movf Value,W
0141   3C0A           00658                 sublw IKBD_SET_MOUSE_KEYCODE_CODE; mode touches fleches souris
0142   1D03           00659                 btfss STATUS,Z
0143   294F           00660                         goto Not_Mouse_KeyCode
0144   2678           00661                 call SerialReceive; deltax
0145   2466           00662                 call Change_0_To_1
0146   00EE           00663                 movwf DELTA_X; deltax mode keycode souris IKBD
0147   2678           00664                 call SerialReceive; deltay
0148   2466           00665                 call Change_0_To_1
0149   00EF           00666                 movwf DELTA_Y; deltay mode keycode souris IKBD
014A   01EC           00667                 clrf X_INC_KEY; increment en X mode keycode souris
014B   01ED           00668                 clrf Y_INC_KEY; increment en Y mode keycode souris
014C   1479           00669                 bsf MyStatus2,MOUSE_KEYS
014D                  00670 Loop_Mouse_Enable
014D   16F8           00671                 bsf MyStatus,MOUSE_ENABLE
014E   281C           00672                 goto Main
014F                  00673 Not_Mouse_KeyCode
014F   0873           00674                 movf Value,W
0150   3C0B           00675                 sublw IKBD_SET_MOUSE_THRESHOLD; non gere
0151   1D03           00676                 btfss STATUS,Z
0152   2956           00677                         goto Not_Mouse_Threshold
0153   2678           00678                 call SerialReceive; X seuil
0154   2678           00679                 call SerialReceive; Y seuil
0155   281C           00680                 goto Main
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0156                  00681 Not_Mouse_Threshold
0156   0873           00682                 movf Value,W
0157   3C0C           00683                 sublw IKBD_SET_MOUSE_SCALE; facteur d'echelle souris mode absolu
0158   1D03           00684                 btfss STATUS,Z
0159   2961           00685                         goto Not_Mouse_Scale
015A   2678           00686                 call SerialReceive; X
015B   2466           00687                 call Change_0_To_1
015C   00DC           00688                 movwf X_SCALE
015D   2678           00689                 call SerialReceive; Y
015E   2466           00690                 call Change_0_To_1
015F   00DD           00691                 movwf Y_SCALE
0160   297C           00692                 goto Conv_Not_Scaled
0161                  00693 Not_Mouse_Scale
0161   0873           00694                 movf Value,W
0162   3C0D           00695                 sublw IKBD_INTERROGATE_MOUSE_POS; demande position absolue souris
0163   1D03           00696                 btfss STATUS,Z
0164   296F           00697                         goto Not_Mouse_Pos
0165   1DF8           00698                 btfss MyStatus,MOUSE_ABS
0166   281C           00699                         goto Main; <> mode absolu
0167   19F9           00700                 btfsc MyStatus2,JOY_MONITOR
0168   281C           00701                         goto Main
0169   30F7           00702                 movlw HEADER_ABSOLUTE_MOUSE; header souris mode absolu
016A   00C0           00703                 movwf HEADER_IKBD
016B   1386           00704                 bcf PORTB,LEDYELLOW; allume LED souris
016C   25C4           00705                 call SendAtariMouse
016D   1786           00706                 bsf PORTB,LEDYELLOW; eteint LED souris                  
016E   281C           00707                 goto Main
016F                  00708 Not_Mouse_Pos
016F   0873           00709                 movf Value,W
0170   3C0E           00710                 sublw IKBD_LOAD_MOUSE_POS; initialisation coords souris absolue
0171   1D03           00711                 btfss STATUS,Z
0172   2981           00712                         goto Not_Load_Mouse_Pos
0173   2678           00713                 call SerialReceive; 0
0174   2678           00714                 call SerialReceive; XMSB, X coord
0175   00E2           00715                 movwf X_POSH_SCALED; position X absolue souris avec facteur d'echelle poids fort
0176   2678           00716                 call SerialReceive; XLSB
0177   00E3           00717                 movwf X_POSL_SCALED; position X absolue souris avec facteur d'echelle poids faible
0178   2678           00718                 call SerialReceive; YMSB, Y coord
0179   00E4           00719                 movwf Y_POSH_SCALED; position Y absolue souris avec facteur d'echelle poids fort
017A   2678           00720                 call SerialReceive; YLSB
017B   00E5           00721                 movwf Y_POSL_SCALED; position Y absolue souris avec facteur d'echelle poids faible
017C                  00722 Conv_Not_Scaled
017C   158A           00723                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)
Message[306]: Crossing page boundary -- ensure page bits are set.
017D   2128           00724                 call Conv_Inv_Scale_X
Message[306]: Crossing page boundary -- ensure page bits are set.
017E   2135           00725                 call Conv_Inv_Scale_Y
017F   118A           00726                 bcf PCLATH,3; page 0 ou 2               
0180   281C           00727                 goto Main
0181                  00728 Not_Load_Mouse_Pos
0181   0873           00729                 movf Value,W
0182   3C0F           00730                 sublw IKBD_SET_Y0_AT_BOTTOM; 0 de Y souris en bas
0183   1D03           00731                 btfss STATUS,Z
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0184   2987           00732                         goto Not_Y0_At_Bottom
0185   1678           00733                 bsf MyStatus,SIGN_Y
0186   281C           00734                 goto Main
0187                  00735 Not_Y0_At_Bottom
0187   0873           00736                 movf Value,W
0188   3C10           00737                 sublw IKBD_SET_Y0_AT_TOP; 0 de Y souris en haut (par defaut)
0189   1D03           00738                 btfss STATUS,Z
018A   298D           00739                         goto Not_Y0_At_Top
018B   1278           00740                 bcf MyStatus,SIGN_Y
018C   281C           00741                 goto Main
018D                  00742 Not_Y0_At_Top
018D   0873           00743                 movf Value,W
018E   3C11           00744                 sublw IKDB_RESUME; autorisation transferts
018F   1D03           00745                 btfss STATUS,Z
0190   2992           00746                         goto Not_Resume
0191   281C           00747                 goto Main
0192                  00748 Not_Resume
0192   0873           00749                 movf Value,W
0193   3C12           00750                 sublw IKDB_DISABLE_MOUSE; inhibe la souris
0194   1D03           00751                 btfss STATUS,Z
0195   2998           00752                         goto Not_Disable_Mouse
0196   12F8           00753                 bcf MyStatus,MOUSE_ENABLE
0197   281C           00754                 goto Main
0198                  00755 Not_Disable_Mouse
0198   0873           00756                 movf Value,W
0199   3C13           00757                 sublw IKDB_PAUSE_OUTPUT; arret transferts
019A   1D03           00758                 btfss STATUS,Z
019B   299E           00759                         goto Not_Pause
019C   13F8           00760                 bcf MyStatus,IKBD_ENABLE
019D   281C           00761                 goto Main
019E                  00762 Not_Pause
                      00763                 ;--------------------------------------------------------------
                      00764                 ;   Mode de fonctionnement IKBD joysticks
019E   0873           00765                 movf Value,W
019F   3C14           00766                 sublw IKBD_SET_JOY_EVNT_REPORT; joystick transferts automatiques
01A0   1D03           00767                 btfss STATUS,Z
01A1   29A6           00768                         goto Not_Joy_On
01A2   10F9           00769                 bcf MyStatus2,JOY_KEYS
01A3   1579           00770                 bsf MyStatus2,JOY_EVENT
01A4   1778           00771                 bsf MyStatus,JOY_ENABLE
01A5   281C           00772                 goto Main
01A6                  00773 Not_Joy_On
01A6   0873           00774                 movf Value,W
01A7   3C15           00775                 sublw IKBD_SET_JOY_INTERROG_MODE; arret transferts joystick automatiques
01A8   1D03           00776                 btfss STATUS,Z
01A9   29AE           00777                         goto Not_Joy_Off
01AA   10F9           00778                 bcf MyStatus2,JOY_KEYS
01AB   1179           00779                 bcf MyStatus2,JOY_EVENT
01AC   1778           00780                 bsf MyStatus,JOY_ENABLE
01AD   281C           00781                 goto Main
01AE                  00782 Not_Joy_Off
01AE   0873           00783                 movf Value,W
01AF   3C16           00784                 sublw IKBD_JOY_INTERROG; interroge joysticks
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01B0   1D03           00785                 btfss STATUS,Z
01B1   29C2           00786                         goto Not_Joy_Interrog
01B2   1F78           00787                 btfss MyStatus,JOY_ENABLE
01B3   281C           00788                         goto Main; joysticks inhibes
01B4   18F9           00789                 btfsc MyStatus2,JOY_KEYS
01B5   281C           00790                         goto Main; mode keycode joystick 0
01B6   19F9           00791                 btfsc MyStatus2,JOY_MONITOR
01B7   281C           00792                         goto Main; mode monitoring joysticks
01B8   0905           00793                 comf PORTA,W
01B9   00A6           00794                 movwf JOY0
01BA   0C26           00795                 rrf JOY0,W
01BB   391F           00796                 andlw 0x1F
01BC   00A6           00797                 movwf JOY0; 000FDGBH (Fire, Droite, Gauche, Bas, Haut) joystick 0
01BD   0907           00798                 comf PORTC,W
01BE   391F           00799                 andlw 0x1F
01BF   00A7           00800                 movwf JOY1; 000FDGBH (Fire, Droite, Gauche, Bas, Haut) joystick 1
01C0   30FD           00801                 movlw HEADER_JOYSTICKS; header joysticks
01C1   28A0           00802                 goto SerialTransmit_Joy
01C2                  00803 Not_Joy_Interrog
01C2   0873           00804                 movf Value,W
01C3   3C17           00805                 sublw IKBD_SET_JOY_MONITOR
01C4   1D03           00806                 btfss STATUS,Z
01C5   29CD           00807                         goto Not_Joy_Monitor; lecture joyticks en continu
01C6   2678           00808                 call SerialReceive; rate
01C7   2466           00809                 call Change_0_To_1
01C8   00CA           00810                 movwf Rate_Joy
01C9   00CC           00811                 movwf Counter_10MS_Joy_Monitor
01CA   15F9           00812                 bsf MyStatus2,JOY_MONITOR
01CB   1778           00813                 bsf MyStatus,JOY_ENABLE
01CC   281C           00814                 goto Main
01CD                  00815 Not_Joy_Monitor
01CD   0873           00816                 movf Value,W
01CE   3C18           00817                 sublw IKBD_SET_FIRE_BUTTON_MONITOR
01CF   1D03           00818                 btfss STATUS,Z
01D0   29D2           00819                         goto Not_Fire_Button
01D1   281C           00820                 goto Main
01D2                  00821 Not_Fire_Button
01D2   0873           00822                 movf Value,W
01D3   3C19           00823                 sublw IKBD_SET_JOY_KEYCODE_MODE; mode touches fleches joystick 0
01D4   1D03           00824                 btfss STATUS,Z
01D5   29E9           00825                         goto Not_Joy_KeyCode
01D6   2678           00826                 call SerialReceive; RX
01D7   00D0           00827                 movwf RX_JOY
01D8   2678           00828                 call SerialReceive; RY
01D9   00D1           00829                 movwf RY_JOY
01DA   2678           00830                 call SerialReceive; TX
01DB   00D2           00831                 movwf TX_JOY
01DC   2678           00832                 call SerialReceive; TY
01DD   00D3           00833                 movwf TY_JOY
01DE   2678           00834                 call SerialReceive; VX
01DF   00D4           00835                 movwf VX_JOY
01E0   2678           00836                 call SerialReceive; VY
01E1   00D5           00837                 movwf VY_JOY
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01E2   01D6           00838                 clrf Status_Joy
01E3   30FF           00839                 movlw 0xFF
01E4   00D7           00840                 movwf OLD_JOY
01E5   14F9           00841                 bsf MyStatus2,JOY_KEYS
01E6   1179           00842                 bcf MyStatus2,JOY_EVENT
01E7   1778           00843                 bsf MyStatus,JOY_ENABLE
01E8   281C           00844                 goto Main
01E9                  00845 Not_Joy_KeyCode
01E9   0873           00846                 movf Value,W
01EA   3C1A           00847                 sublw IKDB_DISABLE_JOYSTICKS; inhibe les joysticks
01EB   1D03           00848                 btfss STATUS,Z
01EC   29EF           00849                         goto Not_Disable_Joysticks
01ED   1378           00850                 bcf MyStatus,JOY_ENABLE
01EE   281C           00851                 goto Main
01EF                  00852 Not_Disable_Joysticks
01EF   0873           00853                 movf Value,W
01F0   3C1B           00854                 sublw IKBD_TIME_OF_DAY_CLOCK_SET; initialise l'horloge
01F1   1D03           00855                 btfss STATUS,Z
01F2   2A02           00856                         goto Not_Time_Set
                      00857                 ;--------------------------------------------------------------
                      00858                 ;   Programmation horloge IKBD
01F3   303A           00859                 movlw YEAR_BCD
01F4   0084           00860                 movwf FSR
01F5   1383           00861                 bcf STATUS,IRP; page 0
01F6   3006           00862                 movlw 6
01F7   00F2           00863                 movwf Counter
01F8                  00864 Loop_Get_Time
01F8   2678           00865                         call SerialReceive; YY, MM, DD, hh, mm, ss
01F9   0080           00866                         movwf INDF
01FA   0A84           00867                         incf FSR,F
01FB   0BF2           00868                         decfsz Counter,F
01FC   29F8           00869                 goto Loop_Get_Time
01FD   01CB           00870                 clrf Counter_5MS
01FE   158A           00871                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)
Message[306]: Crossing page boundary -- ensure page bits are set.
01FF   2189           00872                 call Conv_Inv_BCD_Time
0200   118A           00873                 bcf PCLATH,3; page 0 ou 2
0201   281C           00874                 goto Main
0202                  00875 Not_Time_Set
0202   0873           00876                 movf Value,W
0203   3C1C           00877                 sublw IKBD_INTERROG_TIME_OF_DAY; demande horloge
0204   1D03           00878                 btfss STATUS,Z
0205   2A0A           00879                         goto Not_Interrog_Time
                      00880                 ;--------------------------------------------------------------
                      00881                 ;   Lecture horloge IKBD
0206   2762           00882                 call Leds_Eiffel_On
0207   24CE           00883                 call SendAtariClock
0208   2765           00884                 call Leds_Eiffel_Off
0209   281C           00885                 goto Main
020A                  00886 Not_Interrog_Time
020A   0873           00887                 movf Value,W
020B   3C20           00888                 sublw IKBD_MEMORY_LOAD; chargement memoire
020C   1D03           00889                 btfss STATUS,Z
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

020D   2A38           00890                         goto Not_Memory_Load
                      00891                 ;--------------------------------------------------------------
                      00892                 ;   Chargement memoire possible de 
                      00893                 ;   $00A0 a $00EF, $0120 a $016F, et de $01A0 a $01EF
                      00894                 ;   si l'adresse de base de la commande et le nbre d'octet sont a 0
                      00895                 ;   => programmation Flash en page 2 ($1000 a $1FFF) format Motorola
020E   2678           00896                 call SerialReceive
020F   00F4           00897                 movwf TEMP1; ADRMSB
0210   1383           00898                 bcf STATUS,IRP
0211   1873           00899                 btfsc Value,0; ADRMSB
0212   1783           00900                         bsf STATUS,IRP
0213   2678           00901                 call SerialReceive
0214   0084           00902                 movwf FSR; ADRLSB
0215   2678           00903                 call SerialReceive
0216   00F2           00904                 movwf Counter; NUM
0217   0404           00905                 iorwf FSR,W; ADRLSB
0218   0474           00906                 iorwf TEMP1,W; ADRMSB
0219   1903           00907                 btfsc STATUS,Z
021A   2A31           00908                         goto Prog_Flash; adresse $0000 taille $00 => programmation FLASH
021B                  00909 Loop_Load
021B   2678           00910                         call SerialReceive; => Value
021C   1B83           00911                         btfsc STATUS,IRP
021D   2A20           00912                                 goto Not_Page_0
021E   1F84           00913                         btfss FSR,7
021F   2A2B           00914                                 goto Not_Load; ignore page 0 (utilisee pour les variables)
0220                  00915 Not_Page_0
0220   0804           00916                         movf FSR,W
0221   3960           00917                         andlw 0x60
0222   1903           00918                         btfsc STATUS,Z
0223   2A2B           00919                                 goto Not_Load; ignore adresse < 0x20 (registres)
0224   0804           00920                         movf FSR,W
0225   3970           00921                         andlw 0x70
0226   3C70           00922                         sublw 0x70
0227   1903           00923                         btfsc STATUS,Z
0228   2A2B           00924                                 goto Not_Load; ignore adresse >= 0x70 (variables communes aux 4 pages)
0229   0873           00925                         movf Value,W
022A   0080           00926                         movwf INDF
022B                  00927 Not_Load
022B   0A84           00928                         incf FSR,F
022C   1903           00929                         btfsc STATUS,Z
022D   1783           00930                                 bsf STATUS,IRP
022E   0BF2           00931                         decfsz Counter,F
022F   2A1B           00932                 goto Loop_Load          
0230   281C           00933                 goto Main
0231                  00934 Prog_Flash
                      00935                 ; Indiquer le mode programmation par allumages des trois LEDs
0231   3007           00936                 movlw LEDS_ON
0232   2698           00937                 call cmdLedOnOff
0233   26A7           00938                 call cmdDisableKey
0234   26AF           00939                 call cmdDisableMouse
0235   158A           00940                 bsf PCLATH,3; page 1 (0x800 - 0xFFF) programme Flashage
0236   120A           00941                 bcf PCLATH,4
Message[306]: Crossing page boundary -- ensure page bits are set.
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0237   2801           00942                 goto Ecriture_Flash
0238                  00943 Not_Memory_Load
0238   0873           00944                 movf Value,W
0239   3C21           00945                 sublw IKBD_MEMORY_READ; lecture memoire
023A   1D03           00946                 btfss STATUS,Z
023B   2A7F           00947                         goto Not_Memory_Read
                      00948                 ;--------------------------------------------------------------
                      00949                 ;   Lecture memoire possible partout 
                      00950                 ;   de $0000 a $01FF (registres PIC et RAM)
                      00951                 ;   de $2100 a $20FF (EEPROM)
                      00952                 ;   de $8000 a $FFFF (pour voir toute la FLASH de $0000 a $1FFF
                      00953                 ;                     octet par octet au format Mororola)
023C   2678           00954                 call SerialReceive
023D   00F4           00955                 movwf TEMP1; ADRMSB
023E   1383           00956                 bcf STATUS,IRP
023F   1873           00957                 btfsc Value,0; ADRMSB
0240   1783           00958                         bsf STATUS,IRP
0241   2678           00959                 call SerialReceive
0242   00F5           00960                 movwf Counter2
0243   0084           00961                 movwf FSR; ADRLSB
0244   2762           00962                 call Leds_Eiffel_On
0245   30F6           00963                 movlw HEADER_STATUS; header d'etat
0246   267D           00964                 call SerialTransmit_Host
0247   3020           00965                 movlw IKBD_MEMORY_LOAD; memoire
0248   267D           00966                 call SerialTransmit_Host
0249   1BF4           00967                 btfsc TEMP1,7
024A   2A60           00968                         goto Dump_Flash; lecture FLASH si adresse >= 0x8000
024B   3006           00969                 movlw 6; 6 octets
024C   00F2           00970                 movwf Counter
024D   0874           00971                 movf TEMP1,W
024E   3C21           00972                 sublw 0x21
024F   1903           00973                 btfsc STATUS,Z
0250   2A59           00974                         goto Dump_EEProm; lecture EEProm si adresse 0x21xx
0251                  00975 Loop_Dump_Ram
0251   0800           00976                         movf INDF,W
0252   267D           00977                         call SerialTransmit_Host; data
0253   0A84           00978                         incf FSR,F
0254   1903           00979                         btfsc STATUS,Z
0255   1783           00980                                 bsf STATUS,IRP
0256   0BF2           00981                         decfsz Counter,F
0257   2A51           00982                 goto Loop_Dump_Ram      
0258   2A7D           00983                 goto End_Read
0259                  00984 Dump_EEProm
0259   0875           00985                         movf Counter2,W
025A   2758           00986                         call Lecture_EEProm
025B   267D           00987                         call SerialTransmit_Host; data
025C   0AF5           00988                         incf Counter2,F
025D   0BF2           00989                         decfsz Counter,F
025E   2A59           00990                 goto Dump_EEProm        
025F   2A7D           00991                 goto End_Read
0260                  00992 Dump_Flash
0260   13F4           00993                 bcf TEMP1,7; adresse FLASH poids fort
0261   3003           00994                 movlw 3; 3 mots (6 octets)
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0262   00F2           00995                 movwf Counter   
0263                  00996 Loop_Dump_Flash
                      00997                         READ_FLASH TEMP1,Counter2,BUFFER_FLASH; lecture 2 octets
0263   1703               M                 bsf STATUS,RP1; page 2
0264   1283               M                 bcf STATUS,RP0;
0265   0874               M                 movf TEMP1,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0266   008F               M                 movwf EEADRH; adresse en FLASH
0267   0875               M                 movf Counter2,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0268   008D               M                 movwf EEADR
0269   1683               M                 bsf STATUS,RP0; page 3
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
026A   178C               M                 bsf EECON1,EEPGD; FLASH
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
026B   140C               M                 bsf EECON1,RD; lecture
026C   0000               M                 nop
026D   0000               M                 nop
026E   1283               M                 bcf STATUS,RP0; page 2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
026F   080C               M                 movf EEDATA,W
0270   00FE               M                 movwf BUFFER_FLASH; 1er octet a lire (poids faible)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0271   080E               M                 movf EEDATH,W
0272   00FF               M                 movwf BUFFER_FLASH+1; 2eme octet a lire (poids fort)
0273   1303               M                 bcf STATUS,RP1; page 0
0274   087F           00998                         movf BUFFER_FLASH+1,W
0275   267D           00999                         call SerialTransmit_Host; data poids faible
0276   087E           01000                         movf BUFFER_FLASH,W
0277   267D           01001                         call SerialTransmit_Host; data poids fort
0278   0AF5           01002                         incf Counter2,F
0279   1903           01003                         btfsc STATUS,Z
027A   0AF4           01004                                 incf TEMP1,F
027B   0BF2           01005                         decfsz Counter,F
027C   2A63           01006                 goto Loop_Dump_Flash
027D                  01007 End_Read
027D   2765           01008                 call Leds_Eiffel_Off
027E   281C           01009                 goto Main
027F                  01010 Not_Memory_Read
027F   0873           01011                 movf Value,W
0280   3C22           01012                 sublw IKBD_CONTROLLER_EXECUTE; non gere
0281   1D03           01013                 btfss STATUS,Z
0282   2A86           01014                         goto Not_Execute
0283   2678           01015                 call SerialReceive; ADRMSB
0284   2678           01016                 call SerialReceive; ADRLSB
0285   281C           01017                 goto Main
0286                  01018 Not_Execute
0286   0873           01019                 movf Value,W
0287   3C80           01020                 sublw IKBD_RESET; reset
0288   1D03           01021                 btfss STATUS,Z
0289   2AA3           01022                         goto Not_Reset
028A   2678           01023                 call SerialReceive
028B   3C01           01024                 sublw 1; code reset
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

028C   1D03           01025                 btfss STATUS,Z
028D   281C           01026                         goto Main
                      01027                 ;--------------------------------------------------------------
                      01028                 ;  Commande RESET => Reinitialise Eiffel
                      01029                 ;   - On annule l'indicateur CAPS dans le mot d'etat.
                      01030                 ;   - On arrete les evenements souris et clavier PS/2. 
                      01031                 ;   - On envoi la commande reset au clavier et a la souris PS/2.
                      01032                 ;   - On autorise les transferts IKBD, souris et joystick.
028E   01F8           01033                 clrf MyStatus
028F   01F9           01034                 clrf MyStatus2
0290   01FA           01035                 clrf MyStatus3
0291   01D6           01036                 clrf Status_Joy
0292   01B8           01037                 clrf DEB_INDEX_EM; index courant donnee a envoyer buffer circulaire liaison serie
0293   01B9           01038                 clrf FIN_INDEX_EM; fin index donnee a envoyer buffer circulaire liaison serie
0294   1287           01039                 bcf PORTC,MOTORON; arret ventilateur
0295   2762           01040                 call Leds_Eiffel_On
0296   1B20           01041                 btfsc Status_Boot,POWERUP_KEYB
0297   26A7           01042                         call cmdDisableKey
0298   1BA0           01043                 btfsc Status_Boot,POWERUP_MOUSE
0299   26AF           01044                         call cmdDisableMouse
029A   1B20           01045                 btfsc Status_Boot,POWERUP_KEYB
029B   1779           01046                         bsf MyStatus2,RESET_KEYB; valide reset clavier dans traitement timer
029C   1BA0           01047                 btfsc Status_Boot,POWERUP_MOUSE
029D   17F9           01048                         bsf MyStatus2,RESET_MOUSE; valide reset souris dans traitement timer
029E                  01049 Init_MyStatus
029E   1579           01050                 bsf MyStatus2,JOY_EVENT
029F   16F8           01051                 bsf MyStatus,MOUSE_ENABLE
02A0   1778           01052                 bsf MyStatus,JOY_ENABLE
02A1   17F8           01053                 bsf MyStatus,IKBD_ENABLE        
02A2   281C           01054                 goto Main
02A3                  01055 Not_Reset
                      01056                 ;--------------------------------------------------------------
                      01057                 ;  Commandes de status
02A3   0873           01058                 movf Value,W
02A4   3C87           01059                 sublw IKBD_STATUS_MOUSE_BUT_ACTION; status
02A5   1D03           01060                 btfss STATUS,Z
02A6   2AB0           01061                         goto Not_Mouse_Action
02A7   30F6           01062                 movlw HEADER_STATUS; header d'etat
02A8   267D           01063                 call SerialTransmit_Host
02A9   3007           01064                 movlw IKBD_SET_MOUSE_BUTTON_ACTION
02AA   267D           01065                 call SerialTransmit_Host
02AB   087D           01066                 movf BUTTON_ACTION,W
02AC   267D           01067                 call SerialTransmit_Host
02AD   3005           01068                 movlw 5
02AE   00F2           01069                 movwf Counter   
02AF   2B39           01070                 goto Loop_SerialTransmit_Status
02B0                  01071 Not_Mouse_Action
02B0   0873           01072                 movf Value,W
02B1   3C88           01073                 sublw IKBD_STATUS_MOUSE_MODE_R
02B2   1903           01074                 btfsc STATUS,Z
02B3   2ABC           01075                         goto Mouse_Mode
02B4   0873           01076                 movf Value,W
02B5   3C89           01077                 sublw IKBD_STATUS_MOUSE_MODE_A
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02B6   1903           01078                 btfsc STATUS,Z
02B7   2ABC           01079                         goto Mouse_Mode
02B8   0873           01080                 movf Value,W
02B9   3C8A           01081                 sublw IKBD_STATUS_MOUSE_MODE_K
02BA   1D03           01082                 btfss STATUS,Z
02BB   2AD7           01083                         goto Not_Mouse_Mode
02BC                  01084 Mouse_Mode
02BC   30F6           01085                 movlw HEADER_STATUS; header d'etat
02BD   267D           01086                 call SerialTransmit_Host
02BE   1879           01087                 btfsc MyStatus2,MOUSE_KEYS
02BF   2AD1           01088                         goto Mouse_Mode_Keys
02C0   19F8           01089                 btfsc MyStatus,MOUSE_ABS
02C1   2AC4           01090                         goto Mouse_Mode_Abs
02C2   3008           01091                 movlw IKBD_REL_MOUSE_POS_REPORT
02C3   2B36           01092                 goto End_Env_Status
02C4                  01093 Mouse_Mode_Abs
02C4   3009           01094                 movlw IKBD_ABS_MOUSE_POSITIONING
02C5   267D           01095                 call SerialTransmit_Host
02C6   0866           01096                 movf X_MAX_POSH,W; position X absolue maximale souris poids fort
02C7   267D           01097                 call SerialTransmit_Host; XMSB, X maximum
02C8   0867           01098                 movf X_MAX_POSL,W; position X absolue maximale souris poids faible
02C9   267D           01099                 call SerialTransmit_Host; XLSB
02CA   0868           01100                 movf Y_MAX_POSH,W; position Y absolue maximale souris poids fort
02CB   267D           01101                 call SerialTransmit_Host; YMSB, Y maximum
02CC   0869           01102                 movf Y_MAX_POSL,W; position Y absolue maximale souris poids faible
02CD   267D           01103                 call SerialTransmit_Host; YLSB
02CE   3002           01104                 movlw 2
02CF   00F2           01105                 movwf Counter   
02D0   2B39           01106                 goto Loop_SerialTransmit_Status         
02D1                  01107 Mouse_Mode_Keys
02D1   300A           01108                 movlw IKBD_SET_MOUSE_KEYCODE_CODE
02D2   267D           01109                 call SerialTransmit_Host
02D3   086E           01110                 movf DELTA_X,W; deltax mode keycode souris IKBD
02D4   267D           01111                 call SerialTransmit_Host
02D5   086F           01112                 movf DELTA_Y,W; deltay mode keycode souris IKBD
02D6   2AEE           01113                 goto Send_End_Status
02D7                  01114 Not_Mouse_Mode
02D7   0873           01115                 movf Value,W
02D8   3C8B           01116                 sublw IKBD_STATUS_MOUSE_THRESHOLD
02D9   1D03           01117                 btfss STATUS,Z
02DA   2AE3           01118                         goto Not_Threshold
02DB   30F6           01119                 movlw HEADER_STATUS; header d'etat
02DC   267D           01120                 call SerialTransmit_Host
02DD   300B           01121                 movlw IKBD_SET_MOUSE_THRESHOLD
02DE   267D           01122                 call SerialTransmit_Host
02DF   3001           01123                 movlw 1
02E0   267D           01124                 call SerialTransmit_Host
02E1   3001           01125                 movlw 1
02E2   2AEE           01126                 goto Send_End_Status
02E3                  01127 Not_Threshold
02E3   0873           01128                 movf Value,W
02E4   3C8C           01129                 sublw IKBD_STATUS_MOUSE_SCALE
02E5   1D03           01130                 btfss STATUS,Z
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02E6   2AF2           01131                         goto Not_Scale
02E7   30F6           01132                 movlw HEADER_STATUS; header d'etat
02E8   267D           01133                 call SerialTransmit_Host
02E9   300C           01134                 movlw IKBD_SET_MOUSE_SCALE
02EA   267D           01135                 call SerialTransmit_Host
02EB   085C           01136                 movf X_SCALE,W
02EC   267D           01137                 call SerialTransmit_Host
02ED   085D           01138                 movf Y_SCALE,W
02EE                  01139 Send_End_Status
02EE   267D           01140                 call SerialTransmit_Host
02EF   3004           01141                 movlw 4
02F0   00F2           01142                 movwf Counter
02F1   2B39           01143                 goto Loop_SerialTransmit_Status
02F2                  01144 Not_Scale
02F2   0873           01145                 movf Value,W
02F3   3C8F           01146                 sublw IKBD_STATUS_MOUSE_Y0_AT_B
02F4   1903           01147                 btfsc STATUS,Z
02F5   2AFA           01148                         goto Mouse_Vert
02F6   0873           01149                 movf Value,W
02F7   3C90           01150                 sublw IKBD_STATUS_MOUSE_Y0_AT_T
02F8   1D03           01151                 btfss STATUS,Z
02F9   2B00           01152                         goto Not_Mouse_Vert
02FA                  01153 Mouse_Vert
02FA   30F6           01154                 movlw HEADER_STATUS; header d'etat
02FB   267D           01155                 call SerialTransmit_Host
02FC   300F           01156                 movlw IKBD_SET_Y0_AT_BOTTOM
02FD   1E78           01157                 btfss MyStatus,SIGN_Y
02FE   3010           01158                         movlw IKBD_SET_Y0_AT_TOP
02FF   2B36           01159                 goto End_Env_Status
0300                  01160 Not_Mouse_Vert
0300   0873           01161                 movf Value,W
0301   3C92           01162                 sublw IKDB_STATUS_DISABLE_MOUSE
0302   1D03           01163                 btfss STATUS,Z
0303   2B0A           01164                         goto Not_Mouse_Enable
0304   30F6           01165                 movlw HEADER_STATUS; header d'etat
0305   267D           01166                 call SerialTransmit_Host
0306   0103           01167                 clrw; enabled
0307   1EF8           01168                 btfss MyStatus,MOUSE_ENABLE
0308   3012           01169                         movlw IKDB_DISABLE_MOUSE
0309   2B36           01170                 goto End_Env_Status
030A                  01171 Not_Mouse_Enable
030A   0873           01172                 movf Value,W
030B   3C94           01173                 sublw IKBD_STATUS_JOY_MODE_E
030C   1903           01174                 btfsc STATUS,Z
030D   2B16           01175                         goto Joy_Mode
030E   0873           01176                 movf Value,W
030F   3C95           01177                 sublw IKBD_STATUS_JOY_MODE_I
0310   1903           01178                 btfsc STATUS,Z
0311   2B16           01179                         goto Joy_Mode
0312   0873           01180                 movf Value,W
0313   3C99           01181                 sublw IKBD_STATUS_JOY_MODE_K
0314   1D03           01182                 btfss STATUS,Z
0315   2B2D           01183                         goto Not_Joy_Mode
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0316                  01184 Joy_Mode        
0316   30F6           01185                 movlw HEADER_STATUS; header d'etat
0317   267D           01186                 call SerialTransmit_Host
0318   18F9           01187                 btfsc MyStatus2,JOY_KEYS
0319   2B1E           01188                         goto Joy_Mode_Keys
031A   3014           01189                 movlw IKBD_SET_JOY_EVNT_REPORT
031B   1D79           01190                 btfss MyStatus2,JOY_EVENT
031C   3015           01191                         movlw IKBD_SET_JOY_INTERROG_MODE
031D   2B36           01192                 goto End_Env_Status             
031E                  01193 Joy_Mode_Keys   
031E   3019           01194                 movlw IKBD_SET_JOY_KEYCODE_MODE
031F   267D           01195                 call SerialTransmit_Host
0320   0850           01196                 movf RX_JOY,W
0321   267D           01197                 call SerialTransmit_Host; RX
0322   0851           01198                 movf RY_JOY,W
0323   267D           01199                 call SerialTransmit_Host; RY
0324   0852           01200                 movf TX_JOY,W
0325   267D           01201                 call SerialTransmit_Host; TX
0326   0853           01202                 movf TY_JOY,W
0327   267D           01203                 call SerialTransmit_Host; TY
0328   0854           01204                 movf VX_JOY,W
0329   267D           01205                 call SerialTransmit_Host; VX
032A   0855           01206                 movf VY_JOY,W
032B   267D           01207                 call SerialTransmit_Host; VY
032C   281C           01208                 goto Main
032D                  01209 Not_Joy_Mode
032D   0873           01210                 movf Value,W
032E   3C9A           01211                 sublw IKDB_STATUS_DISABLE_JOY
032F   1D03           01212                 btfss STATUS,Z
0330   281C           01213                         goto Main
0331   30F6           01214                 movlw HEADER_STATUS; header d'etat
0332   267D           01215                 call SerialTransmit_Host
0333   0103           01216                 clrw; enabled
0334   1F78           01217                 btfss MyStatus,JOY_ENABLE
0335   301A           01218                         movlw IKDB_DISABLE_JOYSTICKS
0336                  01219 End_Env_Status
0336   267D           01220                 call SerialTransmit_Host
0337   3006           01221                 movlw 6
0338   00F2           01222                 movwf Counter   
0339                  01223 Loop_SerialTransmit_Status
0339   0103           01224                         clrw
033A   267D           01225                         call SerialTransmit_Host
033B   0BF2           01226                         decfsz Counter,F
033C   2B39           01227                 goto Loop_SerialTransmit_Status         
033D   281C           01228                 goto Main
                      01229 
                      01230                 IF DEBUG_CODE
                      01231 ;-----------------------------------------------------------------------------
                      01232 ;       Mode PC: Pas de translation, envoit direct des Scan-Codes en texte
                      01233 ;       ASCII (BCD) ou binaires directement.
                      01234 
                      01235 ModeKeyPC
                      01236                 bcf PORTB,LEDGREEN; allume LED clavier
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01237                 movf Value,W; code clavier
                      01238                 call SerialTransmit_Host
                      01239                 bsf PORTB,LEDGREEN; eteint LED clavier
                      01240                 goto Main
                      01241                 ENDIF
                      01242 
                      01243 ;-----------------------------------------------------------------------------
                      01244 ;                               Erreurs CLAVIER
                      01245 ;-----------------------------------------------------------------------------
                      01246 
033E                  01247 Error_Keyboard
033E   26A1           01248                 call cmdResetKey
033F   281C           01249                 goto Main
                      01250 
0340                  01251 Error_Parity_Keyboard
0340   26A3           01252                 call cmdResendKey
0341   281C           01253                 goto Main
                      01254 
                      01255 ;-----------------------------------------------------------------------------
                      01256 ;                               Donnees arrivees du CLAVIER
                      01257 ;-----------------------------------------------------------------------------
                      01258 
0342                  01259 doKeyboard
                      01260                 ; Interdire toutes emissions des peripheriques PS/2 (Mouse and Keyboard)
                      01261                 DISABLEKEYB
0342   1683               M                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0343   1086               M                 bcf TRISB,KCLOCK; en sortie
0344   1283               M                 bcf STATUS,RP0; page 0
0345   1086               M                 bcf PORTB,KCLOCK
0346   1FF6           01262                 btfss PARITY,7
0347   2B40           01263                         goto Error_Parity_Keyboard; erreur parite
                      01264                 ; Est ce l'octet de la commande BAT clavier ?
0348   0873           01265                 movf Value,W
0349   3CAA           01266                 sublw CMD_BAT; Self-test passed (keyboard controller init)
034A   1903           01267                 btfsc STATUS,Z; Est ce que W contient $AA ?
034B   2C57           01268                         goto OnKbBAT
034C   0873           01269                 movf Value,W
034D   3CFC           01270                 sublw 0xFC; Error
034E   1903           01271                 btfsc STATUS,Z
034F   2B3E           01272                         goto Error_Keyboard
                      01273 
                      01274                 ; Non, octet autre, on poursuit suivant le mode
                      01275                 ; PS/2 direct OU tranlation ATARI
                      01276 
                      01277                 IF DEBUG_CODE
                      01278                 btfss PORTB,JUMPER4; si jumper4 (+5V): Mode ATARI
                      01279                         goto ModeKeyPC
                      01280                 ENDIF
                      01281                 
                      01282 ;-----------------------------------------------------------------------------
                      01283 ;       Mode Atari: Translation des Scan-Codes PC => Scan-Codes ATARI
                      01284 
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0350                  01285 ModeKeyAtari
0350   0873           01286                 movf Value,W
0351   3CF0           01287                 sublw CMD_RELEASED; est ce que W contient $F0 ?
0352   1D03           01288                 btfss STATUS,Z; si oui on passe
0353   2B56           01289                         goto Not_BreakCode
0354   1679           01290                 bsf MyStatus2,BREAK_CODE; on doit traiter un break code (touche relachee)
0355   281C           01291                 goto Main
0356                  01292 Not_BreakCode
0356   19F9           01293                 btfsc MyStatus2,JOY_MONITOR
0357   2B5B           01294                         goto Not_SendKey
0358   1306           01295                 bcf PORTB,LEDGREEN; allume LED clavier
0359   2664           01296                 call SendAtariKeyboard
035A   1706           01297                 bsf PORTB,LEDGREEN; eteint LED clavier
035B                  01298 Not_SendKey
035B   1279           01299                 bcf MyStatus2,BREAK_CODE; touche enfoncee par defaut
035C   281C           01300                 goto Main
                      01301 
                      01302                 IF DEBUG_CODE
                      01303 ;-----------------------------------------------------------------------------
                      01304 ;       Mode souris PC: envoit direct des codes en texte ASCII (BCD) ou 
                      01305 ;       binaires directement.
                      01306 
                      01307 ModeMsPC
                      01308                 bcf PORTB,LEDYELLOW; allume LED souris
                      01309                 movf Value,W
                      01310                 call SerialTransmit_Host
                      01311                 bsf PORTB,LEDYELLOW; eteint LED souris
                      01312                 goto Main
                      01313                 ENDIF
                      01314 
                      01315 ;-----------------------------------------------------------------------------
                      01316 ;                               Erreurs SOURIS
                      01317 ;-----------------------------------------------------------------------------
                      01318 
035D                  01319 Error_Mouse
035D   26A9           01320                 call cmdResetMouse
035E   281C           01321                 goto Main
                      01322                 
035F                  01323 Error_Parity_Mouse
                      01324                 IF SCROOL_LOCK_ERR
                      01325                 call UpdateLedOnOff
                      01326                 ENDIF
035F   26AB           01327                 call cmdResendMouse
0360   01C8           01328                 clrf Counter_Mouse; toute la trame est envoyee de nouveau
0361   281C           01329                 goto Main
                      01330                 
                      01331 ;-----------------------------------------------------------------------------
                      01332 ;                               Donnees arrivees de la SOURIS
                      01333 ;-----------------------------------------------------------------------------
                      01334                 
0362                  01335 doMouse
                      01336                 ; Interdire toutes emissions des peripheriques PS/2 (Mouse and Keyboard)
                      01337                 DISABLEMOUSE
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0362   1683               M                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0363   1186               M                 bcf TRISB,MCLOCK; en sortie
0364   1283               M                 bcf STATUS,RP0; page 0
0365   1186               M                 bcf PORTB,MCLOCK
0366   1FF6           01338                 btfss PARITY,7
0367   2B5F           01339                         goto Error_Parity_Mouse
0368   0848           01340                 movf Counter_Mouse,W
0369   1D03           01341                 btfss STATUS,Z
036A   2B73           01342                         goto Not_BatMouse; <> 1st byte
                      01343                 ; Est ce l'octet de la commande BAT souris ?
036B   0873           01344                 movf Value,W
036C   3CAA           01345                 sublw CMD_BAT; Self-test passed
036D   1903           01346                 btfsc STATUS,Z; Est ce que W contient $AA ?
036E   2C5F           01347                         goto OnMsBAT
036F   0873           01348                 movf Value,W
0370   3CFC           01349                 sublw 0xFC; Error
0371   1903           01350                 btfsc STATUS,Z
0372   2B5D           01351                         goto Error_Mouse
0373                  01352 Not_BatMouse
                      01353                 IF DEBUG_CODE
                      01354                 btfss PORTB,JUMPER4; si jumper4 (+5V): Mode ATARI
                      01355                         goto ModeMsPC
                      01356                 ENDIF
                      01357                 
                      01358 ;-----------------------------------------------------------------------------
                      01359 ;       Mode souris Atari: On convertie les paquets d'octets en trame Atari.
                      01360 
0373                  01361 ModeMsAtari
0373   0AC8           01362                 incf Counter_Mouse,F; compteur pour traiter chaque octet recu via la boucle principale (
                            Main)
0374   0848           01363                 movf Counter_Mouse,W
0375   3C01           01364                 sublw 1
0376   1903           01365                 btfsc STATUS,Z
0377   2B81           01366                         goto First_Byte; 1er octet
0378   0848           01367                 movf Counter_Mouse,W
0379   3C02           01368                 sublw 2
037A   1903           01369                 btfsc STATUS,Z
037B   2B8B           01370                         goto Second_Byte; 2eme octet (X)
037C   0848           01371                 movf Counter_Mouse,W
037D   3C03           01372                 sublw 3
037E   1903           01373                 btfsc STATUS,Z
037F   2B8E           01374                         goto Third_Byte; 3eme octet (Y)
0380   2B94           01375                 goto Fourth_Byte; 4eme octet eventuel (Z)
0381                  01376 First_Byte              
0381   0873           01377                 movf Value,W
0382   00C4           01378                 movwf Value_0; test de validite de Value_0
0383   1BC4           01379                 btfsc Value_0,7
0384   2B89           01380                         goto Pb_Trame_Mouse; Y overflow
0385   1B44           01381                 btfsc Value_0,6
0386   2B89           01382                         goto Pb_Trame_Mouse; X overflow
0387   19C4           01383                 btfsc Value_0,3
0388   281C           01384                         goto Main
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01385                 ; le bit 3 doit toujours etre a 1
0389                  01386 Pb_Trame_Mouse
0389   01C8           01387                 clrf Counter_Mouse; decalage dans la lecture de la trame
038A   281C           01388                 goto Main
038B                  01389 Second_Byte
038B   0873           01390                 movf Value,W
038C   00C5           01391                 movwf Value_X; Value X mouvement
038D   281C           01392                 goto Main
038E                  01393 Third_Byte              
038E   0873           01394                 movf Value,W
038F   00C6           01395                 movwf Value_Y; Value Y mouvement
0390   1CF8           01396                 btfss MyStatus,MSWHEEL
0391   2B96           01397                         goto Normal_Mouse
0392   01C7           01398                 clrf Value_Z
0393   281C           01399                 goto Main
0394                  01400 Fourth_Byte
0394   0873           01401                 movf Value,W
0395   00C7           01402                 movwf Value_Z; Value Z mouvement (-8 a 7)
0396                  01403 Normal_Mouse
0396   01C8           01404                 clrf Counter_Mouse
0397   01A3           01405                 clrf BUTTONS; etat des boutons souris
0398   1844           01406                 btfsc Value_0,PC_LEFT; tester si bouton gauche souris a 1
0399   14A3           01407                         bsf BUTTONS,AT_LEFT; si 1 mettre mettre celui Atari a 1
039A   18C4           01408                 btfsc Value_0,PC_RIGHT; tester si bouton droit souris a 1
039B   1423           01409                         bsf BUTTONS,AT_RIGHT; si 1 mettre celui Atari a 1
039C   0823           01410                 movf BUTTONS,W
039D   38F8           01411                 iorlw HEADER_RELATIVE_MOUSE; header souris mode relatif (0xF8 - 0xFB)
039E   00C0           01412                 movwf HEADER_IKBD               
                      01413 
                      01414                 ;-------------------------------------------------------------
                      01415                 ;   Nouveaute: au lieu de simuler un appui droit et gauche, on genere un scan-code
                      01416                 ; on ecrit des 0 pour ne pas transmettre ensuite
039F   01C3           01417                 clrf CLIC_MOUSE_WHEEL; touche bouton 3
03A0   01C1           01418                 clrf KEY_MOUSE_WHEEL; touche roulette bouton 3
03A1   01C2           01419                 clrf KEY2_MOUSE_WHEEL; touche boutons 4 & 5
03A2   1D44           01420                 btfss Value_0,PC_MIDDLE; tester si bouton central souris a 1
03A3   2BA7           01421                         goto Compteurs_Mouse
03A4   3094           01422                 movlw Tab_Mouse-EEProm+IDX_BUTTON3
03A5   2758           01423                 call Lecture_EEProm
03A6   00C3           01424                 movwf CLIC_MOUSE_WHEEL
                      01425                 ;-------------------------------------------------------------
03A7                  01426 Compteurs_Mouse
                      01427                 ;-------------------------------------------------------------
                      01428                 ;   traiter le compteur X
03A7   13C5           01429                 bcf Value_X,AT_SIGN; Ramener la valeur sur 7 bits
03A8   1A44           01430                 btfsc Value_0,PC_SIGNX; tester le bit de signe PC pour X
03A9   17C5           01431                         bsf Value_X,AT_SIGN; est leve alors on leve le signe Atari
03AA   0845           01432                 movf Value_X,W
03AB   00EA           01433                 movwf X_MOV; ecrire le resultat dans le compteur X Atari
03AC   1DF8           01434                 btfss MyStatus,MOUSE_ABS
03AD   2BD1           01435                         goto Not_Max_X; <> mode absolu          
03AE   01F7           01436                 clrf TEMP2; positif
03AF   1BC5           01437                 btfsc Value_X,7
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03B0   09F7           01438                         comf TEMP2,F; negatif
03B1   07DF           01439                 addwf X_POSL,F; position X absolue souris poids faible
03B2   0877           01440                 movf TEMP2,W
03B3   1803           01441                 btfsc STATUS,C
03B4   0F77           01442                         incfsz TEMP2,W
03B5   07DE           01443                 addwf X_POSH,F; X_POS = X_POS + X_MOV
03B6   1BDE           01444                 btfsc X_POSH,7; signe position X absolue souris poids fort
03B7   2BD0           01445                         goto Dep_Min_X; si X_POS < 0 -> X_POS = 0
03B8   158A           01446                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)
Message[306]: Crossing page boundary -- ensure page bits are set.
03B9   2142           01447                 call Conv_Scale_X
03BA   118A           01448                 bcf PCLATH,3; page 0 ou 2
03BB   0866           01449                 movf X_MAX_POSH,W; position X absolue maximale souris poids fort
03BC   0262           01450                 subwf X_POSH_SCALED,W; position X absolue souris avec facteur d'echelle poids fort
03BD   1903           01451                 btfsc STATUS,Z
03BE   2BC2           01452                         goto XCompl
03BF   1C03           01453                 btfss STATUS,C
03C0   2BD1           01454                         goto Not_Max_X; X_POS < X_MAX_POS 
03C1   2BC8           01455                 goto Dep_Max_X; X_POS > X_MAX_POS               
03C2   0867           01456 XCompl          movf X_MAX_POSL,W; position X absolue maximale souris poids faible
03C3   0263           01457                 subwf X_POSL_SCALED,W; position X absolue souris avec facteur d'echelle poids faible
03C4   1903           01458                 btfsc STATUS,Z
03C5   2BC8           01459                         goto Dep_Max_X; X_POS = X_MAX_POS
03C6   1C03           01460                 btfss STATUS,C
03C7   2BD1           01461                         goto Not_Max_X; X_POS < X_MAX_POS       
03C8                  01462 Dep_Max_X
03C8   0867           01463                 movf X_MAX_POSL,W
03C9   00E3           01464                 movwf X_POSL_SCALED
03CA   0866           01465                 movf X_MAX_POSH,W
03CB   00E2           01466                 movwf X_POSH_SCALED; si X_POS >= X_MAX_POS -> X_POS = X_MAX_POS
03CC   158A           01467                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)
Message[306]: Crossing page boundary -- ensure page bits are set.
03CD   2128           01468                 call Conv_Inv_Scale_X
03CE   118A           01469                 bcf PCLATH,3; page 0 ou 2
03CF   2BD1           01470                 goto Not_Max_X
03D0                  01471 Dep_Min_X
03D0   2470           01472                 call Init_X_Abs
03D1                  01473 Not_Max_X
                      01474                 ;-------------------------------------------------------------
                      01475                 ;   traiter le compteur Y 
03D1   13C6           01476                 bcf Value_Y,AT_SIGN; Ramener la valeur sur 7 bits 
03D2   1AC4           01477                 btfsc Value_0,PC_SIGNY; tester le bit de signe PC pour Y
03D3   17C6           01478                         bsf Value_Y,AT_SIGN; est leve alors on leve le signe Atari
                      01479                 ; Le mouvement PS/2 et Atari est inverse par defaut
03D4   1A78           01480                 btfsc MyStatus,SIGN_Y
03D5   2BD8           01481                         goto Not_Inv_Y; inversion de sens Y IKBD
                      01482                 ;complement a deux pour inverser le mouvement Y: on ne traite que +127/-128
                      01483                 ;ex: $FF %11111111 d-1 => $01 %00000001 d+1
03D6   09C6           01484                 comf Value_Y,F
03D7   0AC6           01485                 incf Value_Y,F
03D8                  01486 Not_Inv_Y
03D8   0846           01487                 movf Value_Y,W
03D9   00EB           01488                 movwf Y_MOV; ecrire le resultat dans le compteur Y Atari
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03DA   1DF8           01489                 btfss MyStatus,MOUSE_ABS
03DB   2BFF           01490                         goto Not_Max_Y; <> mode absolu
03DC   01F7           01491                 clrf TEMP2; positif
03DD   1BC6           01492                 btfsc Value_Y,7
03DE   09F7           01493                         comf TEMP2,F; negatif
03DF   07E1           01494                 addwf Y_POSL,F; position Y absolue souris poids faible
03E0   0877           01495                 movf TEMP2,W
03E1   1803           01496                 btfsc STATUS,C
03E2   0F77           01497                         incfsz TEMP2,W
03E3   07E0           01498                 addwf Y_POSH,F; Y_POS = Y_POS + Y_MOV
03E4   1BE0           01499                 btfsc Y_POSH,7; signe position Y absolue souris poids fort
03E5   2BFE           01500                         goto Dep_Min_Y; si Y_POS < 0 -> Y_POS = 0
03E6   158A           01501                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)               
Message[306]: Crossing page boundary -- ensure page bits are set.
03E7   214D           01502                 call Conv_Scale_Y
03E8   118A           01503                 bcf PCLATH,3; page 0 ou 2
03E9   0868           01504                 movf Y_MAX_POSH,W; position Y absolue maximale souris poids fort
03EA   0264           01505                 subwf Y_POSH_SCALED,W; position Y absolue souris avec facteur d'echelle poids fort
03EB   1903           01506                 btfsc STATUS,Z
03EC   2BF0           01507                         goto YCompl
03ED   1C03           01508                 btfss STATUS,C
03EE   2BFF           01509                         goto Not_Max_Y; Y_POS < Y_MAX_POS 
03EF   2BF6           01510                 goto Dep_Max_Y; Y_POS > Y_MAX_POS               
03F0                  01511 YCompl
03F0   0869           01512                 movf Y_MAX_POSL,W; position Y absolue maximale souris poids faible
03F1   0265           01513                 subwf Y_POSL_SCALED,W; position Y absolue souris avec facteur d'echelle poids faible
03F2   1903           01514                 btfsc STATUS,Z
03F3   2BF6           01515                         goto Dep_Max_Y; X_POS = Y_MAX_POS
03F4   1C03           01516                 btfss STATUS,C
03F5   2BFF           01517                         goto Not_Max_Y; Y_POS < Y_MAX_POS       
03F6                  01518 Dep_Max_Y
03F6   0869           01519                 movf Y_MAX_POSL,W
03F7   00E5           01520                 movwf Y_POSL_SCALED
03F8   0868           01521                 movf Y_MAX_POSH,W
03F9   00E4           01522                 movwf Y_POSH_SCALED; si Y_POS >= Y_MAX_POS -> Y_POS = Y_MAX_POS
03FA   158A           01523                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)
Message[306]: Crossing page boundary -- ensure page bits are set.
03FB   2135           01524                 call Conv_Inv_Scale_Y
03FC   118A           01525                 bcf PCLATH,3; page 0 ou 2
03FD   2BFF           01526                 goto Not_Max_Y
03FE                  01527 Dep_Min_Y
03FE   246B           01528                 call Init_Y_Abs
03FF                  01529 Not_Max_Y
                      01530                 ;------------------------------------------------------------
                      01531                 ; On recoit le compteur Z, si c'est une souris a roulette
03FF   1CF8           01532                 btfss MyStatus,MSWHEEL
0400   2C27           01533                         goto TransmitHost; si bit souris a roulette a zero on transmet maintenant
                      01534                 ; Cas de l'InteliMouse, traiter le compteur Z
0401   19C7           01535                 btfsc Value_Z,PC_SIGNZ; Est ce une valeur negative
0402   2C11           01536                         goto ZNegatif
                      01537                 ; tester si la valeur sur les 4bits [3-0] est egale a 0 ou pas
0403   0847           01538                 movf Value_Z,W; charger w avec la valeur
0404   390F           01539                 andlw 0x0F; masquer et traiter le compteur Z sur 4 bits
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 46


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0405   1903           01540                 btfsc STATUS,Z
0406   2C1A           01541                         goto ZZero
                      01542                 ;-------------------------------------------------------------
                      01543                 ; Valeur positive: Molette verticale vers LE BAS
                      01544                 ; ou molette horizontale vers LA DROITE
0407   1C47           01545                 btfss Value_Z,PC_BITLSBZ; si le BIT 0 est a 1 on donc 0x1 => Molette verticale
0408   2C0D           01546                         goto ZGauche; aller en molette horizontale
0409   3091           01547                 movlw Tab_Mouse-EEProm+IDX_WHEELDN
040A   2758           01548                 call Lecture_EEProm
040B   00C1           01549                 movwf KEY_MOUSE_WHEEL; valeur positive donc EN BAS toute
040C   2C1A           01550                 goto ZZero
040D                  01551 ZGauche
040D   3092           01552                 movlw Tab_Mouse-EEProm+IDX_WHEELLT
040E   2758           01553                 call Lecture_EEProm
040F   00C1           01554                 movwf KEY_MOUSE_WHEEL; valeur positive donc A GAUCHE toute
0410   2C1A           01555                 goto ZZero
0411                  01556 ZNegatif
                      01557                 ;-------------------------------------------------------------
                      01558                 ; Valeur negative: Molette verticale vers LE HAUT
                      01559                 ; ou molette horizontale vers LA GAUCHE
0411   1C47           01560                 btfss Value_Z,PC_BITLSBZ;si le BIT 0 est a 1 on donc 0xF => Molette verticale
0412   2C17           01561                         goto ZDroit; aller en molette horizontale
0413   3090           01562                 movlw Tab_Mouse-EEProm+IDX_WHEELUP
0414   2758           01563                 call Lecture_EEProm
0415   00C1           01564                 movwf KEY_MOUSE_WHEEL; valeur negative -1 donc EN HAUT toute
0416   2C1A           01565                 goto ZZero
0417                  01566 ZDroit
0417   3093           01567                 movlw Tab_Mouse-EEProm+IDX_WHEELRT
0418   2758           01568                 call Lecture_EEProm
0419   00C1           01569                 movwf KEY_MOUSE_WHEEL; valeur negative -2 donc A DROITE toute
041A                  01570 ZZero
                      01571                 ;-------------------------------------------------------------
                      01572                 ; Si la InteliMouse ET 5 boutons tester l'etat
041A   1D78           01573                 btfss MyStatus,MSWHEELPLUS;si bit WheelPlus a zero on transmet maintenant, il n'a pas de
041B   2C27           01574                         goto TransmitHost; boutons 4&5 et 2eme molette
041C   1E47           01575                 btfss Value_Z,PC_BUTTON4; bouton 4 actif ?
041D   2C22           01576                         goto Prochain_Bouton; tester le prochain bouton (le 5)
041E   3095           01577                 movlw Tab_Mouse-EEProm+IDX_BUTTON4
041F   2758           01578                 call Lecture_EEProm
0420   00C2           01579                 movwf KEY2_MOUSE_WHEEL; Scan-code associe au bouton 4
0421   2C27           01580                 goto TransmitHost; on transmet maintenant
0422                  01581 Prochain_Bouton
0422   1EC7           01582                 btfss Value_Z,PC_BUTTON5; ;bouton 5 actif ?
0423   2C27           01583                         goto TransmitHost; on transmet maintenant
0424   3096           01584                 movlw Tab_Mouse-EEProm+IDX_BUTTON5
0425   2758           01585                 call Lecture_EEProm
0426   00C2           01586                 movwf KEY2_MOUSE_WHEEL; Scan-code associe au bouton 5
0427                  01587 TransmitHost
                      01588                 ;-------------------------------------------------------------
                      01589                 ; Envoyer enfin le paquet souris au host
0427   1EF8           01590                 btfss MyStatus,MOUSE_ENABLE
0428   281C           01591                         goto Main; pas d'autorisation de l'Atari
0429   19F9           01592                 btfsc MyStatus2,JOY_MONITOR
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 47


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

042A   281C           01593                         goto Main; monitoring joysticks en cours demande par l'Atari
042B   1386           01594                 bcf PORTB,LEDYELLOW; allume LED souris
042C   25C4           01595                 call SendAtariMouse; relative
                      01596                 ;-------------------------------------------------------------
                      01597                 ; Test mode IKBD button action
042D   1C7D           01598                 btfss BUTTON_ACTION,0; bouton enfonce => envoi position absolue
042E   2C3D           01599                         goto Not_Action_0
042F   0823           01600                 movf BUTTONS,W; etat des boutons souris
0430   0624           01601                 xorwf OLD_BUTTONS,W; ancien etat des boutons souris
0431   3901           01602                 andlw 1         
0432   1903           01603                 btfsc STATUS,Z
0433   2C36           01604                         goto Not_Change_A
0434   1823           01605                 btfsc BUTTONS,0
0435   2C4D           01606                         goto Env_Action; bouton droit enfonce
0436                  01607 Not_Change_A
0436   0823           01608                 movf BUTTONS,W; etat des boutons souris
0437   0624           01609                 xorwf OLD_BUTTONS,W; ancien etat des boutons souris
0438   3902           01610                 andlw 2         
0439   1903           01611                 btfsc STATUS,Z
043A   2C3D           01612                         goto Not_Action_0
043B   18A3           01613                 btfsc BUTTONS,1
043C   2C4D           01614                         goto Env_Action; bouton gauche enfonce
043D                  01615 Not_Action_0
043D   1CFD           01616                 btfss BUTTON_ACTION,1; bouton relache => envoi position absolue
043E   2C53           01617                         goto Not_Action_1       
043F   0823           01618                 movf BUTTONS,W; etat des boutons souris
0440   0624           01619                 xorwf OLD_BUTTONS,W; ancien etat des boutons souris
0441   3901           01620                 andlw 1         
0442   1903           01621                 btfsc STATUS,Z
0443   2C46           01622                         goto Not_Change_B
0444   1C23           01623                 btfss BUTTONS,0
0445   2C4D           01624                         goto Env_Action; bouton droit relache
0446                  01625 Not_Change_B
0446   0823           01626                 movf BUTTONS,W; etat des boutons souris
0447   0624           01627                 xorwf OLD_BUTTONS,W; ancien etat des boutons souris
0448   3902           01628                 andlw 2         
0449   1903           01629                 btfsc STATUS,Z
044A   2C53           01630                         goto Not_Action_1
044B   18A3           01631                 btfsc BUTTONS,1; bouton gauche relache
044C   2C53           01632                         goto Not_Action_1
044D                  01633 Env_Action
044D   0823           01634                 movf BUTTONS,W; etat des boutons souris
044E   00A5           01635                 movwf OLD_BUTTONS_ABS; ancien etat des boutons souris en mode absolu
044F   09A5           01636                 comf OLD_BUTTONS_ABS,F; force l'envoi des changements d'etat
0450   30F7           01637                 movlw HEADER_ABSOLUTE_MOUSE; header souris mode absolu
0451   00C0           01638                 movwf HEADER_IKBD
0452   25C4           01639                 call SendAtariMouse
0453                  01640 Not_Action_1
0453   1786           01641                 bsf PORTB,LEDYELLOW; eteint LED souris
0454   0823           01642                 movf BUTTONS,W; etat des boutons souris
0455   00A4           01643                 movwf OLD_BUTTONS; ancien etat des boutons souris               
0456   281C           01644                 goto Main
                      01645                 
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 48


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01646 ;-----------------------------------------------------------------------------
                      01647 ; Reception de la commande BAT CLAVIER: On bascule le clavier en mode jeux 3
                      01648 ;-----------------------------------------------------------------------------
                      01649 
0457                  01650 OnKbBAT
0457   269D           01651                 call cmdScanSet3
0458   2696           01652                 call cmdMakeBreak
                      01653 ;               call cmdTypeRate
0459   26A5           01654                 call cmdEnableKey
045A   3002           01655                 movlw CAPS_OFF; Allumer Verr.Num., pas de CAPS lock
045B   2698           01656                 call cmdLedOnOff
045C   1706           01657                 bsf PORTB,LEDGREEN; Eteindre la LED VERTE pour montrer le onBAT
045D   1720           01658                 bsf Status_Boot,POWERUP_KEYB
045E   281C           01659                 goto Main
                      01660                 
                      01661 ;-----------------------------------------------------------------------------
                      01662 ; Reception de la commande BAT SOURIS: On autorise la communication souris
                      01663 ;-----------------------------------------------------------------------------
                      01664 
045F                  01665 OnMsBAT
045F   26AD           01666                 call cmdEnableMous
0460   2644           01667                 call TryWheel; detecter si la souris est a roulette
0461   18F8           01668                 btfsc MyStatus,MSWHEEL; si c'est un souris a roulette
0462   2654           01669                         call TryWheelPlus; Detecter si est pluse encore
0463   1786           01670                 bsf PORTB,LEDYELLOW; Eteindre la LED JAUNE pour montrer le onBAT
0464   17A0           01671                 bsf Status_Boot,POWERUP_MOUSE
0465   281C           01672                 goto Main
                      01673                 
                      01674 ;=============================================================================
                      01675 ;                               PROCEDURES ET FONCTIONS
                      01676 ;=============================================================================
                      01677 
                      01678 ;-----------------------------------------------------------------------------
                      01679 ;               Forcage a 1 si 0
                      01680 ;-----------------------------------------------------------------------------
                      01681                 
0466                  01682 Change_0_To_1
0466   3800           01683                 iorlw 0
0467   1903           01684                 btfsc STATUS,Z
0468   3001           01685                         movlw 1
0469   0008           01686                 return
                      01687                 
                      01688 ;-----------------------------------------------------------------------------
                      01689 ;               Remise a 0 variables 
                      01690 ;-----------------------------------------------------------------------------
                      01691                 
046A                  01692 Init_X_Y_Abs
046A   2470           01693                 call Init_X_Abs
                      01694 
046B                  01695 Init_Y_Abs
046B   01E1           01696                 clrf Y_POSL
046C   01E0           01697                 clrf Y_POSH
046D   01E5           01698                 clrf Y_POSL_SCALED; position Y absolue souris avec facteur d'echelle poids faible
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 49


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

046E   01E4           01699                 clrf Y_POSH_SCALED; position Y absolue souris avec facteur d'echelle poids fort
046F   0008           01700                 return
                      01701                 
0470                  01702 Init_X_Abs      
0470   01DF           01703                 clrf X_POSL
0471   01DE           01704                 clrf X_POSH
0472   01E3           01705                 clrf X_POSL_SCALED; position X absolue souris avec facteur d'echelle poids faible
0473   01E2           01706                 clrf X_POSH_SCALED; position X absolue souris avec facteur d'echelle poids fort
0474   0008           01707                 return
                      01708 
                      01709 ;-----------------------------------------------------------------------------
                      01710 ;               Lecture temperature CTN sur AN0
                      01711 ;-----------------------------------------------------------------------------
                      01712 
0475                  01713 Read_Temp
0475   081E           01714                 movf ADRESH,W; 8 bits poids fort
0476   0222           01715                 subwf Val_AN0,W; lecture CTN sur AN0
0477   1903           01716                 btfsc STATUS,Z
0478   0008           01717                         Return; pas de changement
0479   30AA           01718                 movlw Tab_Temp-EEProm+IDX_T0_AN0
047A   2758           01719                 call Lecture_EEProm
047B   00F4           01720                 movwf TEMP1
047C   081E           01721                 movf ADRESH,W; 8 bits poids fort
047D   00A2           01722                 movwf Val_AN0; lecture CTN sur AN0
047E   02F4           01723                 subwf TEMP1,F; IDX_T0_AN0 - Val_AN0  
047F   1C03           01724                 btfss STATUS,C
0480   01F4           01725                         clrf TEMP1; Val_AN0 > IDX_T0_AN0
0481   30AB           01726                 movlw Tab_Temp-EEProm+IDX_SCALETEMP
0482   2758           01727                 call Lecture_EEProm 
0483   00F2           01728                 movwf Counter
0484   01C9           01729                 clrf Temp; poids faible, TEMP2:Temp = (IDX_T0_AN0 - Val_AN0) * IDX_SCALETEMP
0485   01F7           01730                 clrf TEMP2; poids fort
0486                  01731 Loop_Scale_Temp
0486   0874           01732                         movf TEMP1,W
0487   07C9           01733                         addwf Temp,F
0488   0103           01734                         clrw 
0489   1803           01735                         btfsc STATUS,C
048A   3001           01736                                 movlw 1
048B   07F7           01737                         addwf TEMP2,F
048C   0BF2           01738                         decfsz Counter,F
048D   2C86           01739                 goto Loop_Scale_Temp
048E   3006           01740                 movlw 6; / 64
048F   00F2           01741                 movwf Counter
0490                  01742 Loop_Scale2_Temp
                      01743                 ; temperature = TEMP2:Temp = (IDX_T0_AN0 - Val_AN0) * IDX_SCALETEMP / 64
0490   0CF7           01744                         rrf TEMP2,F; poids fort
0491   0CC9           01745                         rrf Temp,F; poids faible
0492   0BF2           01746                         decfsz Counter,F
0493   2C90           01747                 goto Loop_Scale2_Temp
0494   30A8           01748                 movlw Tab_Temp-EEProm+IDX_LEVELHTEMP
0495   2758           01749                 call Lecture_EEProm
0496   0249           01750                 subwf Temp,W; Temp - IDX_LEVELHTEMP
0497   1803           01751                 btfsc STATUS,C
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 50


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0498   1687           01752                         bsf PORTC,MOTORON; Temp >= IDX_LEVELHTEMP -> marche ventilateur 
0499   30A9           01753                 movlw Tab_Temp-EEProm+IDX_LEVELLTEMP
049A   2758           01754                 call Lecture_EEProm
049B   0249           01755                 subwf Temp,W; Temp - IDX_LEVELLTEMP
049C   1C03           01756                 btfss STATUS,C
049D   1287           01757                         bcf PORTC,MOTORON; Temp < IDX_LEVELTEMP -> arret ventilateur    
049E   0008           01758                 return
                      01759 
                      01760 ;-----------------------------------------------------------------------------
                      01761 ;               Increment horloge
                      01762 ;              
                      01763 ;               SEC, MIN, HRS, DAY, MONTH, YEAR sont dans une zone en page 2
                      01764 ;               non reinitialisee au Reset.
                      01765 ;               La fonction ne tient pas compte des annees bissextiles. 
                      01766 ;-----------------------------------------------------------------------------
                      01767 
049F                  01768 INC_Clock
049F   01CB           01769                 clrf Counter_5MS
04A0   191F           01770                 btfsc ADCON0,GO_DONE
04A1   2CA4           01771                         goto Not_Read_Temp
04A2   2475           01772                 call Read_Temp; lecture temperature toutes les secondes
04A3   151F           01773                 bsf ADCON0,GO_DONE; relance la conversion
04A4                  01774 Not_Read_Temp
04A4   1703           01775                 bsf STATUS,RP1; page 2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04A5   0A95           01776                 incf SEC,F; seconde suivante
04A6   303C           01777                 movlw 60
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04A7   0215           01778                 subwf SEC,W
04A8   1C03           01779                 btfss STATUS,C
04A9   2CCC           01780                         goto End_INC_Clock
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04AA   0195           01781                 clrf SEC
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04AB   0A94           01782                 incf MIN,F; minute suivante
04AC   303C           01783                 movlw 60
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04AD   0214           01784                 subwf MIN,W
04AE   1C03           01785                 btfss STATUS,C
04AF   2CCC           01786                         goto End_INC_Clock
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04B0   0194           01787                 clrf MIN
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04B1   0A93           01788                 incf HRS,F; heure suivante
04B2   3018           01789                 movlw 24
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04B3   0213           01790                 subwf HRS,W
04B4   1C03           01791                 btfss STATUS,C
04B5   2CCC           01792                         goto End_INC_Clock
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04B6   0193           01793                 clrf HRS
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04B7   0A92           01794                 incf DAY,F; jour suivant
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 51


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04B8   0811           01795                 movf MONTH,W
04B9   390F           01796                 andlw 0x0F
04BA   2006           01797                 call Days_In_Month; nombre de jours dans le mois
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04BB   0212           01798                 subwf DAY,W
04BC   1C03           01799                 btfss STATUS,C
04BD   2CCC           01800                         goto End_INC_Clock
04BE   3001           01801                 movlw 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04BF   0092           01802                 movwf DAY
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04C0   0A91           01803                 incf MONTH,F; mois suivant
04C1   300D           01804                 movlw 13
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04C2   0211           01805                 subwf MONTH,W
04C3   1C03           01806                 btfss STATUS,C
04C4   2CCC           01807                         goto End_INC_Clock
04C5   3001           01808                 movlw 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04C6   0091           01809                 movwf MONTH
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04C7   0A90           01810                 incf YEAR,F; annes suivante
04C8   3064           01811                 movlw 100
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04C9   0210           01812                 subwf YEAR,W
04CA   1803           01813                 btfsc STATUS,C
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
04CB   0190           01814                         clrf YEAR
04CC                  01815 End_INC_Clock
04CC   1303           01816                 bcf STATUS,RP1; page 0
04CD   0008           01817                 return          
                      01818 
                      01819 ;-----------------------------------------------------------------------------
                      01820 ;       Procedure de transmission des octets a propos de l'horloge.
                      01821 ;-----------------------------------------------------------------------------
                      01822                 
04CE                  01823 SendAtariClock
04CE   158A           01824                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)
Message[306]: Crossing page boundary -- ensure page bits are set.
04CF   21AB           01825                 call Conv_BCD_Time
04D0   118A           01826                 bcf PCLATH,3; page 0 ou 2
04D1   30FC           01827                 movlw HEADER_TIME_OF_DAY; header horloge
04D2   267D           01828                 call SerialTransmit_Host
04D3   303A           01829                 movlw YEAR_BCD
04D4   0084           01830                 movwf FSR; pointe sur le 1er element envoye c'est a dire l'annee
04D5   1383           01831                 bcf STATUS,IRP; page 0
04D6   3006           01832                 movlw 6; 6 octets
04D7   00F2           01833                 movwf Counter
04D8                  01834 Loop_Env_Time
04D8   0800           01835                         movf INDF,W             
04D9   267D           01836                         call SerialTransmit_Host; YY, MM, DD, hh, mm, ss
04DA   0A84           01837                         incf FSR,F
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 52


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

04DB   0BF2           01838                         decfsz Counter,F
04DC   2CD8           01839                 goto Loop_Env_Time; element suivant
04DD   0008           01840                 return
                      01841 
                      01842 ;-----------------------------------------------------------------------------
                      01843 ;       Procedure de transmission des octets a propos du (ou des) joystick(s).
                      01844 ;-----------------------------------------------------------------------------
                      01845                 
04DE                  01846 SendAtariJoysticks
04DE   0840           01847                 movf HEADER_IKBD,W
04DF   3CFD           01848                 sublw HEADER_JOYSTICKS; header joysticks
04E0   1D03           01849                 btfss STATUS,Z
04E1   2CE8           01850                         goto Not_Joy01
                      01851                 ;-------------------------------------------------------------
                      01852                 ; TRANSMETTRE le paquet Atari (3 octets) des joysticks
04E2   0840           01853                 movf HEADER_IKBD,W
04E3   267D           01854                 call SerialTransmit_Host
04E4   0826           01855                 movf JOY0,W; lecture joystick 0
04E5   24FF           01856                 call SerialTransmit_Host_Joy
04E6   0827           01857                 movf JOY1,W; lecture joystick 1
04E7   2CFF           01858                 goto SerialTransmit_Host_Joy
04E8                  01859 Not_Joy01
04E8   0840           01860                 movf HEADER_IKBD,W
04E9   3CFE           01861                 sublw HEADER_JOYSTICK0; header joystick 0
04EA   1D03           01862                 btfss STATUS,Z
04EB   2CF6           01863                         goto Not_Joy0
04EC   1CF9           01864                 btfss MyStatus2,JOY_KEYS; envoi touches fleches
04ED   2CF2           01865                         goto Not_ButAct0
                      01866                 ;-------------------------------------------------------------
                      01867                 ; TRANSMETTRE button action joystick 0
04EE   3074           01868                 movlw 0x74; bouton joytick 0 enfonce
04EF   1E26           01869                 btfss JOY0,4
04F0   30F4           01870                         movlw 0xF4; bouton joytick 0 relache
04F1   2E7D           01871                 goto SerialTransmit_Host
04F2                  01872 Not_ButAct0
                      01873                 ;-------------------------------------------------------------
                      01874                 ; TRANSMETTRE le paquet standard Atari (2 octets) du joystick 0
04F2   0840           01875                 movf HEADER_IKBD,W
04F3   267D           01876                 call SerialTransmit_Host
04F4   0826           01877                 movf JOY0,W; lecture joystick 0
04F5   2CFF           01878                 goto SerialTransmit_Host_Joy
04F6                  01879 Not_Joy0
04F6   1CF9           01880                 btfss MyStatus2,JOY_KEYS; envoi touches fleches
04F7   2CFC           01881                         goto Not_ButAct1
                      01882                 ;-------------------------------------------------------------
                      01883                 ; TRANSMETTRE button action joystick 1
04F8   3075           01884                 movlw 0x75; bouton joytick 1 enfonce
04F9   1E27           01885                 btfss JOY1,4
04FA   30F5           01886                         movlw 0xF5; bouton joytick 1 relache
04FB   2E7D           01887                 goto SerialTransmit_Host
04FC                  01888 Not_ButAct1
                      01889                 ;-------------------------------------------------------------
                      01890                 ; TRANSMETTRE le paquet standard Atari (2 octets) du joystick 1
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 53


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

04FC   0840           01891                 movf HEADER_IKBD,W
04FD   267D           01892                 call SerialTransmit_Host
04FE   0827           01893                 movf JOY1,W; lecture joystick 1 
04FF                  01894 SerialTransmit_Host_Joy
                      01895                 ; deplacement du bit fire du joystick (4 -> 7)
04FF   00F4           01896                 movwf TEMP1
0500   1A74           01897                 btfsc TEMP1,4
0501   17F4           01898                         bsf TEMP1,7; bouton fire
0502   1274           01899                 bcf TEMP1,4
0503   0874           01900                 movf TEMP1,W
0504   2E7D           01901                 goto SerialTransmit_Host
                      01902                 
                      01903 ;-----------------------------------------------------------------------------
                      01904 ;       Procedure de transmission des octets a propos de l'emulation
                      01905 ;       des fleches du clavier via le joystick 0 soit le mode IKBD
                      01906 ;       joystick keycodes
                      01907 ;       - Temps initial RX/RY declenche lors de l'appui sur une direction le
                      01908 ;         scancode de la fleche clavier est alors envoye une 1ere fois suivant
                      01909 ;         la direction choisie sur le joystick 0.
                      01910 ;       - Temps repetition TX/TY (X fois suivant VX/VY)
                      01911 ;       - Temps total VX/VY provoquant l'arret de l'envoi du scancode de la 
                      01912 ;         fleche du clavier (idem si relachement de la direction choisie du
                      01913 ;         joystick 0).
                      01914 ;-----------------------------------------------------------------------------
                      01915 
0505                  01916 SendAtariJoysticks_Fleches
0505   1856           01917                 btfsc Status_Joy,RY_H
0506   2D16           01918                         goto Not_H
0507   0826           01919                 movf JOYB,W; joystick 0
0508   0657           01920                 xorwf OLD_JOY,W
0509   3901           01921                 andlw 1         
050A   1903           01922                 btfsc STATUS,Z
050B   2D16           01923                         goto Not_H; pas de changement d'etat
050C   1C26           01924                 btfss JOYB,0
050D   2D16           01925                         goto Not_H
050E   1456           01926                 bsf Status_Joy,RY_H; bouton haut enfonce
050F   1256           01927                 bcf Status_Joy,TY_H
0510   084F           01928                 movf Counter_100MS_Joy,W
0511   00D9           01929                 movwf START_RY_JOY
0512   0851           01930                 movf RY_JOY,W
0513   1903           01931                 btfsc STATUS,Z
0514   2D16           01932                         goto Not_H; temps RY nul
0515   2681           01933                 call SerialTransmit_Haut; 1er envoi
0516                  01934 Not_H
0516   18D6           01935                 btfsc Status_Joy,RY_B
0517   2D27           01936                         goto Not_B
0518   0826           01937                 movf JOYB,W
0519   0657           01938                 xorwf OLD_JOY,W
051A   3902           01939                 andlw 2         
051B   1903           01940                 btfsc STATUS,Z
051C   2D27           01941                         goto Not_B; pas de changement d'etat
051D   1CA6           01942                 btfss JOYB,1
051E   2D27           01943                         goto Not_B
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 54


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

051F   14D6           01944                 bsf Status_Joy,RY_B; bouton bas enfonce
0520   12D6           01945                 bcf Status_Joy,TY_B
0521   084F           01946                 movf Counter_100MS_Joy,W
0522   00D9           01947                 movwf START_RY_JOY
0523   0851           01948                 movf RY_JOY,W
0524   1903           01949                 btfsc STATUS,Z
0525   2D27           01950                         goto Not_B; temps RY nul
0526   2683           01951                 call SerialTransmit_Bas; 1er envoi
0527                  01952 Not_B
0527   1956           01953                 btfsc Status_Joy,RX_G
0528   2D38           01954                         goto Not_G
0529   0826           01955                 movf JOYB,W
052A   0657           01956                 xorwf OLD_JOY,W
052B   3904           01957                 andlw 4         
052C   1903           01958                 btfsc STATUS,Z
052D   2D38           01959                         goto Not_G; pas de changement d'etat
052E   1D26           01960                 btfss JOYB,2
052F   2D38           01961                         goto Not_G
0530   1556           01962                 bsf Status_Joy,RX_G; bouton gauche enfonce
0531   1356           01963                 bcf Status_Joy,TX_G
0532   084F           01964                 movf Counter_100MS_Joy,W
0533   00D8           01965                 movwf START_RX_JOY
0534   0850           01966                 movf RX_JOY,W
0535   1903           01967                 btfsc STATUS,Z
0536   2D38           01968                         goto Not_G; temps RX nul
0537   2685           01969                 call SerialTransmit_Gauche; 1er envoi
0538                  01970 Not_G
0538   19D6           01971                 btfsc Status_Joy,RX_D
0539   2D49           01972                         goto Not_D
053A   0826           01973                 movf JOYB,W
053B   0657           01974                 xorwf OLD_JOY,W
053C   3908           01975                 andlw 8         
053D   1903           01976                 btfsc STATUS,Z
053E   2D49           01977                         goto Not_D; pas de changement d'etat
053F   1DA6           01978                 btfss JOYB,3
0540   2D49           01979                         goto Not_D
0541   15D6           01980                 bsf Status_Joy,RX_D; bouton droit enfonce
0542   13D6           01981                 bcf Status_Joy,TX_D
0543   084F           01982                 movf Counter_100MS_Joy,W
0544   00D8           01983                 movwf START_RX_JOY
0545   0850           01984                 movf RX_JOY,W
0546   1903           01985                 btfsc STATUS,Z
0547   2D49           01986                         goto Not_D; temps RX nul
0548   2687           01987                 call SerialTransmit_Droite; 1er envoi
0549                  01988 Not_D
0549   1C56           01989                 btfss Status_Joy,RY_H
054A   2D67           01990                         goto Not_H2
054B   1C26           01991                 btfss JOYB,0
054C   2D52           01992                         goto End_H; bouton haut relache
054D   0859           01993                 movf START_RY_JOY,W
054E   024F           01994                 subwf Counter_100MS_Joy,W
054F   0255           01995                 subwf VY_JOY,W; VY - temps ecoule
0550   1803           01996                 btfsc STATUS,C
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 55


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0551   2D55           01997                         goto Not_H3
0552                  01998 End_H
0552   1056           01999                 bcf Status_Joy,RY_H; fin temps total
0553   1256           02000                 bcf Status_Joy,TY_H
0554   2D67           02001                 goto Not_H2
0555                  02002 Not_H3
0555   1A56           02003                 btfsc Status_Joy,TY_H
0556   2D5D           02004                         goto Not_H4; temps repetition
0557   0859           02005                 movf START_RY_JOY,W
0558   024F           02006                 subwf Counter_100MS_Joy,W
0559   0251           02007                 subwf RY_JOY,W; RY - temps ecoule
055A   1803           02008                 btfsc STATUS,C
055B   2D67           02009                         goto Not_H2; <> fin 1er temps
055C   2D62           02010                 goto Delay_TY_H
055D                  02011 Not_H4
055D   085B           02012                 movf START_TY_JOY,W
055E   024F           02013                 subwf Counter_100MS_Joy,W
055F   0253           02014                 subwf TY_JOY,W; TY - temps ecoule
0560   1803           02015                 btfsc STATUS,C
0561   2D67           02016                         goto Not_H2
0562                  02017 Delay_TY_H
0562   1456           02018                 bsf Status_Joy,RY_H
0563   1656           02019                 bsf Status_Joy,TY_H
0564   084F           02020                 movf Counter_100MS_Joy,W
0565   00DB           02021                 movwf START_TY_JOY
0566   2681           02022                 call SerialTransmit_Haut; repetition            
0567                  02023 Not_H2
0567   1CD6           02024                 btfss Status_Joy,RY_B
0568   2D85           02025                         goto Not_B2
0569   1CA6           02026                 btfss JOYB,1
056A   2D70           02027                         goto End_B; bouton bas relache
056B   0859           02028                 movf START_RY_JOY,W
056C   024F           02029                 subwf Counter_100MS_Joy,W
056D   0255           02030                 subwf VY_JOY,W; VY - temps ecoule
056E   1803           02031                 btfsc STATUS,C
056F   2D73           02032                         goto Not_B3
0570                  02033 End_B
0570   10D6           02034                 bcf Status_Joy,RY_B; fin temps total
0571   12D6           02035                 bcf Status_Joy,TY_B
0572   2D85           02036                 goto Not_B2
0573                  02037 Not_B3
0573   1AD6           02038                 btfsc Status_Joy,TY_B
0574   2D7B           02039                         goto Not_B4; temps repetition
0575   0859           02040                 movf START_RY_JOY,W
0576   024F           02041                 subwf Counter_100MS_Joy,W
0577   0251           02042                 subwf RY_JOY,W; RY - temps ecoule
0578   1803           02043                 btfsc STATUS,C
0579   2D85           02044                         goto Not_B2; <> fin 1er temps
057A   2D80           02045                 goto Delay_TY_B
057B                  02046 Not_B4
057B   085B           02047                 movf START_TY_JOY,W
057C   024F           02048                 subwf Counter_100MS_Joy,W
057D   0253           02049                 subwf TY_JOY,W; TY - temps ecoule
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 56


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

057E   1803           02050                 btfsc STATUS,C
057F   2D85           02051                         goto Not_B2
0580                  02052 Delay_TY_B
0580   14D6           02053                 bsf Status_Joy,RY_B
0581   16D6           02054                 bsf Status_Joy,TY_B
0582   084F           02055                 movf Counter_100MS_Joy,W
0583   00DB           02056                 movwf START_TY_JOY
0584   2683           02057                 call SerialTransmit_Bas; repetition
0585                  02058 Not_B2
0585   1D56           02059                 btfss Status_Joy,RX_G
0586   2DA3           02060                         goto Not_G2
0587   1D26           02061                 btfss JOYB,2
0588   2D8E           02062                         goto End_G; bouton gauche relache
0589   0858           02063                 movf START_RX_JOY,W
058A   024F           02064                 subwf Counter_100MS_Joy,W
058B   0254           02065                 subwf VX_JOY,W; VX - temps ecoule
058C   1803           02066                 btfsc STATUS,C
058D   2D91           02067                         goto Not_G3
058E                  02068 End_G
058E   1156           02069                 bcf Status_Joy,RX_G; fin temps total
058F   1356           02070                 bcf Status_Joy,TX_G
0590   2DA3           02071                 goto Not_G2
0591                  02072 Not_G3
0591   1B56           02073                 btfsc Status_Joy,TX_G
0592   2D99           02074                         goto Not_G4; temps repetition
0593   0858           02075                 movf START_RX_JOY,W
0594   024F           02076                 subwf Counter_100MS_Joy,W
0595   0250           02077                 subwf RX_JOY,W; RX - temps ecoule
0596   1803           02078                 btfsc STATUS,C
0597   2DA3           02079                         goto Not_G2; <> fin 1er temps
0598   2D9E           02080                 goto Delay_TX_G
0599                  02081 Not_G4
0599   085A           02082                 movf START_TX_JOY,W
059A   024F           02083                 subwf Counter_100MS_Joy,W
059B   0252           02084                 subwf TX_JOY,W; TX - temps ecoule
059C   1803           02085                 btfsc STATUS,C
059D   2DA3           02086                         goto Not_G2
059E                  02087 Delay_TX_G
059E   1556           02088                 bsf Status_Joy,RX_G
059F   1756           02089                 bsf Status_Joy,TX_G
05A0   084F           02090                 movf Counter_100MS_Joy,W
05A1   00DA           02091                 movwf START_TX_JOY
05A2   2685           02092                 call SerialTransmit_Gauche; repetition  
05A3                  02093 Not_G2
05A3   1DD6           02094                 btfss Status_Joy,RX_D
05A4   2DC1           02095                         goto Not_D2
05A5   1DA6           02096                 btfss JOYB,3
05A6   2DAC           02097                         goto End_D; bouton droit relache
05A7   0858           02098                 movf START_RX_JOY,W
05A8   024F           02099                 subwf Counter_100MS_Joy,W
05A9   0254           02100                 subwf VX_JOY,W; VX - temps ecoule
05AA   1803           02101                 btfsc STATUS,C
05AB   2DAF           02102                         goto Not_D3
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 57


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

05AC                  02103 End_D
05AC   11D6           02104                 bcf Status_Joy,RX_D; fin temps total
05AD   13D6           02105                 bcf Status_Joy,TX_D
05AE   2DC1           02106                 goto Not_D2
05AF                  02107 Not_D3
05AF   1BD6           02108                 btfsc Status_Joy,TX_D
05B0   2DB7           02109                         goto Not_D4; temps repetition
05B1   0858           02110                 movf START_RX_JOY,W
05B2   024F           02111                 subwf Counter_100MS_Joy,W
05B3   0250           02112                 subwf RX_JOY,W; RX - temps ecoule
05B4   1803           02113                 btfsc STATUS,C
05B5   2DC1           02114                         goto Not_D2; <> fin 1er temps
05B6   2DBC           02115                 goto Delay_TX_D
05B7                  02116 Not_D4
05B7   085A           02117                 movf START_TX_JOY,W
05B8   024F           02118                 subwf Counter_100MS_Joy,W
05B9   0252           02119                 subwf TX_JOY,W; TX - temps ecoule
05BA   1803           02120                 btfsc STATUS,C
05BB   2DC1           02121                         goto Not_D2
05BC                  02122 Delay_TX_D
05BC   15D6           02123                 bsf Status_Joy,RX_D
05BD   17D6           02124                 bsf Status_Joy,TX_D
05BE   084F           02125                 movf Counter_100MS_Joy,W
05BF   00DA           02126                 movwf START_TX_JOY
05C0   2687           02127                 call SerialTransmit_Droite; repetition  
05C1                  02128 Not_D2
05C1   0826           02129                 movf JOYB,W
05C2   00D7           02130                 movwf OLD_JOY   
05C3   0008           02131                 return
                      02132 
                      02133 ;-----------------------------------------------------------------------------
                      02134 ;       Procedure de transmission des octets a propos de la souris. On envoit
                      02135 ;       le paquet souris standard Atari, sur 3 octets puis si les octets sont non
                      02136 ;       nul, on envoit deux supplementaires qui contiennent des Scan-codes pour
                      02137 ;       les molettes et boutons 4 & 5.
                      02138 ;
                      02139 ;       Entrees:        HEADER, X_MOV, Y_MOV en mode IKBD souris relative
                      02140 ;                       HEADER, BUTTONS, X_POSH, X_POSL, Y_POSH, Y_POSL en absolu
                      02141 ;       Sorties:        w detruit
                      02142 ;-----------------------------------------------------------------------------
                      02143 
05C4                  02144 SendAtariMouse
05C4   0840           02145                 movf HEADER_IKBD,W
05C5   3CF7           02146                 sublw HEADER_ABSOLUTE_MOUSE; header souris mode absolu
05C6   1903           02147                 btfsc STATUS,Z
05C7   2E23           02148                         goto SendAtariMouse_Abs; envoi mode absolu
05C8   19F8           02149                 btfsc MyStatus,MOUSE_ABS
05C9   2DD2           02150                         goto Not_trame_Rel; souris en mode absolu
05CA   1879           02151                 btfsc MyStatus2,MOUSE_KEYS; envoi touches fleches
05CB   2DD2           02152                         goto Not_trame_Rel
                      02153                 ;-------------------------------------------------------------
                      02154                 ; TRANSMETTRE le paquet standard souris Atari (3 octets) mode relatif
05CC   0840           02155                 movf HEADER_IKBD,W
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 58


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

05CD   267D           02156                 call SerialTransmit_Host; envoyer l'octet commande vers le Host
05CE   086A           02157                 movf X_MOV,W; deplacement relatif souris en X
05CF   267D           02158                 call SerialTransmit_Host; envoyer l'octet compteur X vers le Host
05D0   086B           02159                 movf Y_MOV,W; deplacement relatif souris en Y
05D1   267D           02160                 call SerialTransmit_Host; envoyer l'octet compteur Y vers le Host
                      02161                 ;-------------------------------------------------------------
05D2                  02162 Not_trame_Rel                      
                      02163                 ;-------------------------------------------------------------
                      02164                 ; Test mode IKBD mouse keycodes
05D2   1C79           02165                 btfss MyStatus2,MOUSE_KEYS; envoi touches fleches
05D3   2DFE           02166                         goto Not_Keys_Mouse
05D4   086A           02167                 movf X_MOV,W; deplacement relatif souris en X
05D5   07EC           02168                 addwf X_INC_KEY,F; increment en X mode keycode souris
05D6   1BEC           02169                 btfsc X_INC_KEY,7
05D7   2DDF           02170                         goto Loop_Moins_H
05D8                  02171 Loop_Plus_H
05D8   086E           02172                         movf DELTA_X,W; deltax mode keycode souris IKBD
05D9   026C           02173                         subwf X_INC_KEY,W
05DA   1803           02174                         btfsc STATUS,C
05DB   2DE6           02175                                 goto Not_Key_Mouse_H
05DC   00EC           02176                         movwf X_INC_KEY
05DD   2687           02177                         call SerialTransmit_Droite
05DE   2DD8           02178                 goto Loop_Plus_H        
05DF                  02179 Loop_Moins_H
05DF   086E           02180                         movf DELTA_X,W; deltax mode keycode souris IKBD
05E0   076C           02181                         addwf X_INC_KEY,W
05E1   1803           02182                         btfsc STATUS,C
05E2   2DE6           02183                                 goto Not_Key_Mouse_H
05E3   00EC           02184                         movwf X_INC_KEY
05E4   2685           02185                         call SerialTransmit_Gauche
05E5   2DDF           02186                 goto Loop_Moins_H       
05E6                  02187 Not_Key_Mouse_H
05E6   086B           02188                 movf Y_MOV,W; deplacement relatif souris en Y
05E7   07ED           02189                 addwf Y_INC_KEY,F; increment en Y mode keycode souris
05E8   1BED           02190                 btfsc Y_INC_KEY,7
05E9   2DF4           02191                         goto Loop_Moins_V
05EA                  02192 Loop_Plus_V
05EA   086F           02193                         movf DELTA_Y,W; deltay mode keycode souris IKBD
05EB   026D           02194                         subwf Y_INC_KEY,W
05EC   1803           02195                         btfsc STATUS,C
05ED   2DFE           02196                                 goto Not_Keys_Mouse
05EE   00ED           02197                         movwf Y_INC_KEY
05EF   1E78           02198                         btfss MyStatus,SIGN_Y   
05F0   2683           02199                                 call SerialTransmit_Bas
05F1   1A78           02200                         btfsc MyStatus,SIGN_Y   
05F2   2681           02201                                 call SerialTransmit_Haut
05F3   2DEA           02202                 goto Loop_Plus_V        
05F4                  02203 Loop_Moins_V
05F4   086F           02204                         movf DELTA_Y,W; deltay mode keycode souris IKBD
05F5   076D           02205                         addwf Y_INC_KEY,W
05F6   1803           02206                         btfsc STATUS,C
05F7   2DFE           02207                                 goto Not_Keys_Mouse
05F8   00ED           02208                         movwf Y_INC_KEY
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 59


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

05F9   1E78           02209                         btfss MyStatus,SIGN_Y   
05FA   2681           02210                                 call SerialTransmit_Haut
05FB   1A78           02211                         btfsc MyStatus,SIGN_Y   
05FC   2683           02212                                 call SerialTransmit_Bas
05FD   2DF4           02213                 goto Loop_Moins_V
05FE                  02214 Not_Keys_Mouse
                      02215                 ;-------------------------------------------------------------
                      02216                 ; Test mode IKBD button action
05FE   1D7D           02217                 btfss BUTTON_ACTION,2; envoi touches boutons
05FF   2E12           02218                         goto Not_Clic_Mouse
0600   0823           02219                 movf BUTTONS,W; etat des boutons souris
0601   0624           02220                 xorwf OLD_BUTTONS,W; ancien etat des boutons souris
0602   3901           02221                 andlw 1         
0603   1903           02222                 btfsc STATUS,Z
0604   2E09           02223                         goto Not_Change_C
0605   3075           02224                 movlw 0x75; bouton droit enfonce
0606   1C23           02225                 btfss BUTTONS,0
0607   30F5           02226                         movlw 0xF5; bouton droit relache
0608   267D           02227                 call SerialTransmit_Host
0609                  02228 Not_Change_C
0609   0823           02229                 movf BUTTONS,W; etat des boutons souris
060A   0624           02230                 xorwf OLD_BUTTONS,W; ancien etat des boutons souris
060B   3902           02231                 andlw 2         
060C   1903           02232                 btfsc STATUS,Z
060D   2E12           02233                         goto Not_Clic_Mouse
060E   3074           02234                 movlw 0x74; bouton gauche enfonce
060F   1CA3           02235                 btfss BUTTONS,1
0610   30F4           02236                         movlw 0xF4; bouton gauche relache
0611   267D           02237                 call SerialTransmit_Host
0612                  02238 Not_Clic_Mouse
                      02239                 ;-------------------------------------------------------------
                      02240                 ; TRANSMETTRE le Scan code pour le bouton central (si celui-ci est non nul)
0612   0843           02241                 movf CLIC_MOUSE_WHEEL,W; Tester le scan-code eventuel a transmettre
0613   1903           02242                 btfsc STATUS,Z
0614   2E16           02243                         goto Roulettes
                      02244                 ; TRANSMISSION EFFECTIVE: Envoit du scan-code pour le bouton central
0615   2688           02245                 call SerialTransmit_KeyUpDown; envoyer l'octet Molette
0616                  02246 Roulettes
                      02247                 ;-------------------------------------------------------------
                      02248                 ; TRANSMETTRE le Scan code des Molettes (si celui-ci est non nul)
0616   3097           02249                 movlw Tab_Mouse-EEProm+IDX_WHREPEAT
0617   2758           02250                 call Lecture_EEProm; nbre repetitions touche Mouse Wheel
0618   00F2           02251                 movwf Counter
0619                  02252 Repeat
0619   0841           02253                         movf KEY_MOUSE_WHEEL,W ; Tester le scan-code eventuel a transmettre
061A   1903           02254                         btfsc STATUS,Z
061B   2E1F           02255                                 goto Buttons45
                      02256                         ; TRANSMISSION EFFECTIVE: Envoit du scan-code pour la molette
061C   2688           02257                         call SerialTransmit_KeyUpDown; envoyer l'octet Molette
061D   0BF2           02258                         decfsz Counter,F; repeter l'emision
061E   2E19           02259                 goto Repeat
061F                  02260 Buttons45
                      02261                 ;-------------------------------------------------------------
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 60


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      02262                 ; TRANSMETTRE le Scan code des boutons 4&5 (si celui-ci est non nul)
061F   0842           02263                 movf KEY2_MOUSE_WHEEL,W; ;Tester le scan-code eventuel a transmettre
0620   1903           02264                 btfsc STATUS,Z
0621   0008           02265                         return
0622   2E88           02266                 goto SerialTransmit_KeyUpDown; envoyer l'octet bouton 4&5
                      02267                 ;-------------------------------------------------------------
0623                  02268 SendAtariMouse_Abs
                      02269                 ;-------------------------------------------------------------
                      02270                 ; TRANSMETTRE le paquet souris Atari (5 octets) en mode absolu
0623   0840           02271                 movf HEADER_IKBD,W
0624   267D           02272                 call SerialTransmit_Host
0625   01F4           02273                 clrf TEMP1
0626   0823           02274                 movf BUTTONS,W; etat des boutons souris
                      02275                 ; test changement d'etat du bouton droit
0627   0625           02276                 xorwf OLD_BUTTONS_ABS,W; ancien etat des boutons souris en mode absolu
0628   3901           02277                 andlw 1         
0629   1903           02278                 btfsc STATUS,Z
062A   2E2F           02279                         goto Not_Change_0
062B   1823           02280                 btfsc BUTTONS,0
062C   1474           02281                         bsf TEMP1,0; bouton droit enfonce
062D   1C23           02282                 btfss BUTTONS,0
062E   14F4           02283                         bsf TEMP1,1; bouton droit relache
062F                  02284 Not_Change_0
                      02285                 ; test changement d'etat du bouton gauche
062F   0823           02286                 movf BUTTONS,W; etat des boutons souris
0630   0625           02287                 xorwf OLD_BUTTONS_ABS,W; ancien etat des boutons souris en mode absolu
0631   3902           02288                 andlw 2         
0632   1903           02289                 btfsc STATUS,Z
0633   2E38           02290                         goto Not_Change_1
0634   18A3           02291                 btfsc BUTTONS,1
0635   1574           02292                         bsf TEMP1,2; bouton gauche enfonce
0636   1CA3           02293                 btfss BUTTONS,1
0637   15F4           02294                         bsf TEMP1,3; bouton gauche relache
0638                  02295 Not_Change_1
                      02296                 ; envoi de la trame mode IKBD souris absolue
0638   0823           02297                 movf BUTTONS,W; etat des boutons souris
0639   00A5           02298                 movwf OLD_BUTTONS_ABS; ancien etat des boutons souris en mode absolu
063A   0874           02299                 movf TEMP1,W
063B   267D           02300                 call SerialTransmit_Host; changements boutons: B3/2: gauche relache/enfonce, B1/0: droit
                             relache/enfonce
063C   0862           02301                 movf X_POSH_SCALED,W; position X absolue souris avec facteur d'echelle poids fort
063D   267D           02302                 call SerialTransmit_Host; XMSB
063E   0863           02303                 movf X_POSL_SCALED,W; position X absolue souris avec facteur d'echelle poids faible
063F   267D           02304                 call SerialTransmit_Host; XLSB
0640   0864           02305                 movf Y_POSH_SCALED,W; position Y absolue souris avec facteur d'echelle poids fort
0641   267D           02306                 call SerialTransmit_Host; YMSB
0642   0865           02307                 movf Y_POSL_SCALED,W; position Y absolue souris avec facteur d'echelle poids faible
0643   2E7D           02308                 goto SerialTransmit_Host; YLSB
                      02309         
                      02310 ;-----------------------------------------------------------------------------
                      02311 ;       Detection d'une souris InteliMouse simple. On tente la detection et on
                      02312 ;       positionne le bit MSWHEEL a UN si a roulette.
                      02313 ;
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 61


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      02314 ;       Methode:        Emettre Set Sample Rate 200
                      02315 ;                               Emettre Set Sample Rate 100
                      02316 ;                               Emettre Set Sample Rate 80
                      02317 ;
                      02318 ;                               Emettre Get Device ID
                      02319 ;                               Si retourne     0x03 => Souris etendue a roulette
                      02320 ;                               Sinon retourne  0x00 => Souris PS/2 standard
                      02321 ;-----------------------------------------------------------------------------
                      02322 
0644                  02323 TryWheel
                      02324                 ; Envoyer le sequence de parametrage pour detecter le type
0644   30C8           02325                 movlw 200
0645   26B1           02326                 call cmdSetSmpRate
0646   3064           02327                 movlw 100
0647   26B1           02328                 call cmdSetSmpRate
0648   3050           02329                 movlw 80
0649   26B1           02330                 call cmdSetSmpRate; entre dans le mode Scrolling Wheel
                      02331                 ; Envoyer la commande pour identification
064A   30F2           02332                 movlw GET_DEVICE_ID
064B   2705           02333                 call MPSCmd
                      02334                 ; Attendre maintenant la reponse d'IDENTIFICATION de la souris
064C   2706           02335                 call MPSGet; Wait and get next byte
                      02336                 ; Analyser l'octet de retour: 0x00 = PS/2 standard/ 0x03 InteliMouse 3 boutons
064D   10F8           02337                 bcf MyStatus,MSWHEEL
064E   0873           02338                 movf Value,W
064F   3C03           02339                 sublw MS_WHEEL; soustraire le code InteliMouse 3 boutons
0650   1903           02340                 btfsc STATUS,Z
0651   14F8           02341                         bsf MyStatus,MSWHEEL; MS scrolling mouse
                      02342                 ; JUST for test: si affichage BCD afficher le code ID de la souris
                      02343                 IF DEBUG_CODE
                      02344                 movf Value,W
                      02345                 btfss PORTB,JUMPER5; si mode debug
                      02346                         call SerialTransmit_Host
                      02347                 ENDIF
0652   3064           02348                 movlw 100; remettre le taux d'echantillonnage initial
0653   2EB1           02349                 goto cmdSetSmpRate; quitte le mode
                      02350 
                      02351 ;-----------------------------------------------------------------------------
                      02352 ;       Detection d'une souris InteliMouse etendue, c'est a dire 5 boutons et
                      02353 ;       eventuellement avec deuxieme roulette. On tente la detection et on positionne
                      02354 ;   le bit MSWHEELPLUS a UN si a roulette.
                      02355 ;
                      02356 ;       Methode:        Emettre Set Sample Rate 200
                      02357 ;                               Emettre Set Sample Rate 200
                      02358 ;                               Emettre Set Sample Rate 80
                      02359 ;
                      02360 ;                               Emettre Get Device ID
                      02361 ;                               Si retourne     0x04 => Souris etendue a roulette
                      02362 ;                               Sinon retourne  0x00 => Souris PS/2 standard
                      02363 ;-----------------------------------------------------------------------------
                      02364 
0654                  02365 TryWheelPlus
                      02366                 ; Envoyer le sequence de parametrage pour detecter le type
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 62


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0654   30C8           02367                 movlw 200
0655   26B1           02368                 call cmdSetSmpRate
0656   30C8           02369                 movlw 200
0657   26B1           02370                 call cmdSetSmpRate
0658   3050           02371                 movlw 80
0659   26B1           02372                 call cmdSetSmpRate; entre dans le mode Scrolling Wheel + 5 boutons
                      02373                 ; Envoyer la commande pour identification
065A   30F2           02374                 movlw GET_DEVICE_ID
065B   2705           02375                 call MPSCmd
                      02376                 ; Attendre maintenant la reponse d'IDENTIFICATION de la souris
065C   2706           02377                 call MPSGet; Wait and get next byte
                      02378                 ; Analyser l'octet de retour: 0x00 = PS/2 standard/ 0x04 Etendue a roulette
065D   1178           02379                 bcf MyStatus,MSWHEELPLUS
065E   0873           02380                 movf Value,W
065F   3C04           02381                 sublw MS_WHEELPLUS; soustraire le code InteliMouse 5 boutons
0660   1903           02382                 btfsc STATUS,Z
0661   1578           02383                         bsf MyStatus,MSWHEELPLUS; MS Intellimouse
                      02384                 ; JUST for test: si affichage BCD afficher le code ID de la souris
                      02385                 IF DEBUG_CODE
                      02386                 movf Value,W
                      02387                 btfss PORTB,JUMPER5; si mode debug
                      02388                         call SerialTransmit_Host
                      02389                 ENDIF
0662   3064           02390                 movlw 100; remettre le taux d'echantillonnage initial
0663   2EB1           02391                 goto cmdSetSmpRate; quitte le mode
                      02392 
                      02393 ;-----------------------------------------------------------------------------
                      02394 ;   Traduction des touches AT vers ATARI. Cette procedure traite les
                      02395 ;       Scan-codes type 3 du clavier PS/2.
                      02396 ;
                      02397 ;       Make code:      <Octet touche>
                      02398 ;       Break code:     <$F0><Octet touche>
                      02399 ;
                      02400 ;   Entree: Value = Octet keyboard recu, et flag BREAK_CODE a 1 pour BreakCode.
                      02401 ;   Sortie: W = detruit
                      02402 ;
                      02403 ;   Global: Value qui contient l'octet.
                      02404 ;-----------------------------------------------------------------------------
                      02405 
0664                  02406 SendAtariKeyboard
                      02407                 ; controller pour ne pas depasser la taille de la table
                      02408                 ; La bit Carry pour un sublw positionne a ZERO le bit
                      02409                 ; si le soustraction donne un reste donc un depassement
0664   0873           02410                 movf Value,W                    
0665   3C8F           02411                 sublw MAX_VALUE_LOOKUP; soustraire l'offset MAX
0666   1C03           02412                 btfss STATUS,C; si carry =1 pas de problemes on passe
0667   0008           02413                         return; ignore code > MAX_VALUE_LOOKUP
0668   0873           02414                 movf Value,W; recharge w avec la valeur
0669   2758           02415                 call Lecture_EEProm
066A   00F3           02416                 movwf Value; sauvegarder le resultat dans Value
066B   3800           02417                 iorlw 0; tester si translation a donne 0
066C   1903           02418                 btfsc STATUS,Z; Z=1 si w contient 0
066D   0008           02419                         return; pas d'affectation
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 63


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

066E   3880           02420                 iorlw 0x80; relachement (BreakCode Bit7=1)
066F   1A79           02421                 btfsc MyStatus2,BREAK_CODE
0670   2E7D           02422                         goto SerialTransmit_Host; break code
0671   397F           02423                 andlw 0x7F; touche enfoncee
0672   267D           02424                 call SerialTransmit_Host
                      02425                 ; Detecter si CAPS LOCK appuye pour allumer/eteindre la LED
0673   0873           02426                 movf Value,W
0674   3C3A           02427                 sublw KEY_CAPSLOCK; Caps Lock
0675   1903           02428                 btfsc STATUS,Z
0676   268D           02429                         call CapsLock
0677   0008           02430                 return
                      02431 
                      02432 ;-----------------------------------------------------------------------------
                      02433 ;   Wait for byte to be received in USART and return with byte in Value
                      02434 ;-----------------------------------------------------------------------------
                      02435 
0678                  02436 SerialReceive
0678   1E8C           02437                 btfss PIR1,RCIF ; check if data received
0679   2E78           02438                         goto SerialReceive; wait until new data
067A   081A           02439                 movf RCREG,W; get received data into W
067B   00F3           02440                 movwf Value; put w into Value (result)
067C   0008           02441                 return
                      02442 
                      02443 ;-----------------------------------------------------------------------------
                      02444 ;   Transmit byte in W register from USART
                      02445 ;
                      02446 ; Entree: W = donnee binaire
                      02447 ; Sortie: Rien
                      02448 ;
                      02449 ; Global: TEMP2, TEMP3, TEMP4, TEMP5,
                      02450 ;         DEB_INDEX_EM, FIN_INDEX_EM, TAMPON_EM utilises
                      02451 ;-----------------------------------------------------------------------------
                      02452                 
067D                  02453 SerialTransmit_Host
                      02454                 IF DEBUG_CODE
                      02455                 btfsc PORTB,JUMPER5
                      02456                         goto Mode_Binaire; if jumper5 disable (5V) normal
                      02457                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)       
                      02458                 call SendBCD; if mode debug
                      02459                 bcf PCLATH,3; page 0 ou 2
                      02460                 return
                      02461 Mode_Binaire
                      02462                 ENDIF
067D   158A           02463                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)               
Message[306]: Crossing page boundary -- ensure page bits are set.
067E   2100           02464                 call SerialTransmit; envoyer l'octet commande vers le Host
067F   118A           02465                 bcf PCLATH,3; page 0 ou 2
0680   0008           02466                 return
                      02467 
                      02468 ;-----------------------------------------------------------------------------
                      02469 ;   Envoi des fleches
                      02470 ;-----------------------------------------------------------------------------
                      02471 
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 64


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0681                  02472 SerialTransmit_Haut
0681   3048           02473                 movlw 0x48; bouton fleche haut
0682   2E88           02474                 goto SerialTransmit_KeyUpDown
                      02475                 
0683                  02476 SerialTransmit_Bas
0683   3050           02477                 movlw 0x50; bouton fleche bas
0684   2E88           02478                 goto SerialTransmit_KeyUpDown
                      02479                 
0685                  02480 SerialTransmit_Gauche
0685   304B           02481                 movlw 0x4B; bouton fleche gauche
0686   2E88           02482                 goto SerialTransmit_KeyUpDown
                      02483                 
0687                  02484 SerialTransmit_Droite
0687   304D           02485                 movlw 0x4D; bouton fleche droite
                      02486 
                      02487 ;-----------------------------------------------------------------------------
                      02488 ;   Envoi du code d'une touche et son relachement juste apres
                      02489 ;
                      02490 ; Entree: W = donnee binaire
                      02491 ; Sortie: Rien
                      02492 ;
                      02493 ; Global: Value utilise
                      02494 ;-----------------------------------------------------------------------------
                      02495 
0688                  02496 SerialTransmit_KeyUpDown
0688   00F3           02497                 movwf Value
0689   267D           02498                 call SerialTransmit_Host; touche enfonce
068A   0873           02499                 movf Value,W
068B   3880           02500                 iorlw 0x80; relachement
068C   2E7D           02501                 goto SerialTransmit_Host
                      02502                 
068D                  02503 CapsLock
                      02504                 IF SCROOL_LOCK_ERR
                      02505                 bsf PARITY,7
                      02506                 ENDIF
068D   1C78           02507                 btfss MyStatus,CAPS_LOCK; tester le bit CapsLock est active
068E   2E91           02508                         goto CapsToOn; on execute le goto si bit=0
                      02509                 ; CapsLock etait deja enclenche: On desactive sa LED et annule son bit
068F   1078           02510                 bcf MyStatus,CAPS_LOCK
0690   2E92           02511                 goto UpdateLedOnOff
0691                  02512 CapsToOn
                      02513                 ; CapsLock n'etait pas enclenche: on active sa LED et on active son bit
0691   1478           02514                 bsf MyStatus,CAPS_LOCK
                      02515 
0692                  02516 UpdateLedOnOff
0692   3002           02517                 movlw CAPS_OFF
0693   1878           02518                 btfsc MyStatus,CAPS_LOCK
0694   3006           02519                         movlw CAPS_ON
                      02520                 IF SCROOL_LOCK_ERR
                      02521                 btfss PARITY,7
                      02522                         iorlw LED_SCROLL
                      02523                 ENDIF
0695   2E98           02524                 goto cmdLedOnOff
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 65


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      02525 
                      02526 ;-----------------------------------------------------------------------------
                      02527 ;   Activer le mode Make/Break des scan-codes.
                      02528 ;   Ce mode doit etre selectionne car le delais et la repetition des touches
                      02529 ;   sont geres par le XBIOS de l'Atari.
                      02530 ;
                      02531 ;   Entree: Rien
                      02532 ;   Sortie: W = detruit
                      02533 ;
                      02534 ;   Global: Aucune.
                      02535 ;-----------------------------------------------------------------------------
                      02536 
0696                  02537 cmdMakeBreak
0696   30F8           02538                 movlw SET_ALL_KEYS_MAKE_BREAK; envoyer la commande make/break
0697   2EB6           02539                 goto KPSCmd
                      02540 
                      02541 ;-----------------------------------------------------------------------------
                      02542 ;   Envoit la commande Set Typematic Rate au clavier, pour fixer la 
                      02543 ;   vitesse de repetition.
                      02544 ;
                      02545 ;   Entree: Rien
                      02546 ;   Sortie: W = detruit
                      02547 ;
                      02548 ;   Global: Aucune.
                      02549 ;-----------------------------------------------------------------------------
                      02550 
                      02551 ;cmdTypeRate
                      02552 ;               movlw SET_TYPEMATIC_RATE_DELAY
                      02553 ;               call KPSCmd
                      02554 ;               movlw CPS_30; 30 cps
                      02555 ;               goto KPSCmd
                      02556 
                      02557 ;-----------------------------------------------------------------------------
                      02558 ;   Allumer LEDs clavier AT
                      02559 ;
                      02560 ;   Entree: Var LED contient le champ de bits
                      02561 ;   Sortie: W = detruit
                      02562 ;
                      02563 ;   Global: Var LED
                      02564 ;-----------------------------------------------------------------------------
                      02565 
0698                  02566 cmdLedOnOff
0698   00F7           02567                 movwf TEMP2
0699   30ED           02568                 movlw SET_RESET_LEDS; envoyer la commande d'allumage
069A   26B6           02569                 call KPSCmd
069B   0877           02570                 movf TEMP2,W; Allumer LEDs choisies
069C   2EB6           02571                 goto KPSCmd
                      02572 
                      02573 ;-----------------------------------------------------------------------------
                      02574 ;   Passage en jeux de scancode 3 clavier
                      02575 ;
                      02576 ;   Entree: Rien
                      02577 ;   Sortie: W = detruit
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 66


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      02578 ;
                      02579 ;   Global: Aucune.
                      02580 ;-----------------------------------------------------------------------------
                      02581 
069D                  02582 cmdScanSet3
069D   30F0           02583                 movlw SET_SCAN_CODE_SET; envoyer la commande de selection JEU 3
069E   26B6           02584                 call KPSCmd
069F   3003           02585                 movlw SCANCODESET3
06A0   2EB6           02586                 goto KPSCmd
                      02587 
                      02588 ;-----------------------------------------------------------------------------
                      02589 ;   Envoit de la commande reset au CLAVIER
                      02590 ;
                      02591 ;   Entree: Rien
                      02592 ;   Sortie: W = detruit
                      02593 ;
                      02594 ;   Global: Aucune.
                      02595 ;-----------------------------------------------------------------------------
                      02596 
06A1                  02597 cmdResetKey
06A1   30FF           02598                 movlw RESET
06A2   2EB6           02599                 goto KPSCmd
                      02600 
                      02601 ;-----------------------------------------------------------------------------
                      02602 ;   Envoit de la commande resend au CLAVIER
                      02603 ;
                      02604 ;   Entree: Rien
                      02605 ;   Sortie: W = detruit
                      02606 ;
                      02607 ;   Global: Aucune.
                      02608 ;-----------------------------------------------------------------------------
                      02609 
06A3                  02610 cmdResendKey
06A3   30FE           02611                 movlw RESEND
06A4   2ED6           02612                 goto KPS2cmd; pas d'acknoledge
                      02613                 
                      02614 ;-----------------------------------------------------------------------------
                      02615 ;   Envoit de la commande enable au CLAVIER
                      02616 ;
                      02617 ;   Entree: Rien
                      02618 ;   Sortie: W = detruit
                      02619 ;
                      02620 ;   Global: Aucune.
                      02621 ;-----------------------------------------------------------------------------
                      02622 
06A5                  02623 cmdEnableKey
06A5   30F4           02624                 movlw ENABLE; envoyer la commande
06A6   2EB6           02625                 goto KPSCmd
                      02626 
                      02627 ;-----------------------------------------------------------------------------
                      02628 ;   Envoit de la commande disable au CLAVIER
                      02629 ;
                      02630 ;   Entree: Rien
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 67


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      02631 ;   Sortie: W = detruit
                      02632 ;
                      02633 ;   Global: Aucune.
                      02634 ;-----------------------------------------------------------------------------
                      02635 
06A7                  02636 cmdDisableKey
06A7   30F5           02637                 movlw DEFAULT_DISABLE
06A8   2EB6           02638                 goto KPSCmd
                      02639 
                      02640 ;-----------------------------------------------------------------------------
                      02641 ;   Envoit de la commande reset a la SOURIS
                      02642 ;
                      02643 ;   Entree: Rien
                      02644 ;   Sortie: W = detruit
                      02645 ;
                      02646 ;   Global: Aucune.
                      02647 ;-----------------------------------------------------------------------------
                      02648 
06A9                  02649 cmdResetMouse
06A9   30FF           02650                 movlw RESET
06AA   2F05           02651                 goto MPSCmd
                      02652 
                      02653 ;-----------------------------------------------------------------------------
                      02654 ;   Envoit de la commande resend a la SOURIS
                      02655 ;
                      02656 ;   Entree: Rien
                      02657 ;   Sortie: W = detruit
                      02658 ;
                      02659 ;   Global: Aucune.
                      02660 ;-----------------------------------------------------------------------------
                      02661 
06AB                  02662 cmdResendMouse
06AB   30FE           02663                 movlw RESEND
06AC   2F25           02664                 goto MPS2cmd; pas d'Acknowledge
                      02665 
                      02666 ;-----------------------------------------------------------------------------
                      02667 ;   Envoit de la commande enable a la SOURIS
                      02668 ;
                      02669 ;   Entree: Rien
                      02670 ;   Sortie: W = detruit
                      02671 ;
                      02672 ;   Global: Aucune.
                      02673 ;-----------------------------------------------------------------------------
                      02674 
06AD                  02675 cmdEnableMous
06AD   30F4           02676                 movlw ENABLE_DATA_REPORTING
06AE   2F05           02677                 goto MPSCmd
                      02678 
                      02679 ;-----------------------------------------------------------------------------
                      02680 ;   Envoit de la commande disable a la SOURIS
                      02681 ;
                      02682 ;   Entree: Rien
                      02683 ;   Sortie: W = detruit
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 68


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      02684 ;
                      02685 ;   Global: Aucune.
                      02686 ;-----------------------------------------------------------------------------
                      02687 
06AF                  02688 cmdDisableMouse
06AF   30F5           02689                 movlw DISABLE_DATA_REPORTING
06B0   2F05           02690                 goto MPSCmd
                      02691 
                      02692 ;-----------------------------------------------------------------------------
                      02693 ;   Emission de la commande set sample rate sur la souris.
                      02694 ;
                      02695 ;   Entree: Rien
                      02696 ;   Sortie: W = detruit
                      02697 ;
                      02698 ;   Global: Aucune.
                      02699 ;-----------------------------------------------------------------------------
                      02700 
06B1                  02701 cmdSetSmpRate
06B1   00F7           02702                 movwf TEMP2
06B2   30F3           02703                 movlw SET_SAMPLE_RATE
06B3   2705           02704                 call MPSCmd
06B4   0877           02705                 movf TEMP2,W
06B5   2F05           02706                 goto MPSCmd
                      02707                 
                      02708 ;-----------------------------------------------------------------------------
                      02709 ;   Emission d'une commande sur le clavier.
                      02710 ;
                      02711 ;   Entree: W
                      02712 ;   Sortie: W = detruit
                      02713 ;
                      02714 ;   Global: Aucune.
                      02715 ;-----------------------------------------------------------------------------
                      02716 
06B6                  02717 KPSCmd
06B6   26D6           02718                 call KPS2cmd; => atente Value Acknowledge
                      02719                 
                      02720 ;-----------------------------------------------------------------------------
                      02721 ;   KEYBOARD: Routine de lecture d'un octet du port DIN5 et MiniDIN6
                      02722 ;
                      02723 ;   Entree: Rien
                      02724 ;   Sortie: W = 1 si octet recu sinon 0
                      02725 ;           VAR Value = octet recu
                      02726 ;-----------------------------------------------------------------------------
                      02727 
06B7                  02728 KPSGet
                      02729                 ; Test l'horloge, si etat bas, le clavier communique
                      02730                 IF NON_BLOQUANT 
                      02731                 call Wait_Kclock
                      02732                 ELSE
                      02733                 WAIT_KCLOCK_L; attente front descendant de CLK
  0000                    M                 LOCAL WKCL1,WKCL2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 69


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M WKCL1
                          M                         btfss PORTB,KCLOCK; attente front descendant de CLK
                          M                                 goto WKCL2
                          M                         decfsz Counter2,F
                          M                 goto WKCL1
                          M WKCL2
                          M                 ELSE
06B7   1886               M                 btfsc PORTB,KCLOCK; attente front descendant de CLK
06B8   2EB7               M                         goto $ -1
                          M                 ENDIF
                      02734                 ENDIF   
06B9                  02735 KPSGet2
06B9   01F6           02736                 clrf PARITY; Used for parity calc
06BA   26CE           02737                 call KPSGetBit; get start bit (for nothing)
06BB   01F3           02738                 clrf Value; clear value
06BC   3008           02739                 movlw 8; 8 bits
06BD   00F2           02740                 movwf Counter; Set counter to 8 bits to read
06BE                  02741 KGetLoop
06BE   0CF3           02742                         rrf Value,F; rotate to right to get a shift
06BF   13F3           02743                         bcf Value,7; Force MSB to zero to disable Carry state used
06C0   26CE           02744                         call KPSGetBit; Get a bit from keyboard
06C1   04F3           02745                         iorwf Value,F; logical OR with previous value
06C2   06F6           02746                         xorwf PARITY,F; Parity calc
06C3   0BF2           02747                         decfsz Counter,F; check if we should get another one
06C4   2EBE           02748                 goto KGetLoop
06C5   26CE           02749                 call KPSGetBit; get parity bit
06C6   06F6           02750                 xorwf PARITY,F
06C7   26CE           02751                 call KPSGetBit; get stop bit
06C8   3800           02752                 iorlw 0
06C9   1903           02753                 btfsc STATUS,Z
06CA   01F6           02754                         clrf PARITY; stop bit = 0 => erreur
06CB   1FF6           02755                 btfss PARITY,7
06CC   01F3           02756                         clrf Value; erreur
06CD   0008           02757                 return
                      02758 
06CE                  02759 KPSGetBit
06CE   0103           02760                 clrw
                      02761                 WAIT_KCLOCK_L; attente front descendant de CLK
  0000                    M                 LOCAL WKCL1,WKCL2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WKCL1
                          M                         btfss PORTB,KCLOCK; attente front descendant de CLK
                          M                                 goto WKCL2
                          M                         decfsz Counter2,F
                          M                 goto WKCL1
                          M WKCL2
                          M                 ELSE
06CF   1886               M                 btfsc PORTB,KCLOCK; attente front descendant de CLK
06D0   2ECF               M                         goto $ -1
                          M                 ENDIF
06D1   1806           02762                 btfsc PORTB,KDATA
06D2   3080           02763                         movlw BIT_UN
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 70


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      02764                 WAIT_KCLOCK_H; attente front montant de CLK     
  0000                    M                 LOCAL WKCH1,WKCH2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WKCH1
                          M                         btfsc PORTB,KCLOCK; attente front montant de CLK
                          M                                 goto WKCH2
                          M                         decfsz Counter2,F
                          M                 goto WKCH1
                          M WKCH2
                          M                 ELSE
06D3   1C86               M                 btfss PORTB,KCLOCK; attente front montant de CLK
06D4   2ED3               M                         goto $ -1
                          M                 ENDIF
06D5   0008           02765                 return
                      02766 
                      02767 ;-----------------------------------------------------------------------------
                      02768 ;This routine sends a byte in w to a PS/2 mouse or keyboard.  TEMP1, TEMP2,
                      02769 ;and PARITY are general purpose registers.  CLOCK and DATA are assigned to
                      02770 ;port bits, and "Delay" is a self-explainatory macro.  DATA and CLOCK are
                      02771 ;held high by setting their I/O pin to input and allowing an external pullup
                      02772 ;resistor to pull the line high.  The lines are brought low by setting the
                      02773 ;I/O pin to output and writing a "0" to the pin.
                      02774 ;-----------------------------------------------------------------------------
                      02775 
06D6                  02776 KPS2cmd
06D6   00F4           02777                 movwf TEMP1; Store to-be-sent byte
                      02778                 IF !NON_BLOQUANT
06D7   3008           02779                 movlw 8; 8 bits
06D8   00F2           02780                 movwf Counter; Initialize a counter             
                      02781                 ENDIF
06D9   01F6           02782                 clrf PARITY; Used for parity calc
06DA   1683           02783                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
06DB   1086           02784                 bcf TRISB,KCLOCK; en sortie
06DC   1283           02785                 bcf STATUS,RP0; page 0
06DD   1086           02786                 bcf PORTB,KCLOCK; Inhibit communication
                      02787                 Delay 100; for at least 100 microseconds
                          M 
                          M     if (100==1)
                          M           nop
                          M           exitm
                          M     endif
                          M     if (100==2)
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (100==3)
                          M           nop
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (100==4)
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 71


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M           goto $ + 1
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (100==5)
                          M           goto $ + 1
                          M           goto $ + 1
                          M           nop
                          M           exitm
                          M     endif
                          M     if (100==6)
                          M           goto $ + 1
                          M           goto $ + 1
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (100==7)
                          M           goto $ + 1
                          M           goto $ + 1
                          M           goto $ + 1
                          M           nop
                          M           exitm
                          M     endif
                          M     if (100%4==0)
06DE   3018               M           movlw (100-4)/4
06DF   2754               M           call Delay_Routine
                          M           exitm
06E0   1683           02788                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
06E1   1006           02789                 bcf TRISB,KDATA; en sortie
06E2   1283           02790                 bcf STATUS,RP0; page 0
06E3   1006           02791                 bcf PORTB,KDATA; valide l'ecriture, pull DATA low
                      02792                 Delay 5
                          M 
                          M     if (5==1)
                          M           nop
                          M           exitm
                          M     endif
                          M     if (5==2)
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (5==3)
                          M           nop
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (5==4)
                          M           goto $ + 1
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (5==5)
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 72


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

06E4   2EE5               M           goto $ + 1
06E5   2EE6               M           goto $ + 1
06E6   0000               M           nop
                          M           exitm
06E7   1683           02793                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
06E8   1486           02794                 bsf TRISB,KCLOCK; en entree, release CLOCK
06E9   1283           02795                 bcf STATUS,RP0; page 0
                      02796                 IF NON_BLOQUANT
                      02797                 call Wait_Mclock; utilise Counter
                      02798                 movlw 8; 8 bits
                      02799                 movwf Counter; Initialize a counter
                      02800                 ENDIF
06EA                  02801 KPS2cmdLoop
06EA   0874           02802                         movf TEMP1,W
06EB   06F6           02803                         xorwf PARITY,F; Parity calc
06EC   26F9           02804                         call KPS2cmdBit; Output 8 data bits
06ED   0CF4           02805                         rrf TEMP1,F
06EE   0BF2           02806                         decfsz Counter,F
06EF   2EEA           02807                 goto KPS2cmdLoop
06F0   0976           02808                 comf PARITY,W
06F1   26F9           02809                 call KPS2cmdBit; Output parity bit
06F2   3001           02810                 movlw 1
06F3   26F9           02811                 call KPS2cmdBit; Output stop bit (1)
                      02812                 WAIT_KCLOCK_L; attente front descendant de CLK
  0000                    M                 LOCAL WKCL1,WKCL2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WKCL1
                          M                         btfss PORTB,KCLOCK; attente front descendant de CLK
                          M                                 goto WKCL2
                          M                         decfsz Counter2,F
                          M                 goto WKCL1
                          M WKCL2
                          M                 ELSE
06F4   1886               M                 btfsc PORTB,KCLOCK; attente front descendant de CLK
06F5   2EF4               M                         goto $ -1
                          M                 ENDIF
                      02813                 WAIT_KCLOCK_H; attente front montant de CLK (ACK)
  0000                    M                 LOCAL WKCH1,WKCH2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WKCH1
                          M                         btfsc PORTB,KCLOCK; attente front montant de CLK
                          M                                 goto WKCH2
                          M                         decfsz Counter2,F
                          M                 goto WKCH1
                          M WKCH2
                          M                 ELSE
06F6   1C86               M                 btfss PORTB,KCLOCK; attente front montant de CLK
06F7   2EF6               M                         goto $ -1
                          M                 ENDIF
06F8   0008           02814                 return
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 73


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      02815 
06F9                  02816 KPS2cmdBit
                      02817                 WAIT_KCLOCK_L; attente front descendant de CLK
  0000                    M                 LOCAL WKCL1,WKCL2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WKCL1
                          M                         btfss PORTB,KCLOCK; attente front descendant de CLK
                          M                                 goto WKCL2
                          M                         decfsz Counter2,F
                          M                 goto WKCL1
                          M WKCL2
                          M                 ELSE
06F9   1886               M                 btfsc PORTB,KCLOCK; attente front descendant de CLK
06FA   2EF9               M                         goto $ -1
                          M                 ENDIF
06FB   1683           02818                 bsf STATUS,RP0; page 1
06FC   3901           02819                 andlw 1
06FD   1D03           02820                 btfss STATUS,Z ; Set/Reset DATA line
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
06FE   1406           02821                         bsf TRISB,KDATA; en entree
06FF   1903           02822                 btfsc STATUS,Z
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0700   1006           02823                         bcf TRISB,KDATA; en sortie
0701   1283           02824                 bcf STATUS,RP0; page 0
                      02825                 WAIT_KCLOCK_H; attente front montant de CLK
  0000                    M                 LOCAL WKCH1,WKCH2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WKCH1
                          M                         btfsc PORTB,KCLOCK; attente front montant de CLK
                          M                                 goto WKCH2
                          M                         decfsz Counter2,F
                          M                 goto WKCH1
                          M WKCH2
                          M                 ELSE
0702   1C86               M                 btfss PORTB,KCLOCK; attente front montant de CLK
0703   2F02               M                         goto $ -1
                          M                 ENDIF
0704   0008           02826                 return
                      02827 
                      02828                 IF NON_BLOQUANT
                      02829 Wait_Kclock
                      02830                 movlw 16
                      02831                 movwf Counter; time-out
                      02832                 clrf Counter2
                      02833                 clrf Counter3
                      02834 WCK
                      02835                                         btfss PORTB,KCLOCK; attente front descendant de CLK
                      02836                                                 return
                      02837                                         decfsz Counter3,F
                      02838                                 goto WCK
                      02839                                 decfsz Counter2,F
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 74


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      02840                         goto WCK
                      02841                         decfsz Counter,F
                      02842                 goto WCK
                      02843                 return
                      02844                 ENDIF
                      02845 
                      02846 ;-----------------------------------------------------------------------------
                      02847 ;   Emission d'une commande sur la souris.
                      02848 ;
                      02849 ;   Entree: W
                      02850 ;   Sortie: W = detruit
                      02851 ;
                      02852 ;   Global: Aucune.
                      02853 ;----------------------------------------------------------------------------
                      02854 
0705                  02855 MPSCmd
0705   2725           02856                 call MPS2cmd; => atente Value Acknowledge
                      02857                 
                      02858 ;-----------------------------------------------------------------------------
                      02859 ;   Routine de lecture d'un octet sur le port SOURIS. Elle ATTEND qu'un paquet
                      02860 ;       soit disponible.
                      02861 ;
                      02862 ;   Entree: Rien
                      02863 ;   Sortie: W = 1 si octet recu sinon 0
                      02864 ;           VAR Value = octet recu
                      02865 ;-----------------------------------------------------------------------------
                      02866 
0706                  02867 MPSGet
                      02868                 ; Test l'horloge, si etat bas, la souris communique
                      02869                 IF NON_BLOQUANT
                      02870                 call Wait_Mclock
                      02871                 ELSE
                      02872                 WAIT_MCLOCK_L; attente front descendant de CLK
  0000                    M                 LOCAL WMCL1,WMCL2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WMCL1
                          M                         btfss PORTB,MCLOCK; attente front descendant de CLK
                          M                                 goto WMCL2
                          M                         decfsz Counter2,F
                          M                 goto WMCL1
                          M WMCL2
                          M                 ELSE
0706   1986               M                 btfsc PORTB,MCLOCK; attente front descendant de CLK
0707   2F06               M                         goto $ -1
                          M                 ENDIF
                      02873                 ENDIF
0708                  02874 MPSGet2
0708   01F6           02875                 clrf PARITY; Used for parity calc
0709   271D           02876                 call MPSGetBit; get start bit (for nothing)
070A   01F3           02877                 clrf Value; clear value
070B   3008           02878                 movlw 8; 8 bits
070C   00F2           02879                 movwf Counter; Set counter to 8 bits to read
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 75


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

070D                  02880 MGetLoop
070D   0CF3           02881                         rrf Value,F; rotate to right to get a shift
070E   13F3           02882                         bcf Value,7; Force MSB to zero to disable Carry state used
070F   271D           02883                         call MPSGetBit; Get a bit from mouse
0710   04F3           02884                         iorwf Value,F; logical OR with previous value
0711   06F6           02885                         xorwf PARITY,F; Parity calc
0712   0BF2           02886                         decfsz Counter,F; check if we should get another one
0713   2F0D           02887                 goto MGetLoop
0714   271D           02888                 call MPSGetBit; get parity bit
0715   06F6           02889                 xorwf PARITY,F
0716   271D           02890                 call MPSGetBit; get stop bit
0717   3800           02891                 iorlw 0
0718   1903           02892                 btfsc STATUS,Z
0719   01F6           02893                         clrf PARITY; stop bit = 0 => erreur
071A   1FF6           02894                 btfss PARITY,7
071B   01F3           02895                         clrf Value; erreur
071C   0008           02896                 return
                      02897 
071D                  02898 MPSGetBit
071D   0103           02899                 clrw
                      02900                 WAIT_MCLOCK_L; attente front descendant de CLK
  0000                    M                 LOCAL WMCL1,WMCL2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WMCL1
                          M                         btfss PORTB,MCLOCK; attente front descendant de CLK
                          M                                 goto WMCL2
                          M                         decfsz Counter2,F
                          M                 goto WMCL1
                          M WMCL2
                          M                 ELSE
071E   1986               M                 btfsc PORTB,MCLOCK; attente front descendant de CLK
071F   2F1E               M                         goto $ -1
                          M                 ENDIF
0720   1906           02901                 btfsc PORTB,MDATA
0721   3080           02902                         movlw BIT_UN
                      02903                 WAIT_MCLOCK_H; attente front montant de CLK
  0000                    M                 LOCAL WMCH1,WMCH2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WMCH1
                          M                         btfsc PORTB,MCLOCK; attente front montant de CLK
                          M                                 goto WMCH2
                          M                         decfsz Counter2,F
                          M                 goto WMCH1
                          M WMCH2
                          M                 ELSE
0722   1D86               M                 btfss PORTB,MCLOCK; attente front montant de CLK
0723   2F22               M                         goto $ -1
                          M                 ENDIF
0724   0008           02904                 return
                      02905                 
                      02906 ;-----------------------------------------------------------------------------
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 76


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      02907 ;This routine sends a byte in w to a PS/2 mouse.
                      02908 ;-----------------------------------------------------------------------------
                      02909 
0725                  02910 MPS2cmd
0725   00F4           02911                 movwf TEMP1; Store to-be-sent byte
                      02912                 IF !NON_BLOQUANT
0726   3008           02913                 movlw 8; 8 bits
0727   00F2           02914                 movwf Counter; Initialize a counter             
                      02915                 ENDIF
0728   01F6           02916                 clrf PARITY; Used for parity calc
0729   1683           02917                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
072A   1186           02918                 bcf TRISB,MCLOCK; en sortie
072B   1283           02919                 bcf STATUS,RP0; page 0
072C   1186           02920                 bcf PORTB,MCLOCK; Inhibit communication
                      02921                 Delay 100; for at least 100 microseconds
                          M 
                          M     if (100==1)
                          M           nop
                          M           exitm
                          M     endif
                          M     if (100==2)
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (100==3)
                          M           nop
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (100==4)
                          M           goto $ + 1
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (100==5)
                          M           goto $ + 1
                          M           goto $ + 1
                          M           nop
                          M           exitm
                          M     endif
                          M     if (100==6)
                          M           goto $ + 1
                          M           goto $ + 1
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (100==7)
                          M           goto $ + 1
                          M           goto $ + 1
                          M           goto $ + 1
                          M           nop
                          M           exitm
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 77


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M     endif
                          M     if (100%4==0)
072D   3018               M           movlw (100-4)/4
072E   2754               M           call Delay_Routine
                          M           exitm
072F   1683           02922                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0730   1106           02923                 bcf TRISB,MDATA; en sortie
0731   1283           02924                 bcf STATUS,RP0; page 0
0732   1106           02925                 bcf PORTB,MDATA; valide l'ecriture, pull DATA low
                      02926                 Delay 5
                          M 
                          M     if (5==1)
                          M           nop
                          M           exitm
                          M     endif
                          M     if (5==2)
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (5==3)
                          M           nop
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (5==4)
                          M           goto $ + 1
                          M           goto $ + 1
                          M           exitm
                          M     endif
                          M     if (5==5)
0733   2F34               M           goto $ + 1
0734   2F35               M           goto $ + 1
0735   0000               M           nop
                          M           exitm
0736   1683           02927                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0737   1586           02928                 bsf TRISB,MCLOCK; en entree, release CLOCK
0738   1283           02929                 bcf STATUS,RP0; page 0
                      02930                 IF NON_BLOQUANT
                      02931                 call Wait_Mclock; utilise Counter
                      02932                 movlw 8; 8 bits
                      02933                 movwf Counter; Initialize a counter
                      02934                 ENDIF
0739                  02935 MPS2cmdLoop
0739   0874           02936                         movf TEMP1,W
073A   06F6           02937                         xorwf PARITY,F; Parity calc
073B   2748           02938                         call MPS2cmdBit; Output 8 data bits
073C   0CF4           02939                         rrf TEMP1,F
073D   0BF2           02940                         decfsz Counter,F
073E   2F39           02941                 goto MPS2cmdLoop
073F   0976           02942                 comf PARITY,W
0740   2748           02943                 call MPS2cmdBit; Output parity bit
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 78


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0741   3001           02944                 movlw 1
0742   2748           02945                 call MPS2cmdBit; Output stop bit (1)
                      02946                 WAIT_MCLOCK_L; attente front descendant de CLK
  0000                    M                 LOCAL WMCL1,WMCL2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WMCL1
                          M                         btfss PORTB,MCLOCK; attente front descendant de CLK
                          M                                 goto WMCL2
                          M                         decfsz Counter2,F
                          M                 goto WMCL1
                          M WMCL2
                          M                 ELSE
0743   1986               M                 btfsc PORTB,MCLOCK; attente front descendant de CLK
0744   2F43               M                         goto $ -1
                          M                 ENDIF
                      02947                 WAIT_MCLOCK_H; attente front montant de CLK (ACK)
  0000                    M                 LOCAL WMCH1,WMCH2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WMCH1
                          M                         btfsc PORTB,MCLOCK; attente front montant de CLK
                          M                                 goto WMCH2
                          M                         decfsz Counter2,F
                          M                 goto WMCH1
                          M WMCH2
                          M                 ELSE
0745   1D86               M                 btfss PORTB,MCLOCK; attente front montant de CLK
0746   2F45               M                         goto $ -1
                          M                 ENDIF
0747   0008           02948                 return
                      02949                 
0748                  02950 MPS2cmdBit
                      02951                 WAIT_MCLOCK_L; attente front descendant de CLK
  0000                    M                 LOCAL WMCL1,WMCL2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WMCL1
                          M                         btfss PORTB,MCLOCK; attente front descendant de CLK
                          M                                 goto WMCL2
                          M                         decfsz Counter2,F
                          M                 goto WMCL1
                          M WMCL2
                          M                 ELSE
0748   1986               M                 btfsc PORTB,MCLOCK; attente front descendant de CLK
0749   2F48               M                         goto $ -1
                          M                 ENDIF
074A   1683           02952                 bsf STATUS,RP0; page 1
074B   3901           02953                 andlw 1
074C   1D03           02954                 btfss STATUS,Z; Set/Reset DATA line
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
074D   1506           02955                         bsf TRISB,MDATA; en entree
074E   1903           02956                 btfsc STATUS,Z
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 79


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
074F   1106           02957                         bcf TRISB,MDATA; en sortie
0750   1283           02958                 bcf STATUS,RP0; page 0
                      02959                 WAIT_MCLOCK_H; attente front montant de CLK
  0000                    M                 LOCAL WMCH1,WMCH2
                          M                 IF NON_BLOQUANT
                          M                 clrf Counter2; time-out
                          M WMCH1
                          M                         btfsc PORTB,MCLOCK; attente front montant de CLK
                          M                                 goto WMCH2
                          M                         decfsz Counter2,F
                          M                 goto WMCH1
                          M WMCH2
                          M                 ELSE
0751   1D86               M                 btfss PORTB,MCLOCK; attente front montant de CLK
0752   2F51               M                         goto $ -1
                          M                 ENDIF
0753   0008           02960                 return
                      02961 
                      02962                 IF NON_BLOQUANT
                      02963 Wait_Mclock
                      02964                 movlw 16
                      02965                 movwf Counter; time-out
                      02966                 clrf Counter2
                      02967                 clrf Counter3
                      02968 WCM
                      02969                                         btfss PORTB,MCLOCK; attente front descendant de CLK
                      02970                                                 return
                      02971                                         decfsz Counter3,F
                      02972                                 goto WCM
                      02973                                 decfsz Counter2,F
                      02974                         goto WCM
                      02975                         decfsz Counter,F
                      02976                 goto WCM
                      02977                 return
                      02978                 ENDIF
                      02979 
                      02980 ;------------------------------------------------------------------------
                      02981 ; Delays 4w+4 cycles (including call,return, and movlw) (0=256)
                      02982 ;------------------------------------------------------------------------
                      02983 
0754                  02984 Delay_Routine
0754   3EFF           02985                         addlw -1; Precise delays used in I/O
0755   1D03           02986                         btfss STATUS, Z
0756   2F54           02987                                 goto Delay_Routine
0757   0008           02988                 return
                      02989         
0758                  02990 Lecture_EEProm
                      02991                 RDEEPROM2
0758   1703               M                 bsf STATUS,RP1; page 2
0759   1283               M                 bcf STATUS,RP0;
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
075A   008D               M                 movwf EEADR
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 80


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

075B   1683               M                 bsf STATUS,RP0; page 3
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
075C   138C               M                 bcf EECON1,EEPGD; EEPROM
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
075D   140C               M                 bsf EECON1,RD; lecture
075E   1283               M                 bcf STATUS,RP0; page 2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
075F   080C               M                 movf EEDATA,W
0760   1303               M                 bcf STATUS,RP1; page 0
0761   0008           02992                 return
                      02993                 
0762                  02994 Leds_Eiffel_On
0762   1306           02995                 bcf PORTB,LEDGREEN; allume les deux LEDs
0763   1386           02996                 bcf PORTB,LEDYELLOW
0764   0008           02997                 return
                      02998 
0765                  02999 Leds_Eiffel_Off
0765   1706           03000                 bsf PORTB,LEDGREEN; eteint les deux LEDs
0766   1786           03001                 bsf PORTB,LEDYELLOW
0767   0008           03002                 return
                      03003 
                      03004 
0900                  03005                 ORG   900H; zone de 0x800 a 0x8FF pour le programme de flashage
                      03006 
                      03007 ;=============================================================================
                      03008 ;                               PROCEDURES ET FONCTIONS
                      03009 ;-----------------------------------------------------------------------------
                      03010 ; Zone en page 1 ou 3 pour des fonctions 
                      03011 ;
                      03012 ; du programme en page 0, appel: 
                      03013 ;               bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)
                      03014 ;               call fonction
                      03015 ;               bcf PCLATH,3; page 0 ou 2
                      03016 ;=============================================================================
                      03017 
                      03018 ;------------------------------------------------------------------------
                      03019 ; Envoit le contenu de W en 'BCD' sur la liaison serie.
                      03020 ; C'est a dire: W = 0x41 => Emission de l'ASCII '4' puis ASCII '1'
                      03021 ;
                      03022 ; Entree: W = donnee binaire
                      03023 ; Sortie: Rien
                      03024 ;
                      03025 ; Global: TEMP2, TEMP3 sont utilises
                      03026 ;------------------------------------------------------------------------
                      03027                 IF DEBUG_CODE
                      03028 SendBCD
                      03029                 movwf TEMP3; sauver la valeur a traiter
                      03030                 ; Just to have 0x printed on screen
                      03031                 movlw '$'
                      03032                 call SerialTransmit; envoyer l'octet vers le Host
                      03033                 movf TEMP3,W
                      03034                 ; First part: process high nibble
                      03035                 andlw 0xF0; Commencer par le MSB
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 81


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      03036                 movwf TEMP2; transfere pour decalage 4 bits
                      03037                 rrf TEMP2,F; logical shift right in F
                      03038                 rrf TEMP2,F; logical shift right in F
                      03039                 rrf TEMP2,F; logical shift right in F
                      03040                 rrf TEMP2,W; logical shift right F put in W
                      03041                 andlw 0x0F; clear upper nibble...
                      03042                 bcf PCLATH,3; page 0 ou 2
                      03043                 call LookUp; chercher le code ASCII
                      03044                 bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)
                      03045                 call SerialTransmit
                      03046                 ; Second part: process low nibble
                      03047                 movf TEMP3,W; reprendre la donnee
                      03048                 andlw 0x0F; et traiter le LSB
                      03049                 call LookUp; chercher le code ASCII
                      03050                 goto SerialTransmit
                      03051                 
                      03052 ;-----------------------------------------------------------------------------
                      03053 ;   Envoi de la chaine de bienvenue sur la RS232
                      03054 ;-----------------------------------------------------------------------------
                      03055 
                      03056 SerialWelcome
                      03057                 clrf Counter
                      03058                 clrw
                      03059 Send
                      03060                         call Texte
                      03061                         bcf PCLATH,3; page 0 ou 2
                      03062                         call Texte
                      03063                         bsf PCLATH,3; page 1 ou 3 (0x800 - 0xFFF)
                      03064                         iorlw 0
                      03065                         btfss STATUS,Z
                      03066                                 goto $ + 2
                      03067                         goto Finish                
                      03068                         call SerialTransmit
                      03069                         incf Counter,F
                      03070                         movf Counter,W
                      03071                 goto Send
                      03072 Finish
                      03073                 return
                      03074                 ENDIF
                      03075                 
                      03076 ;-----------------------------------------------------------------------------
                      03077 ;   Transmit byte in W register from USART
                      03078 ;
                      03079 ; Entree: W = donnee binaire
                      03080 ; Sortie: Rien
                      03081 ;
                      03082 ; Global: TEMP4, TEMP5, TEMP6, DEB_INDEX_EM, FIN_INDEX_EM, TAMPON_EM utilises
                      03083 ;-----------------------------------------------------------------------------
                      03084                 
0900                  03085 SerialTransmit
0900   1FF8           03086                 btfss MyStatus,IKBD_ENABLE
0901   0008           03087                         return
0902   00FC           03088                 movwf TEMP4
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 82


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0903   0839           03089                 movf FIN_INDEX_EM,W 
0904   1E0C           03090                 btfss PIR1,TXIF; check that buffer is empty 
0905   290D           03091                         goto TxReg_Full
0906   0238           03092                 subwf DEB_INDEX_EM,W
0907   1D03           03093                 btfss STATUS,Z
0908   290D           03094                         goto TxReg_Full; FIN_INDEX_EM <> DEB_INDEX_EM => caractere encore present dans l
                            e buffer circulaire
0909   087C           03095                 movf TEMP4,W
090A   0099           03096                 movwf TXREG; transmit byte
090B   12F9           03097                 bcf MyStatus2,DATATOSEND; flag rien a envoyer dans la boucle principale Main
090C   0008           03098                 return
090D                  03099 TxReg_Full
090D   0803           03100                 movf STATUS,W
090E   00F1           03101                 movwf TEMP6; sauve IRP
090F   0804           03102                 movf FSR,W
0910   00F0           03103                 movwf TEMP5; sauve FSR
0911   1383           03104                 bcf STATUS,IRP; page 0
0912   0A39           03105                 incf FIN_INDEX_EM,W; incremente index buffer cirulaire dnnees a envoyer
0913   0084           03106                 movwf FSR; pointeur index
0914   3010           03107                 movlw TAILLE_TAMPON_EM
0915   0204           03108                 subwf FSR,W
0916   1803           03109                 btfsc STATUS,C
0917   0184           03110                         clrf FSR; buffer circulaire
0918   0838           03111                 movf DEB_INDEX_EM,W
0919   0204           03112                 subwf FSR,W
091A   1903           03113                 btfsc STATUS,Z
091B   2923           03114                         goto End_SerialTransmit; tampon plein
091C   0804           03115                 movf FSR,W
091D   00B9           03116                 movwf FIN_INDEX_EM
091E   3028           03117                 movlw TAMPON_EM
091F   0784           03118                 addwf FSR,F; pointeur index
0920   087C           03119                 movf TEMP4,W
0921   0080           03120                 movwf INDF; ecriture dans le tampon
0922   16F9           03121                 bsf MyStatus2,DATATOSEND; flag donnees a envoyer dans la boucle prinipale Main
0923                  03122 End_SerialTransmit
0923   0870           03123                 movf TEMP5,W
0924   0084           03124                 movwf FSR; restitue FSR
0925   0871           03125                 movf TEMP6,W
0926   0083           03126                 movwf STATUS; restitue IRP
0927   0008           03127                 return  
                      03128 
                      03129 ;-----------------------------------------------------------------------------
                      03130 ;               Conversion inverse echelle souris en X mode absolu 
                      03131 ;               X_POS = X_POS_SCALED * X_SCALE
                      03132 ;-----------------------------------------------------------------------------
                      03133 
0928                  03134 Conv_Inv_Scale_X
0928   01DF           03135                 clrf X_POSL; X_POS = X_POS_SCALED * X_SCALE
0929   01DE           03136                 clrf X_POSH
092A   085C           03137                 movf X_SCALE,W
092B   00F2           03138                 movwf Counter
092C                  03139 Loop_Inv_Scale_X
092C   0863           03140                         movf X_POSL_SCALED,W; position X absolue souris avec facteur d'echelle poids fai
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 83


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            ble
092D   07DF           03141                         addwf X_POSL,F
092E   0862           03142                         movf X_POSH_SCALED,W; position X absolue souris avec facteur d'echelle poids for
                            t
092F   1803           03143                         btfsc STATUS,C
0930   0F62           03144                                 incfsz X_POSH_SCALED,W
0931   07DE           03145                         addwf X_POSH,F
0932   0BF2           03146                         decfsz Counter,F
0933   292C           03147                 goto Loop_Inv_Scale_X
0934   0008           03148                 return  
                      03149 
                      03150 ;-----------------------------------------------------------------------------
                      03151 ;               Conversion inverse echelle souris en Y mode absolu
                      03152 ;               Y_POS = Y_POS_SCALED * Y_SCALE  
                      03153 ;-----------------------------------------------------------------------------
                      03154 
0935                  03155 Conv_Inv_Scale_Y
0935   01E1           03156                 clrf Y_POSL; Y_POS = Y_POS_SCALED * Y_SCALE
0936   01E0           03157                 clrf Y_POSH
0937   085D           03158                 movf Y_SCALE,W
0938   00F2           03159                 movwf Counter
0939                  03160 Loop_Inv_Scale_Y
0939   0865           03161                         movf Y_POSL_SCALED,W; position Y absolue souris avec facteur d'echelle poids fai
                            ble
093A   07E1           03162                         addwf Y_POSL,F
093B   0864           03163                         movf Y_POSH_SCALED,W; position Y absolue souris avec facteur d'echelle poids for
                            t
093C   1803           03164                         btfsc STATUS,C
093D   0F64           03165                                 incfsz Y_POSH_SCALED,W
093E   07E0           03166                         addwf Y_POSH,F
093F   0BF2           03167                         decfsz Counter,F
0940   2939           03168                 goto Loop_Inv_Scale_Y
0941   0008           03169                 return          
                      03170 
                      03171 ;-----------------------------------------------------------------------------
                      03172 ;               Conversion echelle souris en X mode absolu
                      03173 ;               X_POS = X_POS_SCALED / X_SCALE
                      03174 ;-----------------------------------------------------------------------------
                      03175                 
0942                  03176 Conv_Scale_X
0942   085F           03177                 movf X_POSL,W
0943   00F5           03178                 movwf Counter2
0944   085E           03179                 movf X_POSH,W
0945   00CD           03180                 movwf Counter3
0946   085C           03181                 movf X_SCALE,W
0947   2158           03182                 call Div_1608; X_POS = X_POS_SCALED / X_SCALE
0948   0875           03183                 movf Counter2,W
0949   00E3           03184                 movwf X_POSL_SCALED; position X absolue souris avec facteur d'echelle poids faible
094A   084D           03185                 movf Counter3,W
094B   00E2           03186                 movwf X_POSH_SCALED; position X absolue souris avec facteur d'echelle poids fort
094C   0008           03187                 return
                      03188                 
                      03189 ;-----------------------------------------------------------------------------
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 84


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      03190 ;               Conversion echelle souris en Y mode absolu
                      03191 ;               Y_POS = Y_POS_SCALED / Y_SCALE
                      03192 ;-----------------------------------------------------------------------------
                      03193 
094D                  03194 Conv_Scale_Y
094D   0861           03195                 movf Y_POSL,W
094E   00F5           03196                 movwf Counter2
094F   0860           03197                 movf Y_POSH,W
0950   00CD           03198                 movwf Counter3
0951   085D           03199                 movf Y_SCALE,W
0952   2158           03200                 call Div_1608; Y_POS = Y_POS_SCALED / Y_SCALE
0953   0875           03201                 movf Counter2,W
0954   00E5           03202                 movwf Y_POSL_SCALED; position Y absolue souris avec facteur d'echelle poids faible
0955   084D           03203                 movf Counter3,W
0956   00E4           03204                 movwf Y_POSH_SCALED; position Y absolue souris avec facteur d'echelle poids fort
0957   0008           03205                 return
                      03206 
                      03207 ;-----------------------------------------------------------------------------
                      03208 ;               Division Counter3:Counter2 /  TEMP3 
                      03209 ;                        resultat dans Counter3:Counter2
                      03210 ;                        reste dans Value
                      03211 ;-----------------------------------------------------------------------------
                      03212         
0958                  03213 Div_1608
0958   00FB           03214                 movwf TEMP3     
                      03215                 UDIV1608L Counter3,Counter2,TEMP3,Value
  0000                    M                 LOCAL LOOPU1608A,UOK68A,LOOPU1608B,UOK68B
0959   01F3               M                 clrf Value
095A   3008               M                 movlw 8
095B   00F2               M                 movwf Counter
095C   0D4D               M LOOPU1608A              rlf Counter3,W
095D   0DF3               M                         rlf Value,F
095E   087B               M                         movf TEMP3,W
095F   02F3               M                         subwf Value,F
0960   1803               M                         btfsc STATUS,C
0961   2964               M                                 goto UOK68A
0962   07F3               M                         addwf Value,F
0963   1003               M                         bcf STATUS,C
0964   0DCD               M UOK68A                  rlf Counter3,F
0965   0BF2               M                         decfsz Counter,F
0966   295C               M                 goto  LOOPU1608A
0967   01F4               M                 clrf  TEMP1
0968   3008               M                 movlw 8
0969   00F2               M                 movwf Counter
096A   0D75               M LOOPU1608B              rlf Counter2,W
096B   0DF3               M                         rlf Value,F
096C   0DF4               M                         rlf TEMP1,F
096D   087B               M                         movf TEMP3,W
096E   02F3               M                         subwf Value,F
096F   01F7               M                         clrf TEMP2
0970   0103               M                         clrw
0971   1C03               M                         btfss STATUS,C
0972   0F77               M                                 incfsz TEMP2,W
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 85


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0973   02F4               M                         subwf TEMP1,F
0974   1803               M                         btfsc STATUS,C
0975   297E               M                                 goto UOK68B
0976   087B               M                         movf TEMP3,W
0977   07F3               M                         addwf Value,F
0978   01F7               M                         clrf TEMP2
0979   0103               M                         clrw
097A   1803               M                         btfsc STATUS,C
097B   0F77               M                                 incfsz TEMP2,W
097C   07F4               M                         addwf TEMP1,F
097D   1003               M                         bcf STATUS,C
097E   0DF5               M UOK68B                  rlf Counter2,F
097F   0BF2               M                         decfsz Counter,F
0980   296A               M                 goto  LOOPU1608B
0981   0008           03216                 return  
                      03217 
                      03218 ;-----------------------------------------------------------------------------
                      03219 ;               Initialisation conversion BCD horloge 
                      03220 ;-----------------------------------------------------------------------------
                      03221                 
0982                  03222 Init_Conv_BCD_Time
0982   303A           03223                 movlw YEAR_BCD
0983   00CD           03224                 movwf Counter3
0984   3010           03225                 movlw YEAR & 0xFF
0985   00F5           03226                 movwf Counter2
0986   3006           03227                 movlw 6
0987   00F2           03228                 movwf Counter
0988   0008           03229                 return
                      03230                 
                      03231 ;------------------------------------------------------------------------
                      03232 ; Conversion BCD en binaire de l'horloge
                      03233 ; YEAR_BCD, MONTH_BCD, DAY_BCD, HRS_BCD, MIN_BCD, et SEC_BCD  
                      03234 ; => YEAR, MONTH, DAY, HRS, MIN, et SEC  
                      03235 ;
                      03236 ; Global: TEMP1, Counter1, Counter2, Counter3 sont utilises
                      03237 ;------------------------------------------------------------------------
                      03238 
0989                  03239 Conv_Inv_BCD_Time
0989   2182           03240                 call Init_Conv_BCD_Time
098A                  03241 Loop_BCD_Time
098A   1383           03242                         bcf STATUS,IRP; page 0
098B   084D           03243                         movf Counter3,W
098C   0084           03244                         movwf FSR
098D   0800           03245                         movf INDF,W; valeur BCD
098E   00F4           03246                         movwf TEMP1
098F   0103           03247                         clrw
0990   1874           03248                         btfsc TEMP1,0
0991   3E01           03249                                 addlw 1
0992   18F4           03250                         btfsc TEMP1,1
0993   3E02           03251                                 addlw 2
0994   1974           03252                         btfsc TEMP1,2
0995   3E04           03253                                 addlw 4
0996   19F4           03254                         btfsc TEMP1,3
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 86


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0997   3E08           03255                                 addlw 8
0998   1A74           03256                         btfsc TEMP1,4
0999   3E0A           03257                                 addlw 10
099A   1AF4           03258                         btfsc TEMP1,5
099B   3E14           03259                                 addlw 20
099C   1B74           03260                         btfsc TEMP1,6
099D   3E28           03261                                 addlw 40
099E   1BF4           03262                         btfsc TEMP1,7
099F   3E50           03263                                 addlw 80
09A0   1783           03264                         bsf STATUS,IRP; page 2
09A1   00F4           03265                         movwf TEMP1
09A2   0875           03266                         movf Counter2,W
09A3   0084           03267                         movwf FSR
09A4   0874           03268                         movf TEMP1,W
09A5   0080           03269                         movwf INDF; valeur decimale
09A6   0AF5           03270                         incf Counter2,F
09A7   0ACD           03271                         incf Counter3,F
09A8   0BF2           03272                         decfsz Counter,F        
09A9   298A           03273                 goto Loop_BCD_Time
09AA   0008           03274                 return
                      03275 
                      03276 ;------------------------------------------------------------------------
                      03277 ; Conversion binaire en BCD de l'horloge
                      03278 ; YEAR, MONTH, DAY, HRS, MIN, et SEC  
                      03279 ; => YEAR_BCD, MONTH_BCD, DAY_BCD, HRS_BCD, MIN_BCD, et SEC_BCD  
                      03280 ;
                      03281 ; Global: TEMP1, TEMP2, Counter1, Counter2, Counter3 sont utilises
                      03282 ;------------------------------------------------------------------------
                      03283 
09AB                  03284 Conv_BCD_Time
09AB   2182           03285                 call Init_Conv_BCD_Time
09AC                  03286 Loop_Time_BCD
09AC   1783           03287                         bsf STATUS,IRP; page 2
09AD   0875           03288                         movf Counter2,W
09AE   0084           03289                         movwf FSR
09AF   0800           03290                         movf INDF,W; valeur decimale
09B0   00F4           03291                         movwf TEMP1;poids faible BCD
09B1   01F7           03292                         clrf TEMP2; poids fort BCD
09B2                  03293 Loop_BCD
09B2   300A           03294                                 movlw 10
09B3   0274           03295                                 subwf TEMP1,W
09B4   1C03           03296                                 btfss STATUS,C
09B5   29B9           03297                                         goto Exit_BCD
09B6   00F4           03298                                 movwf TEMP1; poids faible BCD
09B7   0AF7           03299                                 incf TEMP2,F; poids fort BCD
09B8   29B2           03300                         goto Loop_BCD
09B9                  03301 Exit_BCD
09B9   1383           03302                         bcf STATUS,IRP; page 0
09BA   084D           03303                         movf Counter3,W
09BB   0084           03304                         movwf FSR
09BC   0DF7           03305                         rlf TEMP2,F
09BD   0DF7           03306                         rlf TEMP2,F
09BE   0DF7           03307                         rlf TEMP2,F
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 87


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

09BF   0D77           03308                         rlf TEMP2,W
09C0   39F0           03309                         andlw 0xF0
09C1   0474           03310                         iorwf TEMP1,W
09C2   0080           03311                         movwf INDF; valeur BCD
09C3   0AF5           03312                         incf Counter2,F
09C4   0ACD           03313                         incf Counter3,F
09C5   0BF2           03314                         decfsz Counter,F        
09C6   29AC           03315                 goto Loop_Time_BCD
09C7   0008           03316                 return
                      03317 
                      03318 ;------------------------------------------------------------------------
                      03319 ; Initialisation registres et variables
                      03320 ;------------------------------------------------------------------------
                      03321 
09C8                  03322 Init
09C8   1683           03323                 bsf STATUS,RP0; page 1
09C9   1303           03324                 bcf STATUS,RP1
09CA   300E           03325                 movlw 0x0E
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
09CB   009F           03326                 movwf ADCON1; entrees digitales sauf AN0
09CC   30FF           03327                 movlw 0xFF
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
09CD   0085           03328                 movwf TRISA; 6 entrees
09CE   30DF           03329                 movlw 0xDF; MOTORON en sortie
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
09CF   0087           03330                 movwf TRISC; 7 entrees
09D0   3035           03331                 movlw KM_DISABLE; LEDYELLOW,LEDGREEN,MCLOCK,KCLOCK en sortie
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
09D1   0086           03332                 movwf TRISB
09D2   307D           03333                 movlw 125
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
09D3   0092           03334                 movwf PR2; timer 2 a 5 mS (1 MHz /4 /125 /10 )
09D4   1283           03335                 bcf STATUS,RP0; page 0
09D5   30C5           03336                 movlw 0xC5; RC osc, GO, ADON, lance la conversion A/D sur AN0
09D6   009F           03337                 movwf ADCON0
09D7   0185           03338                 clrf PORTA
                      03339                 ; set latchs B to 0 and set On LEDs
09D8   0186           03340                 clrf PORTB; allow to disable devices communications     
09D9   3049           03341                 movlw 0x49; timer 2 prediviseur par 4 et diviseur par 10
09DA   0092           03342                 movwf T2CON
09DB   0191           03343                 clrf TMR2
09DC   1512           03344                 bsf T2CON,TMR2ON; lance le timer 2                                              
                      03345                 ; setup RS-232 port at 9600 or 7812.
                      03346                 IF DEBUG_CODE
                      03347                 movlw BAUD_9600; set baud rate 9600 for 4Mhz clock (fosc/16*(X+1))
                      03348                 btfsc PORTB,JUMPER5; if Jumper5 enable (0V) skip
                      03349                 ENDIF
09DD   301F           03350                 movlw BAUD_7812_5; else set baud rate 7812.5 for 4Mhz clock
09DE   1683           03351                 bsf STATUS,RP0; page 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
09DF   0099           03352                 movwf SPBRG
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
09E0   1518           03353                 bsf TXSTA,BRGH; baud rate high speed option, Asynchronous High Speed
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 88


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
09E1   1698           03354                 bsf TXSTA,TXEN; enable transmission
09E2   1283           03355                 bcf STATUS,RP0; page 0
09E3   1618           03356                 bsf RCSTA,CREN; enable reception
09E4   1798           03357                 bsf RCSTA,SPEN; enable serial port (RC6/7)
09E5   01F8           03358                 clrf MyStatus; mettre a zero mots d'etat
09E6   01F9           03359                 clrf MyStatus2
09E7   01FA           03360                 clrf MyStatus3
09E8   0905           03361                 comf PORTA,W
09E9   00A6           03362                 movwf JOY0
09EA   0C26           03363                 rrf JOY0,W
09EB   391F           03364                 andlw 0x1F
09EC   00A6           03365                 movwf JOY0; lecture joystick 0
09ED   0907           03366                 comf PORTC,W
09EE   391F           03367                 andlw 0x1F
09EF   00A7           03368                 movwf JOY1; lecture joystick 1
09F0   01A2           03369                 clrf Val_AN0; lecture CTN sur AN0
09F1   01C9           03370                 clrf Temp; lecture temperature CTN sur AN0
09F2   01E6           03371                 clrf X_MAX_POSH; position X absolue maximale souris poids fort
09F3   01E7           03372                 clrf X_MAX_POSL; position X absolue maximale souris poids faible
09F4   01E8           03373                 clrf Y_MAX_POSH; position Y absolue maximale souris poids fort
09F5   01E9           03374                 clrf Y_MAX_POSL; position Y absolue maximale souris poids faible
09F6   3001           03375                 movlw 1
09F7   00DC           03376                 movwf X_SCALE; facteur d'echelle en X souris mode absolu
09F8   00DD           03377                 movwf Y_SCALE; facteur d'echelle en Y souris mode absolu
09F9   01EE           03378                 clrf DELTA_X; deltax mode keycode souris IKBD
09FA   01EF           03379                 clrf DELTA_Y; deltay mode keycode souris IKBD
09FB   01A3           03380                 clrf BUTTONS; etat des boutons souris
09FC   01A4           03381                 clrf OLD_BUTTONS; ancien etat des boutons souris
09FD   01A5           03382                 clrf OLD_BUTTONS_ABS; ancien etat des boutons souris mode absolu
09FE   01FD           03383                 clrf BUTTON_ACTION; mode button action IKBD
09FF   300A           03384                 movlw 10
0A00   00CE           03385                 movwf Counter_10MS_Joy; prediviseur envoi mode keycode joystick 0 (pas de 100 mS)
0A01   01CF           03386                 clrf Counter_100MS_Joy; compteur 100 mS mode keycode joystick 0
0A02   01C8           03387                 clrf Counter_Mouse; compteur octet reception trame souris PS/2
0A03   01B8           03388                 clrf DEB_INDEX_EM; index courant donnee a envoyer buffer circulaire liaison serie
0A04   01B9           03389                 clrf FIN_INDEX_EM; fin index donnee a envoyer buffer circulaire liaison serie
                      03390                 IF DEBUG_CODE
                      03391                 btfss PORTB,JUMPER5; if jumper5 disable (5V) no message
                      03392                         call SerialWelcome; else send this string
                      03393                 ENDIF
                      03394                 ; Le clavier et la souris PS/2 ont ete inhibes pendant le flashage
                      03395                 ; le reset a chaud envoi donc un reset clavier et a la souris.
                      03396                 ; En cas de demarrage a froid (mise sous tension), les commandes BAT
                      03397                 ; arrivent naturellement du clavier et de la souris PS/2.
0A05   1B20           03398                 btfsc Status_Boot,POWERUP_KEYB; mis a 1 des reception BAT clavier
0A06   1779           03399                         bsf MyStatus2,RESET_KEYB; valide reset clavier dans traitement timer
0A07   1BA0           03400                 btfsc Status_Boot,POWERUP_MOUSE; mis a 1 des reception BAT souris
0A08   17F9           03401                         bsf MyStatus2,RESET_MOUSE; valide reset souris dans traitement timer
0A09   108C           03402                 bcf PIR1,TMR2IF; acquitte timer 2
0A0A   0008           03403                 return
                      03404 
                      03405 ;------------------------------------------------------------------------
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 89


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      03406 
                      03407 
0800                  03408                 ORG   800H
                      03409 
                      03410 ;------------------------------------------------------------------------
                      03411 ; Programme de boot en page 0 ou 2 et de telechargement en Flash
                      03412 ;------------------------------------------------------------------------
                      03413 
0800                  03414 Start_Flash
0800   289C           03415                 goto Start_Flash_2
                      03416                 
0801                  03417 Ecriture_Flash  
0801   30FF           03418                 movlw 0xFF
0802   00F5           03419                 movwf Counter2; adresse FLASH poids faible
0803   300F           03420                 movlw 0x0F
0804   00F2           03421                 movwf Counter; adresse FLASH poids fort
0805   30FF           03422                 movlw 0xFF
0806   00FE           03423                 movwf BUFFER_FLASH
0807   303F           03424                 movlw 0x3F
0808   00FF           03425                 movwf BUFFER_FLASH+1
                      03426                 WRITE_FLASH Counter,Counter2,BUFFER_FLASH; ecriture 2 octet => programme mauvais (0x3FFF
                            )       
0809   1703               M                 bsf STATUS,RP1; page 2
080A   1283               M                 bcf STATUS,RP0 
080B   0872               M                 movf Counter,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
080C   008F               M                 movwf EEADRH; adresse en FLASH
080D   0875               M                 movf Counter2,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
080E   008D               M                 movwf EEADR
080F   087E               M                 movf BUFFER_FLASH,W; 1er octet a ecrire (poids faible)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0810   008C               M                 movwf EEDATA
0811   087F               M                 movf BUFFER_FLASH+1,W; 2eme octet a ecrire (poids fort)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0812   008E               M                 movwf EEDATH
0813   1683               M                 bsf STATUS,RP0; page 3
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0814   178C               M                 bsf EECON1,EEPGD; FLASH
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0815   150C               M                 bsf EECON1,WREN; autorise ecriture
0816   3055               M                 movlw 0x55
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0817   008D               M                 movwf EECON2
0818   30AA               M                 movlw 0xAA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0819   008D               M                 movwf EECON2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
081A   148C               M                 bsf EECON1,WR; commence ecriture
081B   0000               M                 nop
081C   0000               M                 nop
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
081D   110C               M                 bcf EECON1,WREN; enleve autorisation ecriture
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 90


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

081E   1283               M                 bcf STATUS,RP0; page 0
081F   1303               M                 bcf STATUS,RP1
0820   01F3           03427                 clrf Value; checkum
0821   01F5           03428                 clrf Counter2; adresse FLASH poids faible
0822   01F2           03429                 clrf Counter; adresse FLASH poids fort
0823   1672           03430                 bsf Counter,4; pages 2-3 (0x1000 - 0x1FFF)              
0824                  03431 Loop_Flash_1
0824   1E8C           03432                                 btfss PIR1,RCIF
0825   2824           03433                                         goto Loop_Flash_1
0826   081A           03434                                 movf RCREG,W
0827   393F           03435                                 andlw 0x3F
0828   00FF           03436                                 movwf BUFFER_FLASH+1; poids fort
0829   07F3           03437                                 addwf Value,F
082A                  03438 Loop_Flash_2
082A   1E8C           03439                                 btfss PIR1,RCIF
082B   282A           03440                                         goto Loop_Flash_2
082C   081A           03441                                 movf RCREG,W
082D   00FE           03442                                 movwf BUFFER_FLASH; poids faible
082E   07F3           03443                                 addwf Value,F
                      03444                                 WRITE_FLASH Counter,Counter2,BUFFER_FLASH; ecriture 2 octets
082F   1703               M                 bsf STATUS,RP1; page 2
0830   1283               M                 bcf STATUS,RP0 
0831   0872               M                 movf Counter,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0832   008F               M                 movwf EEADRH; adresse en FLASH
0833   0875               M                 movf Counter2,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0834   008D               M                 movwf EEADR
0835   087E               M                 movf BUFFER_FLASH,W; 1er octet a ecrire (poids faible)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0836   008C               M                 movwf EEDATA
0837   087F               M                 movf BUFFER_FLASH+1,W; 2eme octet a ecrire (poids fort)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0838   008E               M                 movwf EEDATH
0839   1683               M                 bsf STATUS,RP0; page 3
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
083A   178C               M                 bsf EECON1,EEPGD; FLASH
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
083B   150C               M                 bsf EECON1,WREN; autorise ecriture
083C   3055               M                 movlw 0x55
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
083D   008D               M                 movwf EECON2
083E   30AA               M                 movlw 0xAA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
083F   008D               M                 movwf EECON2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0840   148C               M                 bsf EECON1,WR; commence ecriture
0841   0000               M                 nop
0842   0000               M                 nop
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0843   110C               M                 bcf EECON1,WREN; enleve autorisation ecriture
0844   1283               M                 bcf STATUS,RP0; page 0
0845   1303               M                 bcf STATUS,RP1
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 91


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0846   1D75           03445                                 btfss Counter2,2
0847   1306           03446                                         bcf PORTB,LEDGREEN; allume les deux LEDs
0848   1D75           03447                                 btfss Counter2,2
0849   1386           03448                                         bcf PORTB,LEDYELLOW
084A   1975           03449                                 btfsc Counter2,2
084B   1706           03450                                         bsf PORTB,LEDGREEN; eteint les deux LEDs
084C   1975           03451                                 btfsc Counter2,2
084D   1786           03452                                         bsf PORTB,LEDYELLOW
084E   0AF5           03453                                 incf Counter2,F
084F   1D03           03454                                 btfss STATUS,Z
0850   2824           03455                         goto Loop_Flash_1
0851   0AF2           03456                         incf Counter,F
0852   1EF2           03457                         btfss Counter,5
0853   2824           03458                 goto Loop_Flash_1
0854                  03459 Loop_Flash_3
0854   1E8C           03460                 btfss PIR1,RCIF
0855   2854           03461                         goto Loop_Flash_3
0856   081A           03462                 movf RCREG,W; lecture checksum
0857   0273           03463                 subwf Value,W; checksum
0858   1D03           03464                 btfss STATUS,Z
0859   289A           03465                         goto Fin_Prog_Flag; checksum mauvais                            
085A   01F6           03466                 clrf PARITY; checkum
085B   01F5           03467                 clrf Counter2; adresse FLASH poids faible
085C   01F2           03468                 clrf Counter; adresse FLASH poids fort
085D   1672           03469                 bsf Counter,4; pages 2-3 (0x1000 - 0x1FFF)
085E                  03470 Loop_Flash_4
                      03471                                 READ_FLASH Counter,Counter2,BUFFER_FLASH; lecture 2 octets
085E   1703               M                 bsf STATUS,RP1; page 2
085F   1283               M                 bcf STATUS,RP0;
0860   0872               M                 movf Counter,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0861   008F               M                 movwf EEADRH; adresse en FLASH
0862   0875               M                 movf Counter2,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0863   008D               M                 movwf EEADR
0864   1683               M                 bsf STATUS,RP0; page 3
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0865   178C               M                 bsf EECON1,EEPGD; FLASH
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0866   140C               M                 bsf EECON1,RD; lecture
0867   0000               M                 nop
0868   0000               M                 nop
0869   1283               M                 bcf STATUS,RP0; page 2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
086A   080C               M                 movf EEDATA,W
086B   00FE               M                 movwf BUFFER_FLASH; 1er octet a lire (poids faible)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
086C   080E               M                 movf EEDATH,W
086D   00FF               M                 movwf BUFFER_FLASH+1; 2eme octet a lire (poids fort)
086E   1303               M                 bcf STATUS,RP1; page 0
086F   087F           03472                                 movf BUFFER_FLASH+1,W; poids fort
0870   07F6           03473                                 addwf PARITY,F
0871   087E           03474                                 movf BUFFER_FLASH,W; poids faible
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 92


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0872   07F6           03475                                 addwf PARITY,F
0873   0AF5           03476                                 incf Counter2,F
0874   1D03           03477                                 btfss STATUS,Z
0875   285E           03478                         goto Loop_Flash_4
0876   0AF2           03479                         incf Counter,F
0877   1EF2           03480                         btfss Counter,5
0878   285E           03481                 goto Loop_Flash_4
0879   0876           03482                 movf PARITY,W; lecture checksum
087A   0273           03483                 subwf Value,W; checksum
087B   1D03           03484                 btfss STATUS,Z
087C   289A           03485                         goto Fin_Prog_Flag; checksum mauvais
087D   30FF           03486                 movlw 0xFF
087E   00F5           03487                 movwf Counter2; adresse FLASH poids faible
087F   300F           03488                 movlw 0x0F
0880   00F2           03489                 movwf Counter; adresse FLASH poids fort
0881   01FE           03490                 clrf BUFFER_FLASH
0882   01FF           03491                 clrf BUFFER_FLASH+1
                      03492                 WRITE_FLASH Counter,Counter2,BUFFER_FLASH; ecriture 2 octets => programme OK (0)
0883   1703               M                 bsf STATUS,RP1; page 2
0884   1283               M                 bcf STATUS,RP0 
0885   0872               M                 movf Counter,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0886   008F               M                 movwf EEADRH; adresse en FLASH
0887   0875               M                 movf Counter2,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0888   008D               M                 movwf EEADR
0889   087E               M                 movf BUFFER_FLASH,W; 1er octet a ecrire (poids faible)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
088A   008C               M                 movwf EEDATA
088B   087F               M                 movf BUFFER_FLASH+1,W; 2eme octet a ecrire (poids fort)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
088C   008E               M                 movwf EEDATH
088D   1683               M                 bsf STATUS,RP0; page 3
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
088E   178C               M                 bsf EECON1,EEPGD; FLASH
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
088F   150C               M                 bsf EECON1,WREN; autorise ecriture
0890   3055               M                 movlw 0x55
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0891   008D               M                 movwf EECON2
0892   30AA               M                 movlw 0xAA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0893   008D               M                 movwf EECON2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0894   148C               M                 bsf EECON1,WR; commence ecriture
0895   0000               M                 nop
0896   0000               M                 nop
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0897   110C               M                 bcf EECON1,WREN; enleve autorisation ecriture
0898   1283               M                 bcf STATUS,RP0; page 0
0899   1303               M                 bcf STATUS,RP1
089A                  03493 Fin_Prog_Flag
089A   018A           03494                 clrf PCLATH
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 93


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[306]: Crossing page boundary -- ensure page bits are set.
089B   2801           03495                 goto Reset_Prog
                      03496 
089C                  03497 Start_Flash_2
089C   30A0           03498                 movlw 0xA0; page 3
089D   0084           03499                 movwf FSR
089E                  03500 Init_Page_3
089E   0180           03501                         clrf INDF; initialisation RAM
089F   0A84           03502                         incf FSR,F
08A0   1B84           03503                         btfsc FSR,7
08A1   289E           03504                 goto Init_Page_3
08A2   3020           03505                 movlw 0x20; page 2
08A3   0084           03506                 movwf FSR
08A4   1783           03507                 bsf STATUS,IRP
08A5                  03508 Init_Page_2
08A5   0180           03509                         clrf INDF
08A6   0A84           03510                         incf FSR,F
08A7   1F84           03511                         btfss FSR,7
08A8   28A5           03512                 goto Init_Page_2
08A9   30A0           03513                 movlw 0xA0; page 1
08AA   0084           03514                 movwf FSR
08AB                  03515 Init_Page_1
08AB   0180           03516                         clrf INDF
08AC   0A84           03517                         incf FSR,F
08AD   1B84           03518                         btfsc FSR,7
08AE   28AB           03519                 goto Init_Page_1
08AF   3021           03520                 movlw Status_Boot+1; page 0
08B0   0084           03521                 movwf FSR
08B1   1383           03522                 bcf STATUS,IRP
08B2                  03523 Init_Page_0
08B2   0180           03524                         clrf INDF
08B3   0A84           03525                         incf FSR,F
08B4   1F84           03526                         btfss FSR,7
08B5   28B2           03527                 goto Init_Page_0
08B6   1683           03528                 bsf STATUS,RP0; page 1
08B7   1303           03529                 bcf STATUS,RP1
08B8   30FF           03530                 movlw 0xFF
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
08B9   0087           03531                 movwf TRISC; 8 entrees
08BA   1283           03532                 bcf STATUS,RP0; page 0
08BB   018A           03533                 clrf PCLATH
08BC   01A1           03534                 clrf Info_Boot
08BD   1E07           03535                 btfss PORTC,4; fire joystick 1
Message[306]: Crossing page boundary -- ensure page bits are set.
08BE   2805           03536                         goto Startup; force lancement programme en page page 0
08BF   30FF           03537                 movlw 0xFF
08C0   00F5           03538                 movwf Counter2; adresse FLASH poids faible
08C1   300F           03539                 movlw 0x0F
08C2   00F2           03540                 movwf Counter; adresse FLASH poids fort
08C3   30FF           03541                 movlw 0xFF
                      03542                 READ_FLASH Counter,Counter2,BUFFER_FLASH; lecture 2 octets      
08C4   1703               M                 bsf STATUS,RP1; page 2
08C5   1283               M                 bcf STATUS,RP0;
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 94


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

08C6   0872               M                 movf Counter,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
08C7   008F               M                 movwf EEADRH; adresse en FLASH
08C8   0875               M                 movf Counter2,W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
08C9   008D               M                 movwf EEADR
08CA   1683               M                 bsf STATUS,RP0; page 3
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
08CB   178C               M                 bsf EECON1,EEPGD; FLASH
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
08CC   140C               M                 bsf EECON1,RD; lecture
08CD   0000               M                 nop
08CE   0000               M                 nop
08CF   1283               M                 bcf STATUS,RP0; page 2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
08D0   080C               M                 movf EEDATA,W
08D1   00FE               M                 movwf BUFFER_FLASH; 1er octet a lire (poids faible)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
08D2   080E               M                 movf EEDATH,W
08D3   00FF               M                 movwf BUFFER_FLASH+1; 2eme octet a lire (poids fort)
08D4   1303               M                 bcf STATUS,RP1; page 0
08D5   087E           03543                 movf BUFFER_FLASH,W
08D6   047F           03544                 iorwf BUFFER_FLASH+1,W
08D7   1D03           03545                 btfss STATUS,Z
Message[306]: Crossing page boundary -- ensure page bits are set.
08D8   2805           03546                         goto Startup; lance programme en page page 0 si programme en page 2 invalide (0x
                            1000 - 0x17FF)
08D9   30FF           03547                 movlw 0xFF
08DA   00A1           03548                 movwf Info_Boot
08DB   160A           03549                 bsf PCLATH,4; page 2 (0x1000 - 0x17FF)
Message[306]: Crossing page boundary -- ensure page bits are set.
08DC   2805           03550                 goto Startup; lance programme en page page 2 valide (0x1000 - 0x17FF)
                      03551                  
                      03552 
2100                  03553                 ORG   2100H
2100                  03554 EEProm
                      03555 
                      03556 ;-----------------------------------------------------------------------------
                      03557 ;               Zone EEPROM de stcokage des Scan-Codes Souris
                      03558 ;               Ces codes sont la valeurs par defaut a renvoyer
                      03559 ;-----------------------------------------------------------------------------
2100                  03560 Tab_Scan_Codes
2100   0000           03561                 DE 0x00; offset + 0x00  jamais utilise: "Error or Buffer Overflow"
2101   0000           03562                 DE 0x00; offset + 0x01  jamais utilise
2102   0000           03563                 DE 0x00; offset + 0x02  jamais utilise
2103   0000           03564                 DE 0x00; offset + 0x03  jamais utilise
2104   0000           03565                 DE 0x00; offset + 0x04  jamais utilise
2105   0000           03566                 DE 0x00; offset + 0x05  jamais utilise
2106   0000           03567                 DE 0x00; offset + 0x06  jamais utilise
2107   003B           03568                 DE 0x3B; offset + 0x07 F1
2108   0001           03569                 DE 0x01; offset + 0x08 ESC
2109   0000           03570                 DE 0x00; offset + 0x09  jamais utilise
210A   0000           03571                 DE 0x00; offset + 0x0A  jamais utilise
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 95


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

210B   0000           03572                 DE 0x00; offset + 0x0B  jamais utilise
210C   0000           03573                 DE 0x00; offset + 0x0C  jamais utilise
210D   000F           03574                 DE 0x0F; offset + 0x0D TABULATION
210E   005B           03575                 DE DEF_RUSSE; offset + 0x0E touche 2 ( a cote de & )
210F   003C           03576                 DE 0x3C; offset + 0x0F F2
2110   0000           03577                 DE 0x00; offset + 0x10  jamais utilise
2111   001D           03578                 DE 0x1D; offset + 0x11 LEFT CTRL (Atari en n'a qu'un)
2112   002A           03579                 DE 0x2A; offset + 0x12 LEFT SHFT
2113   0060           03580                 DE 0x60; offset + 0x13 ><
2114   003A           03581                 DE 0x3A; offset + 0x14 CAPS
2115   0010           03582                 DE 0x10; offset + 0x15 A (lettre)
2116   0002           03583                 DE 0x02; offset + 0x16 1 (chiffre UN )
2117   003D           03584                 DE 0x3D; offset + 0x17 F3
2118   0000           03585                 DE 0x00; offset + 0x18  jamais utilise
2119   0038           03586                 DE DEF_ALTGR; offset + 0x19 LEFT ALT (Atari en n'a qu'un)
211A   002C           03587                 DE 0x2C; offset + 0x1A W
211B   001F           03588                 DE 0x1F; offset + 0x1B S
211C   001E           03589                 DE 0x1E; offset + 0x1C Q
211D   0011           03590                 DE 0x11; offset + 0x1D Z
211E   0003           03591                 DE 0x03; offset + 0x1E 2
211F   003E           03592                 DE 0x3E; offset + 0x1F F4
2120   0000           03593                 DE 0x00; offset + 0x20  jamais utilise
2121   002E           03594                 DE 0x2E; offset + 0x21 C
2122   002D           03595                 DE 0x2D; offset + 0x22 X
2123   0020           03596                 DE 0x20; offset + 0x23 D
2124   0012           03597                 DE 0x12; offset + 0x24 E
2125   0005           03598                 DE 0x05; offset + 0x25 4
2126   0004           03599                 DE 0x04; offset + 0x26 3
2127   003F           03600                 DE 0x3F; offset + 0x27 F5
2128   0000           03601                 DE 0x00; offset + 0x28  jamais utilise
2129   0039           03602                 DE 0x39; offset + 0x29 SPACE BAR
212A   002F           03603                 DE 0x2F; offset + 0x2A V
212B   0021           03604                 DE 0x21; offset + 0x2B  jamais utilise
212C   0014           03605                 DE 0x14; offset + 0x2C T
212D   0013           03606                 DE 0x13; offset + 0x2D R
212E   0006           03607                 DE 0x06; offset + 0x2E 5
212F   0040           03608                 DE 0x40; offset + 0x2F F6
2130   0000           03609                 DE 0x00; offset + 0x30  jamais utilise
2131   0031           03610                 DE 0x31; offset + 0x31 N
2132   0030           03611                 DE 0x30; offset + 0x32 B
2133   0023           03612                 DE 0x23; offset + 0x33 H
2134   0022           03613                 DE 0x22; offset + 0x34 G
2135   0015           03614                 DE 0x15; offset + 0x35 Y
2136   0007           03615                 DE 0x07; offset + 0x36 6
2137   0041           03616                 DE 0x41; offset + 0x37 F7
2138   0000           03617                 DE 0x00; offset + 0x38  jamais utilise
2139   0038           03618                 DE DEF_ALTGR; offset + 0x39 RIGHT ALT GR (Atari en n'a qu'un)
213A   0032           03619                 DE 0x32; offset + 0x3A <?><,>
213B   0024           03620                 DE 0x24; offset + 0x3B J
213C   0016           03621                 DE 0x16; offset + 0x3C U
213D   0008           03622                 DE 0x08; offset + 0x3D 7
213E   0009           03623                 DE 0x09; offset + 0x3E 8
213F   0042           03624                 DE 0x42; offset + 0x3F F8
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 96


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

2140   0000           03625                 DE 0x00; offset + 0x40  jamais utilise
2141   0033           03626                 DE 0x33; offset + 0x41 <.><;>
2142   0025           03627                 DE 0x25; offset + 0x42 K
2143   0017           03628                 DE 0x17; offset + 0x43 I
2144   0018           03629                 DE 0x18; offset + 0x44 O (lettre O )
2145   000B           03630                 DE 0x0B; offset + 0x45 0 (chiffre ZERO )
2146   000A           03631                 DE 0x0A; offset + 0x46  jamais utilise
2147   0043           03632                 DE 0x43; offset + 0x47 F9
2148   0000           03633                 DE 0x00; offset + 0x48  jamais utilise
2149   0034           03634                 DE 0x34; offset + 0x49 </><:>
214A   0035           03635                 DE 0x35; offset + 0x4A <!><>
214B   0026           03636                 DE 0x26; offset + 0x4B L
214C   0027           03637                 DE 0x27; offset + 0x4C M
214D   0019           03638                 DE 0x19; offset + 0x4D P
214E   000C           03639                 DE 0x0C; offset + 0x4E <><)>
214F   0044           03640                 DE 0x44; offset + 0x4F F10
2150   0000           03641                 DE 0x00; offset + 0x50  jamais utilise
2151   0000           03642                 DE 0x00; offset + 0x51  jamais utilise
2152   0028           03643                 DE 0x28; offset + 0x52 <%><>
2153   002B           03644                 DE 0x2B; offset + 0x53 <><*> touche sur COMPAQ
2154   001A           03645                 DE 0x1A; offset + 0x54 <><^>
2155   000D           03646                 DE 0x0D; offset + 0x55 <+><=>
2156   0062           03647                 DE 0x62; offset + 0x56 F11          <= HELP ATARI (Fr)
2157   0049           03648                 DE DEF_PRINTSCREEN; offset + 0x57 PRINT SCREEN
2158   001D           03649                 DE 0x1D; offset + 0x58 RIGHT CTRL   (Atari en n'a qu'un)
2159   0036           03650                 DE 0x36; offset + 0x59 RIGHT SHIFT
215A   001C           03651                 DE 0x1C; offset + 0x5A RETURN
215B   001B           03652                 DE 0x1B; offset + 0x5B <><$>
215C   002B           03653                 DE 0x2B; offset + 0x5C <><*> touche sur SOFT KEY
215D   0000           03654                 DE 0x00; offset + 0x5D  jamais utilise
215E   0061           03655                 DE DEF_F12; offset + 0x5E F12          <= UNDO ATARI (Fr)
215F   004C           03656                 DE DEF_SCROLL; offset + 0x5F SCROLL
2160   0050           03657                 DE 0x50; offset + 0x60 DOWN ARROW
2161   004B           03658                 DE 0x4B; offset + 0x61 LEFT ARROW
2162   004F           03659                 DE DEF_PAUSE; offset + 0x62 PAUSE
2163   0048           03660                 DE 0x48; offset + 0x63 UP ARROW
2164   0053           03661                 DE 0x53; offset + 0x64 DELETE
2165   0055           03662                 DE 0x55; offset + 0x65 END
2166   000E           03663                 DE 0x0E; offset + 0x66 BACKSPACE
2167   0052           03664                 DE 0x52; offset + 0x67 INSERT
2168   0000           03665                 DE 0x00; offset + 0x68  jamais utilise
2169   006D           03666                 DE 0x6D; offset + 0x69 KP 1 (UN)
216A   004D           03667                 DE 0x4D; offset + 0x6A RIGHT ARROW
216B   006A           03668                 DE 0x6A; offset + 0x6B KP 4
216C   0067           03669                 DE 0x67; offset + 0x6C KP 7
216D   0046           03670                 DE DEF_PAGEDN; offset + 0x6D PAGE DOWN    (unused on Atari before)
216E   0047           03671                 DE 0x47; offset + 0x6E CLEAR HOME
216F   0045           03672                 DE DEF_PAGEUP; offset + 0x6F PAGE UP      (unused on Atari before)
2170   0070           03673                 DE 0x70; offset + 0x70 KP 0 (ZERO)
2171   0071           03674                 DE 0x71; offset + 0x71  jamais utilise
2172   006E           03675                 DE 0x6E; offset + 0x72 KP 2
2173   006B           03676                 DE 0x6B; offset + 0x73 KP 5
2174   006C           03677                 DE 0x6C; offset + 0x74 KP 6
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 97


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

2175   0068           03678                 DE 0x68; offset + 0x75 KP 8
2176   0054           03679                 DE DEF_VERRNUM; offset + 0x76 VERR NUM     (unused on Atari before)
2177   0065           03680                 DE 0x65; offset + 0x77 KP /
2178   0000           03681                 DE 0x00; offset + 0x78  jamais utilise
2179   0072           03682                 DE 0x72; offset + 0x79 KP ENTER
217A   006F           03683                 DE 0x6F; offset + 0x7A KP 3
217B   0000           03684                 DE 0x00; offset + 0x7B  jamais utilise
217C   004E           03685                 DE 0x4E; offset + 0x7C KP +
217D   0069           03686                 DE 0x69; offset + 0x7D KP 9
217E   0066           03687                 DE 0x66; offset + 0x7E KP *
217F   0000           03688                 DE 0x00; offset + 0x7F  jamais utilise
2180   0000           03689                 DE 0x00; offset + 0x80  jamais utilise
2181   0000           03690                 DE 0x00; offset + 0x81  jamais utilise
2182   0000           03691                 DE 0x00; offset + 0x82  jamais utilise
2183   0000           03692                 DE 0x00; offset + 0x83  jamais utilise
2184   004A           03693                 DE 0x4A; offset + 0x84 KP . (POINT)
2185   0000           03694                 DE 0x00; offset + 0x85  jamais utilise
2186   0000           03695                 DE 0x00; offset + 0x86  jamais utilise
2187   0000           03696                 DE 0x00; offset + 0x87  jamais utilise
2188   0000           03697                 DE 0x00; offset + 0x88  jamais utilise
2189   0000           03698                 DE 0x00; offset + 0x89  jamais utilise
218A   0000           03699                 DE 0x00; offset + 0x8A  jamais utilise
218B   0056           03700                 DE DEF_WINLEFT;  offset + 0x8B LEFT WIN
218C   0057           03701                 DE DEF_WINRIGHT; offset + 0x8C RIGHT WIN
218D   0058           03702                 DE DEF_WINAPP;   offset + 0x8D POPUP WIN
218E   0000           03703                 DE 0x00; offset + 0x8E  jamais utilise
218F   0000           03704                 DE 0x00; offset + 0x8F  jamais utilise
                      03705 ;-----------------------------------------------------------------------------
2190                  03706 Tab_Mouse
2190   0059           03707                 DE DEF_WHEELUP; offset + 0x90 AT_WHEELUP     Eiffel 1.0.0
2191   005A           03708                 DE DEF_WHEELDN; offset + 0x91 AT_WHEELDOWN   Eiffel 1.0.1 ( v1.0.0 retournait 0x60 )
2192   005C           03709                 DE DEF_WHEELLT; offset + 0x92 AT_WHEELLEFT   Eiffel 1.0.3 seulement
2193   005D           03710                 DE DEF_WHEELRT; offset + 0x93 AT_WHEELRIGHT  Eiffel 1.0.3 seulement
2194   0037           03711                 DE DEF_BUTTON3; offset + 0x94 AT_BUTTON3     Eiffel 1.0.3 scan-code bouton 3 Central
2195   005E           03712                 DE DEF_BUTTON4; offset + 0x95 AT_BUTTON4     Eiffel 1.0.3 scan-code bouton 4
2196   005F           03713                 DE DEF_BUTTON5; offset + 0x96 AT_BUTTON5     Eiffel 1.0.3 scan-code bouton 5
2197   0003           03714                 DE DEF_WHREPEAT; offset + 0x97 ADR_WHEELREPEAT Eiffel 1.0.3 Nombre de repetition
                      03715 
2198   0045 0069 0066 03716                 DE "Eiffel 2"
       0066 0065 006C 
       0020 0032 
21A0   0046 0041 0056 03717                 DE "FAVARD L"
       0041 0052 0044 
       0020 004C 
                      03718 ;-----------------------------------------------------------------------------
21A8                  03719 Tab_Temp
21A8   0028           03720                 DE 40; seuil maxi de temperature     Eiffel 1.0.4
21A9   0023           03721                 DE 35; seuil mini de temperature     Eiffel 1.0.4
21AA   00B4           03722                 DE 180; valeur AN0 pour 0 degres     Eiffel 1.0.4
21AB   001C           03723                 DE 28; facteur d'echelle temperature Eiffel 1.0.4
                      03724 ;-----------------------------------------------------------------------------
                      03725                 
                      03726                 END
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 98


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
AT_LEFT                           1
AT_MOUSE                          0xF8
AT_RIGHT                          0
AT_SIGN                           7
AT_WHEELNOT                       0x00
BAUD_7812_5                       0000001F
BAUD_9600                         00000019
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BIT_UN                            00000080
BIT_ZERO                          00000000
BREAK_CODE                        00000004
BRGH                              00000002
BUFFER_FLASH                      0000007E
BUTTONS                           00000023
BUTTON_ACTION                     0000007D
Bank0                             
Bank1                             
Bank2                             
Bank3                             
Buttons45                         0000061F
C                                 00000000
CAPS_LOCK                         00000000
CAPS_OFF                          00000002
CAPS_ON                           00000006
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 99


SYMBOL TABLE
  LABEL                             VALUE 

CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CKE                               00000006
CKP                               00000004
CLIC_MOUSE_WHEEL                  00000043
CMD_BAT                           0xAA
CMD_ENABLE                        0xF4
CMD_GETDEVID                      0xF2
CMD_LED                           0xED
CMD_MKBRK                         0xF8
CMD_RELEASED                      0xF0
CMD_SET                           0xF0
CMD_SETSMPRT                      0xF3
CMD_STTPMTRATE                    0xF3
CMD_TMMKBRK                       0xFA
CPS_30                            20
CREN                              00000004
CSRC                              00000007
CapsLock                          0000068D
CapsToOn                          00000691
Change_0_To_1                     00000466
CheckG                            
CheckY                            
Compteurs_Mouse                   000003A7
Conv_BCD_Time                     000009AB
Conv_Inv_BCD_Time                 00000989
Conv_Inv_Scale_X                  00000928
Conv_Inv_Scale_Y                  00000935
Conv_Not_Scaled                   0000017C
Conv_Scale_X                      00000942
Conv_Scale_Y                      0000094D
Counter                           00000072
Counter2                          00000075
Counter3                          0000004D
Counter_100MS_Joy                 0000004F
Counter_10MS_Joy                  0000004E
Counter_10MS_Joy_Monitor          0000004C
Counter_5MS                       0000004B
Counter_Mouse                     00000048
D                                 00000005
DATATOSEND                        00000005
DATA_ADDRESS                      00000005
DAY                               00000112
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 100


SYMBOL TABLE
  LABEL                             VALUE 

DAY_BCD                           0000003C
DC                                00000001
DEBUG_CODE                        00000000
DEB_INDEX_EM                      00000038
DEFAULT_DISABLE                   000000F5
DEF_ALTGR                         00000038
DEF_BUTTON3                       00000037
DEF_BUTTON4                       0000005E
DEF_BUTTON5                       0000005F
DEF_END                           00000055
DEF_F11                           00000062
DEF_F12                           00000061
DEF_PAGEDN                        00000046
DEF_PAGEUP                        00000045
DEF_PAUSE                         0000004F
DEF_PRINTSCREEN                   00000049
DEF_RUSSE                         0000005B
DEF_SCROLL                        0000004C
DEF_VERRNUM                       00000054
DEF_WHEELDN                       0000005A
DEF_WHEELLT                       0000005C
DEF_WHEELRT                       0000005D
DEF_WHEELUP                       00000059
DEF_WHREPEAT                      00000003
DEF_WINAPP                        00000058
DEF_WINLEFT                       00000056
DEF_WINRIGHT                      00000057
DELTA_X                           0000006E
DELTA_Y                           0000006F
DISABLEKEYB                       
DISABLEMOUSE                      
DISABLEPS2                        
DISABLE_DATA_REPORTING            000000F5
D_A                               00000005
Days_In_Month                     00000006
Delay                             
Delay_Routine                     00000754
Delay_TX_D                        000005BC
Delay_TX_G                        0000059E
Delay_TY_B                        00000580
Delay_TY_H                        00000562
Dep_Max_X                         000003C8
Dep_Max_Y                         000003F6
Dep_Min_X                         000003D0
Dep_Min_Y                         000003FE
Div_1608                          00000958
Dump_EEProm                       00000259
Dump_Flash                        00000260
ECHO                              000000EE
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 101


SYMBOL TABLE
  LABEL                             VALUE 

EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
EEProm                            00002100
ENABLE                            000000F4
ENABLEKEYB                        
ENABLEMOUSE                       
ENABLEPS2                         
ENABLE_DATA_REPORTING             000000F4
Ecriture_Flash                    00000801
EnableMouse                       00000024
End_B                             00000570
End_D                             000005AC
End_Env_Status                    00000336
End_G                             0000058E
End_H                             00000552
End_INC_Clock                     000004CC
End_Read                          0000027D
End_SerialTransmit                00000923
Env_Action                        0000044D
Error_Keyboard                    0000033E
Error_Mouse                       0000035D
Error_Parity_Keyboard             00000340
Error_Parity_Mouse                0000035F
Exit_BCD                          000009B9
F                                 00000001
FERR                              00000002
FIN_INDEX_EM                      00000039
FSR                               00000004
Fin_Prog_Flag                     0000089A
First_Byte                        00000381
Fourth_Byte                       00000394
GCEN                              00000007
GET_DEVICE_ID                     000000F2
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
HEADER_ABSOLUTE_MOUSE             000000F7
HEADER_IKBD                       00000040
HEADER_JOYSTICK0                  000000FE
HEADER_JOYSTICK1                  000000FF
HEADER_JOYSTICKS                  000000FD
HEADER_RELATIVE_MOUSE             000000F8
HEADER_STATUS                     000000F6
HEADER_TIME_OF_DAY                000000FC
HRS                               00000113
HRS_BCD                           0000003D
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 102


SYMBOL TABLE
  LABEL                             VALUE 

IDX_ALTGR                         00000039
IDX_BUTTON3                       00000004
IDX_BUTTON4                       00000005
IDX_BUTTON5                       00000006
IDX_END                           00000065
IDX_F11                           00000056
IDX_F12                           0000005E
IDX_LEVELHTEMP                    00000000
IDX_LEVELLTEMP                    00000001
IDX_PAGEDN                        0000006D
IDX_PAGEUP                        0000006F
IDX_PAUSE                         00000062
IDX_PRNTSCREEN                    00000057
IDX_RUSSE                         0000000E
IDX_SCALETEMP                     00000003
IDX_SCROLL                        0000005F
IDX_T0_AN0                        00000002
IDX_VERRN                         00000076
IDX_WAPP                          0000008D
IDX_WHEELDN                       00000001
IDX_WHEELLT                       00000002
IDX_WHEELRT                       00000003
IDX_WHEELUP                       00000000
IDX_WHREPEAT                      00000007
IDX_WLEFT                         0000008B
IDX_WRIGHT                        0000008C
IKBD_ABS_MOUSE_POSITIONING        00000009
IKBD_CONTROLLER_EXECUTE           00000022
IKBD_ENABLE                       00000007
IKBD_GETTEMP                      00000003
IKBD_INTERROGATE_MOUSE_POS        0000000D
IKBD_INTERROG_TIME_OF_DAY         0000001C
IKBD_JOY_INTERROG                 00000016
IKBD_LOAD_MOUSE_POS               0000000E
IKBD_MEMORY_LOAD                  00000020
IKBD_MEMORY_READ                  00000021
IKBD_PROGKB                       00000005
IKBD_PROGMS                       00000006
IKBD_PROGTEMP                     00000004
IKBD_REL_MOUSE_POS_REPORT         00000008
IKBD_RESET                        00000080
IKBD_SET_FIRE_BUTTON_MONITOR      00000018
IKBD_SET_JOY_EVNT_REPORT          00000014
IKBD_SET_JOY_INTERROG_MODE        00000015
IKBD_SET_JOY_KEYCODE_MODE         00000019
IKBD_SET_JOY_MONITOR              00000017
IKBD_SET_MOUSE_BUTTON_ACTION      00000007
IKBD_SET_MOUSE_KEYCODE_CODE       0000000A
IKBD_SET_MOUSE_SCALE              0000000C
IKBD_SET_MOUSE_THRESHOLD          0000000B
IKBD_SET_Y0_AT_BOTTOM             0000000F
IKBD_SET_Y0_AT_TOP                00000010
IKBD_STATUS_JOY_MODE_E            00000094
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 103


SYMBOL TABLE
  LABEL                             VALUE 

IKBD_STATUS_JOY_MODE_I            00000095
IKBD_STATUS_JOY_MODE_K            00000099
IKBD_STATUS_MOUSE_BUT_ACTION      00000087
IKBD_STATUS_MOUSE_MODE_A          00000089
IKBD_STATUS_MOUSE_MODE_K          0000008A
IKBD_STATUS_MOUSE_MODE_R          00000088
IKBD_STATUS_MOUSE_SCALE           0000008C
IKBD_STATUS_MOUSE_THRESHOLD       0000008B
IKBD_STATUS_MOUSE_Y0_AT_B         0000008F
IKBD_STATUS_MOUSE_Y0_AT_T         00000090
IKBD_TIME_OF_DAY_CLOCK_SET        0000001B
IKDB_DISABLE_JOYSTICKS            0000001A
IKDB_DISABLE_MOUSE                00000012
IKDB_PAUSE_OUTPUT                 00000013
IKDB_RESUME                       00000011
IKDB_STATUS_DISABLE_JOY           0000009A
IKDB_STATUS_DISABLE_MOUSE         00000092
INC_Clock                         0000049F
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
Info_Boot                         00000021
Init                              000009C8
Init_Conv_BCD_Time                00000982
Init_MyStatus                     0000029E
Init_Page_0                       000008B2
Init_Page_1                       000008AB
Init_Page_2                       000008A5
Init_Page_3                       0000089E
Init_X_Abs                        00000470
Init_X_Y_Abs                      0000046A
Init_Y_Abs                        0000046B
Inter                             00000004
JOY0                              00000026
JOY1                              00000027
JOYB                              00000026
JOY_ENABLE                        00000006
JOY_EVENT                         00000002
JOY_KEYS                          00000001
JOY_MONITOR                       00000003
JUMPER4                           00000004
JUMPER5                           00000005
Joy_Mode                          00000316
Joy_Mode_Keys                     0000031E
Joy_Monitoring                    000000A5
KCLOCK                            00000001
KDATA                             00000000
KEY2_MOUSE_WHEEL                  00000042
KEY_CAPSLOCK                      0000003A
KEY_MOUSE_WHEEL                   00000041
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 104


SYMBOL TABLE
  LABEL                             VALUE 

KGetLoop                          000006BE
KM_DISABLE                        00000035
KPS2cmd                           000006D6
KPS2cmdBit                        000006F9
KPS2cmdLoop                       000006EA
KPSCmd                            000006B6
KPSGet                            000006B7
KPSGet2                           000006B9
KPSGetBit                         000006CE
LEDGREEN                          00000006
LEDS_OFF                          00000000
LEDS_ON                           00000007
LEDYELLOW                         00000007
LED_CAP                           00000004
LED_NUM                           00000002
LED_SCROLL                        00000001
Lecture_EEProm                    00000758
Leds_Eiffel_Off                   00000765
Leds_Eiffel_On                    00000762
Loop_BCD                          000009B2
Loop_BCD_Time                     0000098A
Loop_Dump_Flash                   00000263
Loop_Dump_Ram                     00000251
Loop_Env_Time                     000004D8
Loop_Flash_1                      00000824
Loop_Flash_2                      0000082A
Loop_Flash_3                      00000854
Loop_Flash_4                      0000085E
Loop_Get_Time                     000001F8
Loop_Inv_Scale_X                  0000092C
Loop_Inv_Scale_Y                  00000939
Loop_Load                         0000021B
Loop_Moins_H                      000005DF
Loop_Moins_V                      000005F4
Loop_Mouse_Enable                 0000014D
Loop_Plus_H                       000005D8
Loop_Plus_V                       000005EA
Loop_Scale2_Temp                  00000490
Loop_Scale_Temp                   00000486
Loop_SerialTransmit_Status        00000339
Loop_Time_BCD                     000009AC
MAX_VALUE_LOOKUP                  0000008F
MCLOCK                            00000003
MDATA                             00000002
MGetLoop                          0000070D
MIN                               00000114
MIN_BCD                           0000003E
MONTH                             00000111
MONTH_BCD                         0000003B
MOTORON                           00000005
MOUSE_ABS                         00000003
MOUSE_ENABLE                      00000005
MOUSE_KEYS                        00000000
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 105


SYMBOL TABLE
  LABEL                             VALUE 

MPS2cmd                           00000725
MPS2cmdBit                        00000748
MPS2cmdLoop                       00000739
MPSCmd                            00000705
MPSGet                            00000706
MPSGet2                           00000708
MPSGetBit                         0000071D
MSWHEEL                           00000001
MSWHEELPLUS                       00000002
MS_PS2                            0x00
MS_WHEEL                          0x03
MS_WHEELPLUS                      0x04
Main                              0000001C
Main_Loop                         00000027
ModeKeyAtari                      00000350
ModeMsAtari                       00000373
Mouse_Mode                        000002BC
Mouse_Mode_Abs                    000002C4
Mouse_Mode_Keys                   000002D1
Mouse_Vert                        000002FA
MyStatus                          00000078
MyStatus2                         00000079
MyStatus3                         0000007A
NON_BLOQUANT                      00000000
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
Normal_Mouse                      00000396
Not_100MS                         0000008B
Not_Abs_Mouse                     00000140
Not_Action_0                      0000043D
Not_Action_1                      00000453
Not_B                             00000527
Not_B2                            00000585
Not_B3                            00000573
Not_B4                            0000057B
Not_BatMouse                      00000373
Not_BreakCode                     00000356
Not_ButAct0                       000004F2
Not_ButAct1                       000004FC
Not_Change_0                      0000062F
Not_Change_1                      00000638
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 106


SYMBOL TABLE
  LABEL                             VALUE 

Not_Change_A                      00000436
Not_Change_B                      00000446
Not_Change_C                      00000609
Not_Clic_Mouse                    00000612
Not_D                             00000549
Not_D2                            000005C1
Not_D3                            000005AF
Not_D4                            000005B7
Not_Disable_Joysticks             000001EF
Not_Disable_Mouse                 00000198
Not_Execute                       00000286
Not_Fire_Button                   000001D2
Not_G                             00000538
Not_G2                            000005A3
Not_G3                            00000591
Not_G4                            00000599
Not_Get_Temp                      000000E2
Not_H                             00000516
Not_H2                            00000567
Not_H3                            00000555
Not_H4                            0000055D
Not_Interrog_Time                 0000020A
Not_Inv_Y                         000003D8
Not_Joy0                          000004F6
Not_Joy01                         000004E8
Not_Joy0_Change                   00000097
Not_Joy_Interrog                  000001C2
Not_Joy_KeyCode                   000001E9
Not_Joy_Mode                      0000032D
Not_Joy_Monitor                   000001CD
Not_Joy_Off                       000001AE
Not_Joy_On                        000001A6
Not_Key_Mouse_H                   000005E6
Not_Keys_Mouse                    000005FE
Not_Load                          0000022B
Not_Load_Mouse_Pos                00000181
Not_Max_X                         000003D1
Not_Max_Y                         000003FF
Not_Memory_Load                   00000238
Not_Memory_Read                   0000027F
Not_Mouse_Action                  000002B0
Not_Mouse_Enable                  0000030A
Not_Mouse_KeyCode                 0000014F
Not_Mouse_Mode                    000002D7
Not_Mouse_Pos                     0000016F
Not_Mouse_Scale                   00000161
Not_Mouse_Threshold               00000156
Not_Mouse_Vert                    00000300
Not_Page_0                        00000220
Not_Pause                         0000019E
Not_ProgKB                        00000122
Not_Prog_EEProm                   00000120
Not_Prog_Mouse                    000000FB
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 107


SYMBOL TABLE
  LABEL                             VALUE 

Not_Prog_Temp                     000000EE
Not_Read_Temp                     000004A4
Not_Rel_Mouse                     00000130
Not_Reset                         000002A3
Not_Resume                        00000192
Not_Scale                         000002F2
Not_SendKey                       0000035B
Not_Set_Mouse_Button_Action       00000129
Not_Threshold                     000002E3
Not_Time_Set                      00000202
Not_Y0_At_Bottom                  00000187
Not_Y0_At_Top                     0000018D
Not_trame_Rel                     000005D2
OERR                              00000001
OLD_BUTTONS                       00000024
OLD_BUTTONS_ABS                   00000025
OLD_JOY                           00000057
OPTION_REG                        00000081
OnKbBAT                           00000457
OnMsBAT                           0000045F
P                                 00000004
PARITY                            00000076
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PC_BITLSBZ                        0
PC_BUTTON4                        4
PC_BUTTON5                        5
PC_LEFT                           0
PC_MIDDLE                         2
PC_RIGHT                          1
PC_SIGNX                          4
PC_SIGNY                          5
PC_SIGNZ                          3
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
POWERUP_KEYB                      00000006
POWERUP_MOUSE                     00000007
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 108


SYMBOL TABLE
  LABEL                             VALUE 

PS2_ALTERNE                       00000001
PSA                               00000003
Pb_Trame_Mouse                    00000389
Prochain_Bouton                   00000422
Prog_EEProm                       00000107
Prog_Flash                        00000231
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RDEEPROM                          
RDEEPROM2                         
READ_DATA                         000000EB
READ_FLASH                        
READ_ID                           000000F2
READ_WRITE                        00000002
RESEND                            000000FE
RESET                             000000FF
RESET_KEYB                        00000006
RESET_MOUSE                       00000007
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 109


SYMBOL TABLE
  LABEL                             VALUE 

RX_D                              00000003
RX_G                              00000002
RX_JOY                            00000050
RY_B                              00000001
RY_H                              00000000
RY_JOY                            00000051
R_W                               00000002
Rate_Joy                          0000004A
Read_Temp                         00000475
Repeat                            00000619
Reset_Prog                        00000001
Roulettes                         00000616
S                                 00000003
SCANCODESET3                      0x03
SCROOL_LOCK_ERR                   00000000
SEC                               00000115
SEC_BCD                           0000003F
SEN                               00000000
SET_ALL_KEYS_MAKE                 000000F9
SET_ALL_KEYS_MAKE_BREAK           000000F8
SET_ALL_KEYS_TYPEMATIC            000000F7
SET_ALL_KEYS_TYP_MAKE_BRK         000000FA
SET_DEFAULT                       000000F6
SET_DEFAULTS                      000000F6
SET_KEY_MAKE_BREAK                000000FC
SET_KEY_TYPE_MAKE                 000000FD
SET_KEY_TYPE_TYPEMATIC            000000FB
SET_REMOTE_MODE                   000000F0
SET_RESET_LEDS                    000000ED
SET_SAMPLE_RATE                   000000F3
SET_SCAN_CODE_SET                 000000F0
SET_STREAM_MODE                   000000EA
SET_TYPEMATIC_RATE_DELAY          000000F3
SET_WRAP_MODE                     000000EE
SIGN_Y                            00000004
SMP                               00000007
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
START_RX_JOY                      00000058
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 110


SYMBOL TABLE
  LABEL                             VALUE 

START_RY_JOY                      00000059
START_TX_JOY                      0000005A
START_TY_JOY                      0000005B
STATUS                            00000003
STATUS_REQUEST                    000000E9
SYNC                              00000004
Second_Byte                       0000038B
SendAtariClock                    000004CE
SendAtariJoysticks                000004DE
SendAtariJoysticks_Fleches        00000505
SendAtariKeyboard                 00000664
SendAtariMouse                    000005C4
SendAtariMouse_Abs                00000623
SendData                          0000004B
Send_End_Status                   000002EE
SerialReceive                     00000678
SerialTransmit                    00000900
SerialTransmit_Bas                00000683
SerialTransmit_Droite             00000687
SerialTransmit_Gauche             00000685
SerialTransmit_Haut               00000681
SerialTransmit_Host               0000067D
SerialTransmit_Host_Joy           000004FF
SerialTransmit_Joy                000000A0
SerialTransmit_KeyUpDown          00000688
Start_Flash                       00000800
Start_Flash_2                     0000089C
Startup                           00000005
Startup2                          00000017
Status_Boot                       00000020
Status_Joy                        00000056
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TAILLE_TAMPON_EM                  00000010
TAMPON_EM                         00000028
TEMP1                             00000074
TEMP2                             00000077
TEMP3                             0000007B
TEMP4                             0000007C
TEMP5                             00000070
TEMP6                             00000071
TMR0                              00000001
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 111


SYMBOL TABLE
  LABEL                             VALUE 

TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISB                             00000086
TRISC                             00000087
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
TX_D                              00000007
TX_G                              00000006
TX_JOY                            00000052
TY_B                              00000005
TY_H                              00000004
TY_JOY                            00000053
Tab_Mouse                         00002190
Tab_Scan_Codes                    00002100
Tab_Temp                          000021A8
Temp                              00000049
Third_Byte                        0000038E
TransmitHost                      00000427
TryWheel                          00000644
TryWheelPlus                      00000654
TstAtariReceive                   00000059
TstAtariSend                      0000003B
TstClock                          00000076
TstMouse                          00000033
TstResetKeyb                      00000071
TstTimer                          00000063
TxReg_Full                        0000090D
UA                                00000001
UDIV1608L                         
UpdateLedOnOff                    00000692
VERSION                           00000068
VX_JOY                            00000054
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 112


SYMBOL TABLE
  LABEL                             VALUE 

VY_JOY                            00000055
Val_AN0                           00000022
Value                             00000073
Value_0                           00000044
Value_X                           00000045
Value_Y                           00000046
Value_Z                           00000047
W                                 00000000
WAIT_KCLOCK_H                     
WAIT_KCLOCK_L                     
WAIT_MCLOCK_H                     
WAIT_MCLOCK_L                     
WCOL                              00000007
WR                                00000001
WREEPROM                          
WREN                              00000002
WRERR                             00000003
WRITE_FLASH                       
XCompl                            000003C2
X_INC_KEY                         0000006C
X_MAX_POSH                        00000066
X_MAX_POSL                        00000067
X_MOV                             0000006A
X_POSH                            0000005E
X_POSH_SCALED                     00000062
X_POSL                            0000005F
X_POSL_SCALED                     00000063
X_SCALE                           0000005C
YCompl                            000003F0
YEAR                              00000110
YEAR_BCD                          0000003A
Y_INC_KEY                         0000006D
Y_MAX_POSH                        00000068
Y_MAX_POSL                        00000069
Y_MOV                             0000006B
Y_POSH                            00000060
Y_POSH_SCALED                     00000064
Y_POSL                            00000061
Y_POSL_SCALED                     00000065
Y_SCALE                           0000005D
Z                                 00000002
ZDroit                            00000417
ZGauche                           0000040D
ZNegatif                          00000411
ZZero                             0000041A
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00000FCF
_CP_HALF                          00001FDF
_CP_OFF                           00003FFF
_CP_UPPER_256                     00002FEF
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 113


SYMBOL TABLE
  LABEL                             VALUE 

_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_HS_OSC                           00003FFE
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_ENABLE_OFF                   00003DFF
_WRT_ENABLE_ON                    00003FFF
_XT_OSC                           00003FFD
__16F876                          00000001
cmdDisableKey                     000006A7
cmdDisableMouse                   000006AF
cmdEnableKey                      000006A5
cmdEnableMous                     000006AD
cmdLedOnOff                       00000698
cmdMakeBreak                      00000696
cmdResendKey                      000006A3
cmdResendMouse                    000006AB
cmdResetKey                       000006A1
cmdResetMouse                     000006A9
cmdScanSet3                       0000069D
cmdSetSmpRate                     000006B1
doAtariCommand                    000000C7
doKeyboard                        00000342
doMouse                           00000362
doTimer                           00000065


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
01C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
MPASM 02.50 Released           EIFFEL.ASM   9-21-2002  15:57:43         PAGE 114


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


02C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
03C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0480 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
04C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0500 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0540 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0580 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
05C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0600 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0640 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0680 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
06C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0700 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0740 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXX-------- ----------------
0800 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0840 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0880 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
08C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXX--- ---------------- ----------------
0900 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0940 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0980 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
09C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0A00 : XXXXXXXXXXX----- ---------------- ---------------- ----------------
2000 : -------X-------- ---------------- ---------------- ----------------
2100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
2140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
2180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXX---- ----------------

All other memory blocks unused.

Program Memory Words Used:  2384
Program Memory Words Free:  5808


Errors   :     0
Warnings :     1 reported,     0 suppressed
Messages :   128 reported,     0 suppressed

